+function(e){if(e.oc.mediaManager===undefined){e.oc.mediaManager={}}var d=e.oc.foundation.base,c=d.prototype;var b=function(g,f){this.$el=e(g);this.$form=this.$el.closest("form");this.options=f;d.call(this);this.selectTimer=null;this.sidebarPreviewElement=null;this.itemListElement=null;this.scrollContentElement=null;this.thumbnailQueue=[];this.activeThumbnailQueueLength=0;this.sidebarThumbnailAjax=null;this.selectionMarker=null;this.dropzone=null;this.searchTrackInputTimer=null;this.navigationAjax=null;this.dblTouchTimer=null;this.dblTouchFlag=null;this.itemListPosition=null;this.init()};b.prototype=Object.create(c);b.prototype.constructor=b;b.prototype.dispose=function(){this.unregisterHandlers();this.clearSelectTimer();this.destroyUploader();this.clearSearchTrackInputTimer();this.releaseNavigationAjax();this.clearDblTouchTimer();this.removeAttachedControls();this.removeScroll();this.$el.removeData("oc.mediaManager");this.$el=null;this.$form=null;this.sidebarPreviewElement=null;this.itemListElement=null;this.scrollContentElement=null;this.sidebarThumbnailAjax=null;this.selectionMarker=null;this.thumbnailQueue=[];this.navigationAjax=null;c.dispose.call(this)};b.prototype.getSelectedItems=function(h,g){var l=this.$el.get(0).querySelectorAll('[data-type="media-item"].selected'),o=[];if(!g){var m=[];for(var j=0,k=l.length;j<k;j++){var n=l[j];if(!n.hasAttribute("data-root")){m.push(n)}}l=m}if(h===true){return l}for(var j=0,k=l.length;j<k;j++){var n=l[j],f={itemType:n.getAttribute("data-item-type"),path:n.getAttribute("data-path"),title:n.getAttribute("data-title"),documentType:n.getAttribute("data-document-type"),folder:n.getAttribute("data-folder"),publicUrl:n.getAttribute("data-public-url")};o.push(f)}return o};b.prototype.init=function(){this.itemListElement=this.$el.find('[data-control="item-list"]').get(0);this.scrollContentElement=this.itemListElement.querySelector(".scroll-wrapper");if(this.options.bottomToolbar){this.$el.find('[data-control="bottom-toolbar"]').removeClass("hide");if(this.options.cropAndInsertButton){this.$el.find('[data-popup-command="crop-and-insert"]').removeClass("hide")}}this.registerHandlers();this.updateSidebarPreview();this.generateThumbnails();this.initUploader();this.initScroll()};b.prototype.registerHandlers=function(){this.$el.on("dblclick",this.proxy(this.onNavigate));this.$el.on("click.tree-path",'ul.tree-path, [data-control="sidebar-labels"]',this.proxy(this.onNavigate));this.$el.on("click.command","[data-command]",this.proxy(this.onCommandClick));if(!Modernizr.touch){this.$el.on("click.item",'[data-type="media-item"]',this.proxy(this.onItemClick))}else{this.$el.on("touchend",'[data-type="media-item"]',this.proxy(this.onItemTouch))}this.$el.on("change",'[data-control="sorting"]',this.proxy(this.onSortingChanged));this.$el.on("keyup",'[data-control="search"]',this.proxy(this.onSearchChanged));this.$el.on("mediarefresh",this.proxy(this.refresh));this.$el.on("shown.oc.popup",'[data-command="create-folder"]',this.proxy(this.onFolderPopupShown));this.$el.on("hidden.oc.popup",'[data-command="create-folder"]',this.proxy(this.onFolderPopupHidden));this.$el.on("shown.oc.popup",'[data-command="move"]',this.proxy(this.onMovePopupShown));this.$el.on("hidden.oc.popup",'[data-command="move"]',this.proxy(this.onMovePopupHidden));this.$el.on("keydown",this.proxy(this.onKeyDown));if(this.itemListElement){this.itemListElement.addEventListener("mousedown",this.proxy(this.onListMouseDown))}};b.prototype.unregisterHandlers=function(){this.$el.off("dblclick",this.proxy(this.onNavigate));this.$el.off("click.tree-path",this.proxy(this.onNavigate));this.$el.off("click.command",this.proxy(this.onCommandClick));if(!Modernizr.touch){this.$el.off("click.item",this.proxy(this.onItemClick))}else{this.$el.off("touchend",'[data-type="media-item"]',this.proxy(this.onItemTouch))}this.$el.off("change",'[data-control="sorting"]',this.proxy(this.onSortingChanged));this.$el.off("keyup",'[data-control="search"]',this.proxy(this.onSearchChanged));this.$el.off("shown.oc.popup",'[data-command="create-folder"]',this.proxy(this.onFolderPopupShown));this.$el.off("hidden.oc.popup",'[data-command="create-folder"]',this.proxy(this.onFolderPopupHidden));this.$el.off("shown.oc.popup",'[data-command="move"]',this.proxy(this.onMovePopupShown));this.$el.off("hidden.oc.popup",'[data-command="move"]',this.proxy(this.onMovePopupHidden));this.$el.off("keydown",this.proxy(this.onKeyDown));if(this.itemListElement){this.itemListElement.removeEventListener("mousedown",this.proxy(this.onListMouseDown));this.itemListElement.removeEventListener("mousemove",this.proxy(this.onListMouseMove))}document.removeEventListener("mouseup",this.proxy(this.onListMouseUp))};b.prototype.changeView=function(f){var g={view:f,path:this.$el.find('[data-type="current-folder"]').val()};this.execNavigationRequest("onChangeView",g)};b.prototype.setFilter=function(f){var g={filter:f,path:this.$el.find('[data-type="current-folder"]').val()};this.execNavigationRequest("onSetFilter",g)};b.prototype.isSearchMode=function(){return this.$el.find('[data-type="search-mode"]').val()=="true"};b.prototype.initScroll=function(){this.$el.find(".control-scrollpad").scrollpad()};b.prototype.updateScroll=function(){this.$el.find(".control-scrollpad").scrollpad("update")};b.prototype.removeScroll=function(){this.$el.find(".control-scrollpad").scrollpad("dispose")};b.prototype.scrollToTop=function(){this.$el.find(".control-scrollpad").scrollpad("scrollToStart")};b.prototype.removeAttachedControls=function(){this.$el.find("[data-control=toolbar]").toolbar("dispose");this.$el.find("[data-control=sorting]").select2("destroy")};b.prototype.clearSelectTimer=function(){if(this.selectTimer===null){return}clearTimeout(this.selectTimer);this.selectTimer=null};b.prototype.selectItem=function(j,k){if(!k){var g=this.$el.get(0).querySelectorAll('[data-type="media-item"].selected');for(var h=0,f=g.length;h<f;h++){g[h].setAttribute("class","")}j.setAttribute("class","selected")}else{if(j.getAttribute("class")=="selected"){j.setAttribute("class","")}else{j.setAttribute("class","selected")}}j.focus();this.clearSelectTimer();if(this.isPreviewSidebarVisible()){this.selectTimer=setTimeout(this.proxy(this.updateSidebarPreview),100)}if(j.hasAttribute("data-root")&&!k){this.toggleMoveAndDelete(true)}else{this.toggleMoveAndDelete(false)}if(k){this.unselectRoot()}};b.prototype.toggleMoveAndDelete=function(f){e("[data-command=delete]",this.$el).prop("disabled",f);e("[data-command=move]",this.$el).prop("disabled",f)};b.prototype.unselectRoot=function(){var f=this.$el.get(0).querySelector('[data-type="media-item"][data-root].selected');if(f){f.setAttribute("class","")}};b.prototype.clearDblTouchTimer=function(){if(this.dblTouchTimer===null){return}clearTimeout(this.dblTouchTimer);this.dblTouchTimer=null};b.prototype.clearDblTouchFlag=function(){this.dblTouchFlag=false};b.prototype.selectFirstItem=function(){var f=this.itemListElement.querySelector('[data-type="media-item"]:first-child');if(f){this.selectItem(f)}};b.prototype.selectRelative=function(g,k){var f=this.getSelectedItems(true,true);if(f.length==0){this.selectFirstItem();return}var i=null;if(g){var h=f[f.length-1];if(h){i=h.nextElementSibling}}else{var j=f[0];if(j){i=j.previousElementSibling}}if(i){this.selectItem(i,k)}};b.prototype.gotoFolder=function(h,f){var g={path:h,resetSearch:f!==undefined?1:0};this.execNavigationRequest("onGoToFolder",g)};b.prototype.afterNavigate=function(){this.scrollToTop();this.generateThumbnails();this.updateSidebarPreview(true);this.selectFirstItem();this.updateScroll()};b.prototype.refresh=function(){var f={path:this.$el.find('[data-type="current-folder"]').val(),clearCache:true};this.execNavigationRequest("onGoToFolder",f)};b.prototype.execNavigationRequest=function(g,h,f){if(f===undefined){f=this.$form}if(this.navigationAjax!==null){try{this.navigationAjax.abort()}catch(i){}this.releaseNavigationAjax()}e.oc.stripeLoadIndicator.show();this.navigationAjax=f.request(this.options.alias+"::"+g,{data:h}).always(function(){e.oc.stripeLoadIndicator.hide()}).done(this.proxy(this.afterNavigate)).always(this.proxy(this.releaseNavigationAjax))};b.prototype.releaseNavigationAjax=function(){this.navigationAjax=null};b.prototype.navigateToItem=function(f){if(!f.length||!f.data("path").length){return}if(f.data("item-type")=="folder"){if(!f.data("clear-search")){this.gotoFolder(f.data("path"))}else{this.resetSearch();this.gotoFolder(f.data("path"),true)}}else{if(f.data("item-type")=="file"){this.$el.trigger("popupcommand",["insert"])}}};b.prototype.isPreviewSidebarVisible=function(){return !this.$el.find('[data-control="preview-sidebar"]').hasClass("hide")};b.prototype.toggleSidebar=function(h){var f=this.isPreviewSidebarVisible(),g=this.$el.find('[data-control="preview-sidebar"]'),i=e(h.target);if(!f){g.removeClass("hide");this.updateSidebarPreview();i.removeClass("sidebar-hidden")}else{g.addClass("hide");i.addClass("sidebar-hidden")}this.$form.request(this.options.alias+"::onSetSidebarVisible",{data:{visible:(f?0:1)}})};b.prototype.updateSidebarMediaPreview=function(j){var h=this.sidebarPreviewElement,m=h.querySelector('[data-control="media-preview-container"]'),l="";for(var k=0,g=m.children.length;k<g;k++){m.removeChild(m.children[k])}if(j.length==1&&!j[0].hasAttribute("data-root")){var n=j[0],f=n.getAttribute("data-document-type");switch(f){case"audio":l=h.querySelector('[data-control="audio-template"]').innerHTML;break;case"video":l=h.querySelector('[data-control="video-template"]').innerHTML;break;case"image":l=h.querySelector('[data-control="image-template"]').innerHTML;break}m.innerHTML=l.replace("{src}",n.getAttribute("data-public-url")).replace("{path}",n.getAttribute("data-path")).replace("{last-modified}",n.getAttribute("data-last-modified-ts"));if(f=="image"){this.loadSidebarThumbnail()}}else{if(j.length==1&&j[0].hasAttribute("data-root")){l=h.querySelector('[data-control="go-up"]').innerHTML;m.innerHTML=l}else{if(j.length==0){l=h.querySelector('[data-control="no-selection-template"]').innerHTML;m.innerHTML=l}else{l=h.querySelector('[data-control="multi-selection-template"]').innerHTML;m.innerHTML=l}}}};b.prototype.updateSidebarPreview=function(g){if(!this.sidebarPreviewElement){this.sidebarPreviewElement=this.$el.get(0).querySelector('[data-control="preview-sidebar"]')}var i=g===undefined?this.$el.get(0).querySelectorAll('[data-type="media-item"].selected'):[],f=this.sidebarPreviewElement;if(i.length==0){this.sidebarPreviewElement.querySelector('[data-control="sidebar-labels"]').setAttribute("class","hide")}else{if(i.length==1&&!i[0].hasAttribute("data-root")){this.sidebarPreviewElement.querySelector('[data-control="sidebar-labels"]').setAttribute("class","panel");var k=i[0],j=k.getAttribute("data-last-modified");f.querySelector('[data-label="size"]').textContent=k.getAttribute("data-size");f.querySelector('[data-label="title"]').textContent=k.getAttribute("data-title");f.querySelector('[data-label="last-modified"]').textContent=j;f.querySelector('[data-label="public-url"]').setAttribute("href",k.getAttribute("data-public-url"));if(j){f.querySelector('[data-control="last-modified"]').setAttribute("class","")}else{f.querySelector('[data-control="last-modified"]').setAttribute("class","hide")}if(this.isSearchMode()){f.querySelector('[data-control="item-folder"]').setAttribute("class","");var h=f.querySelector('[data-label="folder"]');h.textContent=k.getAttribute("data-folder");h.setAttribute("data-path",k.getAttribute("data-folder"))}else{f.querySelector('[data-control="item-folder"]').setAttribute("class","hide")}}else{this.sidebarPreviewElement.querySelector('[data-control="sidebar-labels"]').setAttribute("class","hide")}}this.updateSidebarMediaPreview(i)};b.prototype.loadSidebarThumbnail=function(){if(this.sidebarThumbnailAjax){try{this.sidebarThumbnailAjax.abort()}catch(h){}this.sidebarThumbnailAjax=null}var f=this.sidebarPreviewElement.querySelector('[data-control="sidebar-thumbnail"]');if(!f){return}var g={path:f.getAttribute("data-path"),lastModified:f.getAttribute("data-last-modified")};this.sidebarThumbnailAjax=this.$form.request(this.options.alias+"::onGetSidebarThumbnail",{data:g}).done(this.proxy(this.replaceSidebarPlaceholder)).always(this.proxy(this.releaseSidebarThumbnailAjax))};b.prototype.replaceSidebarPlaceholder=function(g){if(!this.sidebarPreviewElement){return}var f=this.sidebarPreviewElement.querySelector('[data-control="sidebar-thumbnail"]');if(!f){return}if(!g.markup){return}f.innerHTML=g.markup;f.removeAttribute("data-loading")};b.prototype.releaseSidebarThumbnailAjax=function(){this.sidebarThumbnailAjax=null};b.prototype.generateThumbnails=function(){this.thumbnailQueue=[];var f=this.itemListElement.querySelectorAll('[data-type="media-item"] div.image-placeholder');for(var g=(f.length-1);g>=0;g--){this.thumbnailQueue.push({id:f[g].getAttribute("id"),width:f[g].getAttribute("data-width"),height:f[g].getAttribute("data-height"),path:f[g].getAttribute("data-path"),lastModified:f[g].getAttribute("data-last-modified")})}this.handleThumbnailQueue()};b.prototype.handleThumbnailQueue=function(){var f=2,l=3;if(this.activeThumbnailQueueLength>=f){return}for(var k=this.activeThumbnailQueueLength;k<f&&this.thumbnailQueue.length>0;k++){var h=[];for(var g=0;g<l&&this.thumbnailQueue.length>0;g++){h.push(this.thumbnailQueue.pop())}this.activeThumbnailQueueLength++;this.handleThumbnailBatch(h).always(this.proxy(this.placeholdersUpdated))}};b.prototype.handleThumbnailBatch=function(g){var j={batch:g};for(var h=0,f=g.length;h<f;h++){var l=document.getElementById(g[h].id);if(l){l.setAttribute("data-loading","true")}}var k=this.$form.request(this.options.alias+"::onGenerateThumbnails",{data:j});k.done(this.proxy(this.replacePlaceholder));return k};b.prototype.replacePlaceholder=function(g){if(!g.generatedThumbnails){return}for(var j=0,f=g.generatedThumbnails.length;j<f;j++){var h=g.generatedThumbnails[j];if(!h.id||!h.markup){continue}var k=document.getElementById(h.id);if(!k){continue}var l=k.parentNode;if(l){l.innerHTML=h.markup}}};b.prototype.placeholdersUpdated=function(){this.activeThumbnailQueueLength--;this.handleThumbnailQueue()};b.prototype.getRelativePosition=function(h,j,g,i){var f=i!==undefined?i:e.oc.foundation.element.absolutePosition(h,true);return{x:(j-f.left),y:(g-f.top+this.scrollContentElement.scrollTop)}};b.prototype.createSelectionMarker=function(){if(this.selectionMarker){return}this.selectionMarker=document.createElement("div");this.selectionMarker.setAttribute("data-control","selection-marker");this.scrollContentElement.insertBefore(this.selectionMarker,this.scrollContentElement.firstChild)};b.prototype.doObjectsCollide=function(m,i,h,k,j,l,g,f){return !(((m+k)<(j))||(m>(j+f))||((i+h)<l)||(i>(l+g)))};b.prototype.initUploader=function(){if(!this.itemListElement){return}var f={clickable:this.$el.find('[data-control="upload"]').get(0),url:this.options.url,paramName:"file_data",headers:{},createImageThumbnails:false};if(this.options.uniqueId){f.headers["X-OCTOBER-FILEUPLOAD"]=this.options.uniqueId}var g=e('meta[name="csrf-token"]').attr("content");if(g){f.headers["X-CSRF-TOKEN"]=g}this.dropzone=new Dropzone(this.$el.get(0),f);this.dropzone.on("addedfile",this.proxy(this.uploadFileAdded));this.dropzone.on("totaluploadprogress",this.proxy(this.uploadUpdateTotalProgress));this.dropzone.on("queuecomplete",this.proxy(this.uploadQueueComplete));this.dropzone.on("sending",this.proxy(this.uploadSending));this.dropzone.on("error",this.proxy(this.uploadError));this.dropzone.on("success",this.proxy(this.uploadSuccess))};b.prototype.destroyUploader=function(){if(!this.dropzone){return}this.dropzone.destroy();this.dropzone=null};b.prototype.uploadFileAdded=function(){this.showUploadUi();this.setUploadProgress(0);this.$el.find('[data-command="cancel-uploading"]').removeClass("hide");this.$el.find('[data-command="close-uploader"]').addClass("hide")};b.prototype.showUploadUi=function(){this.$el.find('[data-control="upload-ui"]').removeClass("hide")};b.prototype.hideUploadUi=function(){this.$el.find('[data-control="upload-ui"]').addClass("hide")};b.prototype.uploadUpdateTotalProgress=function(k,i,f){this.setUploadProgress(k);var j=this.$el.get(0).querySelector('[data-label="file-number-and-progress"]'),h=j.getAttribute("data-message-template"),g=this.dropzone.getUploadingFiles().length+this.dropzone.getQueuedFiles().length;if(k>=100){k=99}j.innerHTML=h.replace(":number",g).replace(":percents",Math.round(k)+"%")};b.prototype.setUploadProgress=function(f){var g=this.$el.get(0).querySelector('[data-control="upload-progress-bar"]');g.setAttribute("style","width: "+f+"%");g.setAttribute("class","progress-bar")};b.prototype.uploadQueueComplete=function(){this.$el.find('[data-command="cancel-uploading"]').addClass("hide");this.$el.find('[data-command="close-uploader"]').removeClass("hide");this.refresh()};b.prototype.uploadSending=function(f,h,g){g.append("path",this.$el.find('[data-type="current-folder"]').val())};b.prototype.uploadCancelAll=function(){this.dropzone.removeAllFiles(true);this.hideUploadUi()};b.prototype.updateUploadBar=function(f,j){var i=this.$el.get(0).querySelector('[data-label="file-number-and-progress"]'),g=i.getAttribute("data-"+f+"-template"),h=this.$el.get(0).querySelector('[data-control="upload-progress-bar"]');i.innerHTML=g;h.setAttribute("class",j)};b.prototype.uploadSuccess=function(){this.updateUploadBar("success","progress-bar progress-bar-success")};b.prototype.uploadError=function(f,g){this.updateUploadBar("error","progress-bar progress-bar-danger");e.oc.alert("Error uploading file")};b.prototype.cropSelectedImage=function(h){var g=this.getSelectedItems(true);if(g.length!=1){alert(this.options.selectSingleImage);return}if(g[0].getAttribute("data-document-type")!=="image"){alert(this.options.selectionNotImage);return}var f=g[0].getAttribute("data-path");new e.oc.mediaManager.imageCropPopup(f,{alias:this.options.alias,onDone:h})};b.prototype.onImageCropped=function(f){this.$el.trigger("popupcommand",["insert-cropped",f])};b.prototype.clearSearchTrackInputTimer=function(){if(this.searchTrackInputTimer===null){return}clearTimeout(this.searchTrackInputTimer);this.searchTrackInputTimer=null};b.prototype.updateSearchResults=function(){var f=this.$el.find('[data-control="search"]'),g={search:f.val()};this.execNavigationRequest("onSearch",g,f)};b.prototype.resetSearch=function(){this.$el.find('[data-control="search"]').val("")};b.prototype.onSearchChanged=function(f){var g=f.currentTarget.value;if(this.lastSearchValue!==undefined&&this.lastSearchValue==g){return}this.lastSearchValue=g;this.clearSearchTrackInputTimer();this.searchTrackInputTimer=window.setTimeout(this.proxy(this.updateSearchResults),300)};b.prototype.deleteItems=function(){var f=this.$el.get(0).querySelectorAll('[data-type="media-item"].selected');if(!f.length){e.oc.alert(this.options.deleteEmpty);return}e.oc.confirm(this.options.deleteConfirm,this.proxy(this.deleteConfirmation))};b.prototype.deleteConfirmation=function(l){if(!l){return}var g=this.$el.get(0).querySelectorAll('[data-type="media-item"].selected'),k=[];for(var h=0,f=g.length;h<f;h++){k.push({path:g[h].getAttribute("data-path"),type:g[h].getAttribute("data-item-type")})}var j={paths:k};e.oc.stripeLoadIndicator.show();this.$form.request(this.options.alias+"::onDeleteItem",{data:j}).always(function(){e.oc.stripeLoadIndicator.hide()}).done(this.proxy(this.afterNavigate))};b.prototype.createFolder=function(f){e(f.target).popup({content:this.$el.find('[data-control="new-folder-template"]').html(),zIndex:1200})};b.prototype.onFolderPopupShown=function(h,g,f){e(f).find("input[name=name]").focus();e(f).on("submit.media","form",this.proxy(this.onNewFolderSubmit))};b.prototype.onFolderPopupHidden=function(h,g,f){e(f).off(".media","form")};b.prototype.onNewFolderSubmit=function(f){var g={name:e(f.target).find("input[name=name]").val(),path:this.$el.find('[data-type="current-folder"]').val()};e.oc.stripeLoadIndicator.show();this.$form.request(this.options.alias+"::onCreateFolder",{data:g}).always(function(){e.oc.stripeLoadIndicator.hide()}).done(this.proxy(this.folderCreated));f.preventDefault();return false};b.prototype.folderCreated=function(){this.$el.find('button[data-command="create-folder"]').popup("hide");this.afterNavigate()};b.prototype.moveItems=function(k){var g=this.$el.get(0).querySelectorAll('[data-type="media-item"].selected');if(!g.length){e.oc.alert(this.options.moveEmpty);return}var l={exclude:[],path:this.$el.find('[data-type="current-folder"]').val()};for(var h=0,f=g.length;h<f;h++){var j=g[h],m=j.getAttribute("data-path");if(j.getAttribute("data-item-type")=="folder"){l.exclude.push(m)}}e(k.target).popup({handler:this.options.alias+"::onLoadMovePopup",extraData:l,zIndex:1200})};b.prototype.onMovePopupShown=function(h,g,f){e(f).on("submit.media","form",this.proxy(this.onMoveItemsSubmit))};b.prototype.onMoveItemsSubmit=function(k){var g=this.$el.get(0).querySelectorAll('[data-type="media-item"].selected'),l={dest:e(k.target).find("select[name=dest]").val(),originalPath:e(k.target).find("input[name=originalPath]").val(),files:[],folders:[]};for(var h=0,f=g.length;h<f;h++){var j=g[h],m=j.getAttribute("data-path");if(j.getAttribute("data-item-type")=="folder"){l.folders.push(m)}else{l.files.push(m)}}e.oc.stripeLoadIndicator.show();this.$form.request(this.options.alias+"::onMoveItems",{data:l}).always(function(){e.oc.stripeLoadIndicator.hide()}).done(this.proxy(this.itemsMoved));k.preventDefault();return false};b.prototype.onMovePopupHidden=function(h,g,f){e(f).off(".media","form")};b.prototype.itemsMoved=function(){this.$el.find('button[data-command="move"]').popup("hide");this.afterNavigate()};b.prototype.onNavigate=function(g){var f=e(g.target).closest('[data-type="media-item"]');this.navigateToItem(f);if(e(g.target).data("label")!="public-url"){return false}};b.prototype.onCommandClick=function(g){var h=e(g.currentTarget).data("command");switch(h){case"refresh":this.refresh();break;case"change-view":this.changeView(e(g.currentTarget).data("view"));break;case"cancel-uploading":this.uploadCancelAll();break;case"close-uploader":this.hideUploadUi();break;case"set-filter":this.setFilter(e(g.currentTarget).data("filter"));break;case"delete":this.deleteItems();break;case"create-folder":this.createFolder(g);break;case"move":this.moveItems(g);break;case"toggle-sidebar":this.toggleSidebar(g);break;case"popup-command":var f=e(g.currentTarget).data("popup-command");if(f!=="crop-and-insert"){this.$el.trigger("popupcommand",[f])}else{this.cropSelectedImage(this.proxy(this.onImageCropped))}break}return false};b.prototype.onItemClick=function(f){if(f.target.tagName=="I"&&f.target.hasAttribute("data-rename-control")){return}this.selectItem(f.currentTarget,f.shiftKey)};b.prototype.onItemTouch=function(f){this.onItemClick(f);if(this.dblTouchFlag){this.onNavigate(f);this.dblTouchFlag=null}else{this.dblTouchFlag=true}this.clearDblTouchTimer();this.dblTouchTimer=setTimeout(this.proxy(this.clearDblTouchFlag),300)};b.prototype.onListMouseDown=function(g){this.itemListElement.addEventListener("mousemove",this.proxy(this.onListMouseMove));document.addEventListener("mouseup",this.proxy(this.onListMouseUp));this.itemListPosition=e.oc.foundation.element.absolutePosition(this.itemListElement,true);var h=e.oc.foundation.event.pageCoordinates(g),f=this.getRelativePosition(this.itemListElement,h.x,h.y,this.itemListPosition);this.selectionStartPoint=f;this.selectionStarted=false};b.prototype.onListMouseUp=function(k){this.itemListElement.removeEventListener("mousemove",this.proxy(this.onListMouseMove));document.removeEventListener("mouseup",this.proxy(this.onListMouseUp));e(document.body).removeClass("no-select");if(this.selectionStarted){this.unselectRoot();var h=this.itemListElement.querySelectorAll('[data-type="media-item"]:not([data-root])'),l=e.oc.foundation.element.absolutePosition(this.selectionMarker,true);for(var i=0,f=h.length;i<f;i++){var j=h[i],g=e.oc.foundation.element.absolutePosition(j,true);if(this.doObjectsCollide(l.top,l.left,this.selectionMarker.offsetWidth,this.selectionMarker.offsetHeight,g.top,g.left,j.offsetWidth,j.offsetHeight)){if(!k.shiftKey){j.setAttribute("class","selected")}else{if(j.getAttribute("class")=="selected"){j.setAttribute("class","")}else{j.setAttribute("class","selected")}}}else{if(!k.shiftKey){j.setAttribute("class","")}}}this.updateSidebarPreview();this.selectionMarker.setAttribute("class","hide")}this.selectionStarted=false};b.prototype.onListMouseMove=function(i){var j=e.oc.foundation.event.pageCoordinates(i),h=this.getRelativePosition(this.itemListElement,j.x,j.y,this.itemListPosition);var g=h.x-this.selectionStartPoint.x,f=h.y-this.selectionStartPoint.y;if(!this.selectionStarted&&(Math.abs(g)>2||Math.abs(f)>2)){this.createSelectionMarker();this.selectionMarker.setAttribute("class","");this.selectionStarted=true;e(document.body).addClass("no-select")}if(this.selectionStarted){if(g>=0){this.selectionMarker.style.left=this.selectionStartPoint.x+"px";this.selectionMarker.style.width=g+"px"}else{this.selectionMarker.style.left=h.x+"px";this.selectionMarker.style.width=Math.abs(g)+"px"}if(f>=0){this.selectionMarker.style.height=f+"px";this.selectionMarker.style.top=this.selectionStartPoint.y+"px"}else{this.selectionMarker.style.top=h.y+"px";this.selectionMarker.style.height=Math.abs(f)+"px"}}};b.prototype.onSortingChanged=function(f){var g={sortBy:e(f.target).val(),path:this.$el.find('[data-type="current-folder"]').val()};this.execNavigationRequest("onSetSorting",g)};b.prototype.onKeyDown=function(g){var h=false;switch(g.which){case 13:var f=this.getSelectedItems(true,true);if(f.length>0){this.navigateToItem(e(f[0]))}h=true;break;case 39:case 40:this.selectRelative(true,g.shiftKey);h=true;break;case 37:case 38:this.selectRelative(false,g.shiftKey);h=true;break}if(h){g.preventDefault();g.stopPropagation()}};b.DEFAULTS={url:window.location,alias:"",uniqueId:null,deleteEmpty:"Please select files to delete.",deleteConfirm:"Delete the selected file(s)?",moveEmpty:"Please select files to move.",selectSingleImage:"Please select a single image.",selectionNotImage:"The selected item is not an image.",bottomToolbar:false,cropAndInsertButton:false};var a=e.fn.mediaManager;e.fn.mediaManager=function(h){var g=Array.prototype.slice.call(arguments,1),f=undefined;this.each(function(){var k=e(this);var j=k.data("oc.mediaManager");var i=e.extend({},b.DEFAULTS,k.data(),typeof h=="object"&&h);if(!j){k.data("oc.mediaManager",(j=new b(this,i)))}if(typeof h=="string"){f=j[h].apply(j,g)}if(typeof f!="undefined"){return false}});return f?f:this};e.fn.mediaManager.Constructor=b;e.fn.mediaManager.noConflict=function(){e.fn.mediaManager=a;return this};e(document).on("render",function(){e("div[data-control=media-manager]").mediaManager()})}(window.jQuery);