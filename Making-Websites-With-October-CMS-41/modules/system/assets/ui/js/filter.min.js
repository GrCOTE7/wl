+function(c){var b=function(e,d){this.$el=c(e);this.options=d||{};this.scopeValues={};this.$activeScope=null;this.activeScopeName=null;this.isActiveScopeDirty=false;this.init()};b.DEFAULTS={optionsHandler:null,updateHandler:null};b.prototype.getPopoverTemplate=function(){return'                                                                                                        <form>                                                                                                      <input type="hidden" name="scopeName"  value="{{ scopeName }}" />                                       <div id="controlFilterPopover" class="control-filter-popover">                                              <div class="filter-search loading-indicator-container size-input-text">                                     <button class="close" data-dismiss="popover" type="button">&times;</button>                             <input                                                                                                      type="text"                                                                                             name="search"                                                                                           autocomplete="off"                                                                                      class="filter-search-input form-control icon search"                                                    data-request="{{ optionsHandler }}"                                                                     data-load-indicator-opaque                                                                              data-load-indicator                                                                                     data-track-input />                                                                             </div>                                                                                                  <div class="filter-items">                                                                                  <ul>                                                                                                        {{#available}}                                                                                              <li data-item-id="{{id}}"><a href="javascript:;">{{name}}</a></li>                                  {{/available}}                                                                                          {{#loading}}                                                                                                <li class="loading"><span></span></li>                                                              {{/loading}}                                                                                        </ul>                                                                                               </div>                                                                                                  <div class="filter-active-items">                                                                           <ul>                                                                                                        {{#active}}                                                                                                 <li data-item-id="{{id}}"><a href="javascript:;">{{name}}</a></li>                                  {{/active}}                                                                                         </ul>                                                                                               </div>                                                                                              </div>                                                                                              </form>                                                                                             '};b.prototype.init=function(){var d=this;this.$el.on("change",'.filter-scope input[type="checkbox"]',function(){var e=c(this).closest(".filter-scope");if(e.hasClass("is-indeterminate")){d.switchToggle(c(this))}else{d.checkboxToggle(c(this))}});c('.filter-scope input[type="checkbox"]',this.$el).each(function(){c(this).closest(".filter-scope").toggleClass("active",c(this).is(":checked"))});this.$el.on("click","a.filter-scope",function(){var f=c(this),e=f.data("scope-name");if(f.hasClass("filter-scope-open")){return}d.$activeScope=f;d.activeScopeName=e;d.isActiveScopeDirty=false;d.displayPopover(f);f.addClass("filter-scope-open")});this.$el.on("show.oc.popover","a.filter-scope",function(){d.focusSearch()});this.$el.on("hide.oc.popover","a.filter-scope",function(){var e=c(this);d.pushOptions(d.activeScopeName);d.activeScopeName=null;d.$activeScope=null;setTimeout(function(){e.removeClass("filter-scope-open")},200)});c(document).on("click","#controlFilterPopover .filter-items > ul > li",function(){d.selectItem(c(this))});c(document).on("click","#controlFilterPopover .filter-active-items > ul > li",function(){d.selectItem(c(this),true)});c(document).on("ajaxDone","#controlFilterPopover input.filter-search-input",function(f,e,g){d.filterAvailable(g.scopeName,g.options.available)})};b.prototype.focusSearch=function(){if(Modernizr.touch){return}var e=c("#controlFilterPopover input.filter-search-input"),d=e.val().length;e.focus();e.get(0).setSelectionRange(d,d)};b.prototype.updateScopeSetting=function(d,f){var e=d.find(".filter-setting");if(f){e.text(f);d.addClass("active")}else{e.text(this.getLang("filter.group.all","all"));d.removeClass("active")}};b.prototype.selectItem=function(k,e){var d=e?k.closest(".control-filter-popover").find(".filter-items:first > ul"):k.closest(".control-filter-popover").find(".filter-active-items:first > ul");k.addClass("animate-enter").prependTo(d).one("webkitAnimationEnd mozAnimationEnd MSAnimationEnd oanimationend animationend",function(){c(this).removeClass("animate-enter")});if(!this.scopeValues[this.activeScopeName]){return}var i=k.data("item-id"),h=this.scopeValues[this.activeScopeName],l=e?h.active:h.available,f=e?h.available:h.active,j=function(n){return n.id==i},m=c.grep(l,j).pop(),g=c.grep(l,j,true);if(e){this.scopeValues[this.activeScopeName].active=g}else{this.scopeValues[this.activeScopeName].available=g}if(m){f.push(m)}this.updateScopeSetting(this.$activeScope,h.active.length);this.isActiveScopeDirty=true;this.focusSearch()};b.prototype.displayPopover=function(g){var f=this,e=g.data("scope-name"),h=this.scopeValues[e],d=true;if(!h){h={loading:true};d=false}h.scopeName=e;h.optionsHandler=f.options.optionsHandler;g.data("oc.popover",null);g.ocPopover({content:Mustache.render(f.getPopoverTemplate(),h),modal:false,highlightModalTarget:true,closeOnPageClick:true,placement:"bottom"});if(!d){f.loadOptions(e)}};b.prototype.loadOptions=function(e){var g=this.$el.closest("form"),f=this,h={scopeName:e};var d=this.$el.data("filterScopes");if(d&&d[e]){f.fillOptions(e,d[e]);return false}return g.request(this.options.optionsHandler,{data:h,success:function(i){f.fillOptions(e,i.options)}})};b.prototype.fillOptions=function(d,f){if(this.scopeValues[d]){return}if(!f.active){f.active=[]}if(!f.available){f.available=[]}this.scopeValues[d]=f;if(d!=this.activeScopeName){return}var e=c("#controlFilterPopover .filter-items > ul").empty();this.addItemsToListElement(e,f.available);var e=c("#controlFilterPopover .filter-active-items > ul");this.addItemsToListElement(e,f.active)};b.prototype.filterAvailable=function(e,j){if(this.activeScopeName!=e){return}if(!this.scopeValues[this.activeScopeName]){return}var h=this,i=[],g=this.scopeValues[e];if(g.active.length){var d=[];c.each(g.active,function(k,l){d.push(l.id)});i=c.grep(j,function(k){return c.inArray(k.id,d)===-1})}else{i=j}var f=c("#controlFilterPopover .filter-items > ul").empty();h.addItemsToListElement(f,i)};b.prototype.addItemsToListElement=function(e,d){c.each(d,function(f,h){var g=c("<li />").data({"item-id":h.id}).append(c("<a />").prop({href:"javascript:;",}).text(h.name));e.append(g)})};b.prototype.pushOptions=function(d){if(!this.isActiveScopeDirty||!this.options.updateHandler){return}var e=this.$el.closest("form"),f={scopeName:d,options:this.scopeValues[d]};c.oc.stripeLoadIndicator.show();e.request(this.options.updateHandler,{data:f}).always(function(){c.oc.stripeLoadIndicator.hide()})};b.prototype.checkboxToggle=function(g){var i=g.is(":checked"),f=g.closest(".filter-scope"),d=f.data("scope-name");this.scopeValues[d]=i;if(this.options.updateHandler){var e=this.$el.closest("form"),h={scopeName:d,value:i};c.oc.stripeLoadIndicator.show();e.request(this.options.updateHandler,{data:h}).always(function(){c.oc.stripeLoadIndicator.hide()})}f.toggleClass("active",i)};b.prototype.switchToggle=function(h){var g=h.data("checked"),f=h.closest(".filter-scope"),d=f.data("scope-name");this.scopeValues[d]=g;if(this.options.updateHandler){var e=this.$el.closest("form"),i={scopeName:d,value:g};c.oc.stripeLoadIndicator.show();e.request(this.options.updateHandler,{data:i}).always(function(){c.oc.stripeLoadIndicator.hide()})}f.toggleClass("active",!!g)};b.prototype.getLang=function(e,d){if(c.oc===undefined||c.oc.lang===undefined){return d}return c.oc.lang.get(e,d)};var a=c.fn.filterWidget;c.fn.filterWidget=function(f){var e=arguments,d;this.each(function(){var i=c(this);var h=i.data("oc.filterwidget");var g=c.extend({},b.DEFAULTS,i.data(),typeof f=="object"&&f);if(!h){i.data("oc.filterwidget",(h=new b(this,g)))}if(typeof f=="string"){d=h[f].call(i)}if(typeof d!="undefined"){return false}});return d?d:this};c.fn.filterWidget.Constructor=b;c.fn.filterWidget.noConflict=function(){c.fn.filterWidget=a;return this};c(document).render(function(){c('[data-control="filterwidget"]').filterWidget()})}(window.jQuery);