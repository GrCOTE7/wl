+function(d){var b=d.oc.foundation.base,a=b.prototype;var c=function(e,f){this.$tabsControlElement=e;this.options=d.extend(c.DEFAULTS,typeof f=="object"&&f);this.tabsControlId=null;b.call(this);this.init()};c.prototype=Object.create(a);c.prototype.constructor=c;c.prototype.init=function(){this.tabsControlId=this.$tabsControlElement.attr("id");if(!this.tabsControlId){throw new Error("The tab controls element should have the id attribute value.")}this.registerHandlers()};c.prototype.dispose=function(){this.unregisterHandlers();this.$tabsControlElement=null;a.dispose.call(this)};c.prototype.registerHandlers=function(){this.$tabsControlElement.on("initTab.oc.tab",this.proxy(this.initTab));this.$tabsControlElement.on("click",'[data-control="tabless-collapse-icon"]',this.proxy(this.tablessCollapseClicked));this.$tabsControlElement.on("click",'[data-control="primary-collapse-icon"]',this.proxy(this.primaryCollapseClicked))};c.prototype.unregisterHandlers=function(){this.$tabsControlElement.off("initTab.oc.tab",this.proxy(this.initTab));this.$tabsControlElement.off("click",'[data-control="tabless-collapse-icon"]',this.proxy(this.tablessCollapseClicked));this.$tabsControlElement.off("click",'[data-control="primary-collapse-icon"]',this.proxy(this.primaryCollapseClicked))};c.prototype.initTab=function(g,h){if(d(g.target).attr("id")!=this.tabsControlId){return}var e=this.findPrimaryPanel(h.pane),j=d(".form-tabless-fields",h.pane),f=this.findSecondaryPanel(h.pane),i=f.length>0;f.addClass("secondary-content-tabs");j.append(this.createTablessCollapseIcon());if(!i){d(".tab-pane",e).addClass("pane-compact")}d(".nav-tabs",e).addClass("master-area");if(e.length>0){f.append(this.createPrimaryCollapseIcon())}else{f.addClass("primary-collapsed")}if(!d("a",h.tab).hasClass("new-template")&&this.getLocalStorageValue("tabless",0)==1){j.addClass("collapsed")}if(this.getLocalStorageValue("primary",0)==1&&i){e.addClass("collapsed");f.addClass("primary-collapsed")}if(this.options.onInitTab){this.options.onInitTab(d("form",h.pane))}};c.prototype.tablessCollapseClicked=function(e){var f=d(e.target).closest(".form-tabless-fields");f.toggleClass("collapsed");this.setLocalStorageValue("tabless",f.hasClass("collapsed")?1:0);window.setTimeout(this.proxy(this.updateUi),500);e.stopPropagation();return false};c.prototype.primaryCollapseClicked=function(h){var g=d(h.target).closest(".tab-pane"),e=this.findPrimaryPanel(g),f=this.findSecondaryPanel(g);e.toggleClass("collapsed");f.toggleClass("primary-collapsed");this.updateUi();this.setLocalStorageValue("primary",e.hasClass("collapsed")?1:0);return false};c.prototype.updateUi=function(){d(window).trigger("oc.updateUi")};c.prototype.createTablessCollapseIcon=function(){return d('<a href="javascript:;" class="tab-collapse-icon tabless" data-control="tabless-collapse-icon"><i class="icon-chevron-up"></i></a>')};c.prototype.createPrimaryCollapseIcon=function(){return d('<a href="javascript:;" class="tab-collapse-icon primary" data-control="primary-collapse-icon"><i class="icon-chevron-down"></i></a>')};c.prototype.generateStorageKey=function(e){return"oc"+e+this.tabsControlId.replace("-","")+"collapsed"};c.prototype.findPrimaryPanel=function(e){return d(e).find(".control-tabs.primary-tabs")};c.prototype.findSecondaryPanel=function(e){return d(e).find(".control-tabs.secondary-tabs")};c.prototype.getLocalStorageValue=function(g,e){var f=this.generateStorageKey(g);if(typeof(localStorage)!=="undefined"){return localStorage[f]}return e};c.prototype.setLocalStorageValue=function(g,f){var e=this.generateStorageKey(g);if(typeof(localStorage)!=="undefined"){localStorage[e]=f}};c.DEFAULTS={onInitTab:null};d.oc.tabFormExpandControls=c}(window.jQuery);