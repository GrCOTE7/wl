+function(e){var d=e.oc.foundation.base,c=d.prototype;var b=function(g,f){this.$el=e(g);this.options=f;this.$allItems=null;this.$scrollbar=null;d.call(this);e.oc.foundation.controlUtils.markDisposable(g);this.init()};b.prototype=Object.create(c);b.prototype.constructor=b;b.prototype.init=function(){this.$allItems=e("li",this.$el);this.$scrollbar=this.$el.closest("[data-control=scrollbar]");this.initSortable();this.createItemControls();this.$el.on("click.treeview","li > div > ul.submenu li a",this.proxy(this.onOpenSubmenu));this.$el.on("click.treeview","li > div > a",this.proxy(this.onOpen));this.$el.on("click.treeview","li span.expand",this.proxy(this.onItemExpandClick));this.$el.one("dispose-control",this.proxy(this.dispose));var f=this.$el.data("oc.active-item");if(f!==undefined){this.markActive(f)}};b.prototype.dispose=function(){this.unregisterHandlers();this.clearScrollTimeout();this.options=null;this.$el.removeData("oc.treeView");this.$el=null;this.$allItems=null;this.$scrollbar=null;c.dispose.call(this)};b.prototype.unregisterHandlers=function(){this.$el.off(".treeview");this.$el.off("move.oc.treelist",this.proxy(this.onNodeMove));this.$el.off("aftermove.oc.treelist",this.proxy(this.onAfterNodeMove));this.$el.off("dispose-control",this.proxy(this.dispose))};b.prototype.createItemControls=function(){e("li",this.$el).each(function(){var g=e("> div",this),f=e("> span.expand",g);if(f.length>0){return}f=e('<span class="expand">Expand</span>');g.prepend(f);if(!e(".drag-handle",g).length){g.append(e('<span class="drag-handle">Drag</span>'))}g.append(e('<span class="borders"></span>'));if(e(this).attr("data-no-drag-mode")!==undefined){e("span.drag-handle",this).attr("title","Dragging is disabled when the Search is active")}})};b.prototype.collapseGroup=function(g){var f=e("> ol",g);f.css({overflow:"hidden"});f.animate({height:0},{duration:100,queue:false,complete:function(){f.css({overflow:"visible",display:"none",height:"auto"});g.attr("data-status","collapsed");e(window).trigger("resize")}});this.sendGroupStatusRequest(g,0)};b.prototype.expandGroup=function(g){var f=e("> ol",g);f.css({overflow:"hidden",display:"block",height:0});g.attr("data-status","expanded");f.animate({height:f[0].scrollHeight},{duration:100,queue:false,complete:function(){f.css({overflow:"visible",height:"auto"});e(window).trigger("resize")}});this.sendGroupStatusRequest(g,1)};b.prototype.fixSubItems=function(){e("li",this.$el).each(function(){var g=e(this),f=e("> ol > li",g);g.toggleClass("has-subitems",f.length>0)})};b.prototype.toggleGroup=function(g){var f=e(g);f.attr("data-status")=="expanded"?this.collapseGroup(f):this.expandGroup(f)};b.prototype.sendGroupStatusRequest=function(h,f){if(this.options.groupStatusHandler!==undefined){var g=h.data("group-id");h.request(this.options.groupStatusHandler,{data:{group:g,status:f}})}};b.prototype.sendReorderRequest=function(){if(this.options.reorderHandler===undefined){return}var f={};function g(i,h){e("> li",i).each(function(){var j={};g(e("> ol",this),j);h[e(this).data("groupId")]=j})}g(e("> ol",this.$el),f);this.$el.request(this.options.reorderHandler,{data:{structure:JSON.stringify(f)}})};b.prototype.initSortable=function(){var f=e("[data-no-drag-mode]",this.$el);if(f.length>0){return}if(this.$el.data("oc.treelist")){this.$el.treeListWidget("unbind")}this.$el.treeListWidget({tweakCursorAdjustment:this.proxy(this.tweakCursorAdjustment),isValidTarget:this.proxy(this.isValidTarget),useAnimation:false,usePlaceholderClone:true,handle:"span.drag-handle",onDrag:this.proxy(this.onDrag),tolerance:-20});this.$el.on("move.oc.treelist",this.proxy(this.onNodeMove));this.$el.on("aftermove.oc.treelist",this.proxy(this.onAfterNodeMove))};b.prototype.markActive=function(f){e("li",this.$el).removeClass("active");if(f){e('li[data-id="'+f+'"]',this.$el).addClass("active")}this.$el.data("oc.active-item",f)};b.prototype.update=function(){this.$allItems=e("li",this.$el);this.createItemControls();var f=this.$el.data("oc.active-item");if(f!==undefined){this.markActive(f)}};b.prototype.handleMovedNode=function(){this.$el.trigger("change");this.$allItems.removeClass("drop-target");this.fixSubItems();this.sendReorderRequest()};b.prototype.tweakCursorAdjustment=function(f){if(!f){return f}if(this.$scrollbar.length>0){f.top-=this.$scrollbar.scrollTop()}return f};b.prototype.isValidTarget=function(g,f){return e(f.el).closest("li").attr("data-status")!="collapsed"};b.DEFAULTS={};b.prototype.onOpenSubmenu=function(f){var g=e.Event("submenu.oc.treeview",{relatedTarget:f.currentTarget,clickEvent:f});this.$el.trigger(g,this);return false};b.prototype.onOpen=function(f){var g=e.Event("open.oc.treeview",{relatedTarget:e(f.currentTarget).closest("li").get(0),clickEvent:f});this.$el.trigger(g,f.currentTarget);return false};b.prototype.onNodeMove=function(){setTimeout(this.proxy(this.handleMovedNode),50)};b.prototype.onAfterNodeMove=function(f,g){this.$allItems.removeClass("drop-target");g.container.el.closest("li").addClass("drop-target")};b.prototype.onItemExpandClick=function(f){this.toggleGroup(e(f.currentTarget).closest("li"));return false};b.prototype.onDrag=function(g,f,i,h){this.dragCallback=function(){i(g,f,null,h)};this.clearScrollTimeout();this.dragCallback();if(!this.$scrollbar||this.$scrollbar.length===0){return}if(f.top<0){this.scrollOffset=-10+Math.floor(f.top/5)}else{if(f.top>this.$scrollbar.height()){this.scrollOffset=10+Math.ceil((f.top-this.$scrollbar.height())/5)}else{return}}this.scrollMax=function(){return this.$el.height()-this.$scrollbar.height()};this.dragScroll()};b.prototype.dragScroll=function(){var f=this.$scrollbar.scrollTop();var g;this.scrollTimeout=null;this.$scrollbar.scrollTop(Math.min(f+this.scrollOffset,this.scrollMax()));g=this.$scrollbar.scrollTop()-f;if(g===0){return}this.$el.children("ol").each(function(){var h=e(this).data("oc.sortable");h.refresh();h.cursorAdjustment.top-=g});this.dragCallback();this.$scrollbar.data("oc.scrollbar").setThumbPosition();this.scrollTimeout=window.setTimeout(this.proxy(this.dragScroll),100)};b.prototype.clearScrollTimeout=function(){if(this.scrollTimeout){window.clearTimeout(this.scrollTimeout);this.scrollTimeout=null}};var a=e.fn.treeView;e.fn.treeView=function(g){var f=arguments;return this.each(function(){var m=e(this);var l=m.data("oc.treeView");var j=e.extend({},b.DEFAULTS,m.data(),typeof g=="object"&&g);if(!l){m.data("oc.treeView",(l=new b(this,j)))}if(typeof g=="string"&&l){var h=[];for(var k=1;k<f.length;k++){h.push(f[k])}if(l[g]){l[g].apply(l,h)}}})};e.fn.treeView.Constructor=b;e.fn.treeView.noConflict=function(){e.fn.treeView=a;return this};e(document).render(function(){e("[data-control=treeview]").treeView()})}(window.jQuery);