+function(d){var c=d.oc.foundation.base,b=c.prototype;var e=function(g,f){c.call(this);this.options=f;this.$el=d(g);this.$textarea=this.$el.find(">textarea:first");this.$toolbar=this.$el.find(">.editor-toolbar:first");this.$code=null;this.editor=null;this.$form=null;this.isFullscreen=false;this.$fullscreenEnable=this.$toolbar.find("li.fullscreen-enable");this.$fullscreenDisable=this.$toolbar.find("li.fullscreen-disable");this.isSearchbox=false;this.$searchboxEnable=this.$toolbar.find("li.searchbox-enable");this.$searchboxDisable=this.$toolbar.find("li.searchbox-disable");this.isReplacebox=false;this.$replaceboxEnable=this.$toolbar.find("li.replacebox-enable");this.$replaceboxDisable=this.$toolbar.find("li.replacebox-disable");d.oc.foundation.controlUtils.markDisposable(g);this.init();this.$el.trigger("oc.codeEditorReady")};e.prototype=Object.create(b);e.prototype.constructor=e;e.DEFAULTS={fontSize:12,wordWrap:"off",codeFolding:"manual",autocompletion:"manual",tabSize:4,theme:"textmate",showInvisibles:true,highlightActiveLine:true,useSoftTabs:true,autoCloseTags:true,showGutter:true,enableEmmet:true,language:"php",margin:0,vendorPath:"/",showPrintMargin:false,highlightSelectedWord:false,hScrollBarAlwaysVisible:false,readOnly:false};e.prototype.init=function(){var g=this;if(!this.$el.attr("id")){this.$el.attr("id","element-"+Math.random().toString(36).substring(7))}this.$code=d("<div />").addClass("editor-code").attr("id",this.$el.attr("id")+"-code").css({position:"absolute",top:0,right:0,bottom:0,left:0}).appendTo(this.$el);var i=this.editor=ace.edit(this.$code.attr("id")),h=this.options,f=this.$el.closest("form");i.$blockScrolling=Infinity;this.$form=f;this.$textarea.hide();i.getSession().setValue(this.$textarea.val());i.on("change",this.proxy(this.onChange));f.on("oc.beforeRequest",this.proxy(this.onBeforeRequest));d(window).on("resize",this.proxy(this.onResize));d(window).on("oc.updateUi",this.proxy(this.onResize));this.$el.one("dispose-control",this.proxy(this.dispose));assetManager.load({js:[h.vendorPath+"/theme-"+h.theme+".js"]},function(){i.setTheme("ace/theme/"+h.theme);var j=h.language==="php";i.getSession().setMode({path:"ace/mode/"+h.language,inline:j})});i.wrapper=this;i.setShowInvisibles(h.showInvisibles);i.setBehavioursEnabled(h.autoCloseTags);i.setHighlightActiveLine(h.highlightActiveLine);i.renderer.setShowGutter(h.showGutter);i.renderer.setShowPrintMargin(h.showPrintMargin);i.setHighlightSelectedWord(h.highlightSelectedWord);i.renderer.setHScrollBarAlwaysVisible(h.hScrollBarAlwaysVisible);i.setDisplayIndentGuides(h.displayIndentGuides);i.getSession().setUseSoftTabs(h.useSoftTabs);i.getSession().setTabSize(h.tabSize);i.setReadOnly(h.readOnly);i.getSession().setFoldStyle(h.codeFolding);i.setFontSize(h.fontSize);i.on("blur",this.proxy(this.onBlur));i.on("focus",this.proxy(this.onFocus));this.setWordWrap(h.wordWrap);ace.require("ace/config").set("basePath",this.options.vendorPath);i.setOptions({enableEmmet:h.enableEmmet,enableBasicAutocompletion:h.autocompletion==="basic",enableSnippets:h.enableSnippets,enableLiveAutocompletion:h.autocompletion==="live"});i.renderer.setScrollMargin(h.margin,h.margin,0,0);i.renderer.setPadding(h.margin);this.$toolbar.find(">ul>li>a").each(function(){var l=d(this).find(">abbr"),k=l.text(),j=l.attr("title"),m=k+" (<strong>"+j+"</strong>)";d(this).attr("title",m)}).tooltip({delay:500,placement:"bottom",html:true});this.$fullscreenDisable.hide();this.$fullscreenEnable.on("click.codeeditor",">a",d.proxy(this.toggleFullscreen,this));this.$fullscreenDisable.on("click.codeeditor",">a",d.proxy(this.toggleFullscreen,this));this.$searchboxDisable.hide();this.$searchboxEnable.on("click.codeeditor",">a",d.proxy(this.toggleSearchbox,this));this.$searchboxDisable.on("click.codeeditor",">a",d.proxy(this.toggleSearchbox,this));this.$replaceboxDisable.hide();this.$replaceboxEnable.on("click.codeeditor",">a",d.proxy(this.toggleReplacebox,this));this.$replaceboxDisable.on("click.codeeditor",">a",d.proxy(this.toggleReplacebox,this));this.$el.hotKey({hotkey:"esc",hotkeyMac:"esc",callback:this.proxy(this.onEscape)});i.commands.addCommand({name:"toggleFullscreen",bindKey:{win:"Ctrl+Shift+F",mac:"Ctrl+Shift+F"},exec:d.proxy(this.toggleFullscreen,this),readOnly:true})};e.prototype.dispose=function(){if(this.$el===null){return}this.unregisterHandlers();this.disposeAttachedControls();this.$el=null;this.$textarea=null;this.$toolbar=null;this.$code=null;this.$fullscreenEnable=null;this.$fullscreenDisable=null;this.$searchboxEnable=null;this.$searchboxDisable=null;this.$replaceboxEnable=null;this.$replaceboxDisable=null;this.$form=null;this.options=null;b.dispose.call(this)};e.prototype.disposeAttachedControls=function(){this.editor.destroy();var h=Object.keys(this.editor.renderer);for(var g=0,f=h.length;g<f;g++){this.editor.renderer[h[g]]=null}h=Object.keys(this.editor);for(var g=0,f=h.length;g<f;g++){this.editor[h[g]]=null}this.editor=null;this.$toolbar.find(">ul>li>a").tooltip("destroy");this.$el.removeData("oc.codeEditor");this.$el.hotKey("dispose")};e.prototype.unregisterHandlers=function(){this.editor.off("change",this.proxy(this.onChange));this.editor.off("blur",this.proxy(this.onBlur));this.editor.off("focus",this.proxy(this.onFocus));this.$fullscreenEnable.off(".codeeditor");this.$fullscreenDisable.off(".codeeditor");this.$form.off("oc.beforeRequest",this.proxy(this.onBeforeRequest));this.$el.off("dispose-control",this.proxy(this.dispose));d(window).off("resize",this.proxy(this.onResize));d(window).off("oc.updateUi",this.proxy(this.onResize))};e.prototype.onBeforeRequest=function(){this.$textarea.val(this.editor.getSession().getValue())};e.prototype.onChange=function(){this.$form.trigger("change");this.$textarea.trigger("oc.codeEditorChange")};e.prototype.onResize=function(){this.editor.resize()};e.prototype.onBlur=function(){this.$el.removeClass("editor-focus")};e.prototype.onFocus=function(){this.$el.addClass("editor-focus")};e.prototype.onEscape=function(){this.isFullscreen&&this.toggleFullscreen()};e.prototype.setWordWrap=function(h){var g=this.editor.getSession(),f=this.editor.renderer;switch(h+""){default:case"off":g.setUseWrapMode(false);f.setPrintMarginColumn(80);break;case"40":g.setUseWrapMode(true);g.setWrapLimitRange(40,40);f.setPrintMarginColumn(40);break;case"80":g.setUseWrapMode(true);g.setWrapLimitRange(80,80);f.setPrintMarginColumn(80);break;case"fluid":g.setUseWrapMode(true);g.setWrapLimitRange(null,null);f.setPrintMarginColumn(80);break}};e.prototype.setTheme=function(g){var f=this;assetManager.load({js:[this.options.vendorPath+"/theme-"+g+".js"]},function(){f.editor.setTheme("ace/theme/"+g)})};e.prototype.getContent=function(){return this.editor.getSession().getValue()};e.prototype.setContent=function(f){this.editor.getSession().setValue(f)};e.prototype.getEditorObject=function(){return this.editor};e.prototype.getToolbar=function(){return this.$toolbar};e.prototype.toggleFullscreen=function(){this.$el.toggleClass("editor-fullscreen");this.$fullscreenEnable.toggle();this.$fullscreenDisable.toggle();this.isFullscreen=this.$el.hasClass("editor-fullscreen");if(this.isFullscreen){d("body").css({overflow:"hidden"})}else{d("body").css({overflow:"inherit"})}this.editor.resize();this.editor.focus()};e.prototype.toggleSearchbox=function(){this.$searchboxEnable.toggle();this.$searchboxDisable.toggle();this.editor.execCommand("find");this.editor.resize();this.editor.focus()};e.prototype.toggleReplacebox=function(){this.$replaceboxEnable.toggle();this.$replaceboxDisable.toggle();this.editor.execCommand("replace");this.editor.resize();this.editor.focus()};var a=d.fn.codeEditor;d.fn.codeEditor=function(h){var g=Array.prototype.slice.call(arguments,1),f;this.each(function(){var k=d(this);var j=k.data("oc.codeEditor");var i=d.extend({},e.DEFAULTS,k.data(),typeof h=="object"&&h);if(!j){k.data("oc.codeEditor",(j=new e(this,i)))}if(typeof h=="string"){f=j[h].apply(j,g)}if(typeof f!="undefined"){return false}});return f?f:this};d.fn.codeEditor.Constructor=e;if(d.oc===undefined){d.oc={}}d.oc.codeEditorExtensionModes={htm:"html",html:"html",md:"markdown",txt:"plain_text",js:"javascript",less:"less",scss:"scss",sass:"sass",css:"css"};d.fn.codeEditor.noConflict=function(){d.fn.codeEditor=a;return this};d(document).render(function(){d('[data-control="codeeditor"]').codeEditor()});+function(g){if(g.ace&&typeof g.ace.require=="function"){var h=g.ace.require("ace/ext/emmet");if(h&&h.AceEmmetEditor&&h.AceEmmetEditor.prototype.getSyntax){var f=h.AceEmmetEditor.prototype.getSyntax;h.AceEmmetEditor.prototype.getSyntax=function(){var i=d.proxy(f,this)();return i=="twig"?"html":i}}}}(window)}(window.jQuery);