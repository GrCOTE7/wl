+function(e){var c=e.oc.foundation.base,b=c.prototype;var d=function(g,f){this.options=f;this.$el=e(g);this.$sortable=e(f.sortableContainer,this.$el);e.oc.foundation.controlUtils.markDisposable(g);c.call(this);this.init()};d.prototype=Object.create(b);d.prototype.constructor=d;d.DEFAULTS={sortableHandle:".repeater-item-handle",sortableContainer:"ul.field-repeater-items",titleFrom:null,maxItems:null};d.prototype.init=function(){this.bindSorting();this.$el.on("ajaxDone","> .field-repeater-items > .field-repeater-item > .repeater-item-remove > [data-repeater-remove]",this.proxy(this.onRemoveItemSuccess));this.$el.on("ajaxDone","> .field-repeater-add-item > [data-repeater-add]",this.proxy(this.onAddItemSuccess));this.$el.on("click","> ul > li > .repeater-item-collapse .repeater-item-collapse-one",this.proxy(this.toggleCollapse));this.$el.on("click","> .field-repeater-add-item > [data-repeater-add-group]",this.proxy(this.clickAddGroupButton));this.$el.one("dispose-control",this.proxy(this.dispose));this.togglePrompt()};d.prototype.dispose=function(){this.$sortable.sortable("destroy");this.$el.off("ajaxDone","> .field-repeater-items > .field-repeater-item > .repeater-item-remove > [data-repeater-remove]",this.proxy(this.onRemoveItemSuccess));this.$el.off("ajaxDone","> .field-repeater-add-item > [data-repeater-add]",this.proxy(this.onAddItemSuccess));this.$el.off("click","> .field-repeater-items > .field-repeater-item > .repeater-item-collapse .repeater-item-collapse-one",this.proxy(this.toggleCollapse));this.$el.off("click","> .field-repeater-add-item > [data-repeater-add-group]",this.proxy(this.clickAddGroupButton));this.$el.off("dispose-control",this.proxy(this.dispose));this.$el.removeData("oc.repeater");this.$el=null;this.$sortable=null;this.options=null;b.dispose.call(this)};d.prototype.unbind=function(){this.dispose()};d.prototype.bindSorting=function(){var f={handle:this.options.sortableHandle,nested:false};this.$sortable.sortable(f)};d.prototype.clickAddGroupButton=function(i){var h=e("> [data-group-palette-template]",this.$el).html(),f=e(i.target),g=this.$el.closest("form"),k=f.closest(".loading-indicator-container");f.ocPopover({content:h});var j=f.data("oc.popover").$container;j.trigger("render");j.on("click","a",function(l){setTimeout(function(){e(l.target).trigger("close.oc.popover")},1)}).on("ajaxPromise","[data-repeater-add]",function(m,l){k.loadIndicator();g.one("ajaxComplete",function(){k.loadIndicator("hide")})});e("[data-repeater-add]",j).data("request-form",g)};d.prototype.onRemoveItemSuccess=function(f){e(f.target).closest(".field-repeater-item").remove();this.togglePrompt()};d.prototype.onAddItemSuccess=function(f){this.togglePrompt()};d.prototype.togglePrompt=function(){if(this.options.maxItems&&this.options.maxItems>0){var g=this.$el.find("> .field-repeater-items > .field-repeater-item").length,f=this.$el.find("> .field-repeater-add-item");f.toggle(g<this.options.maxItems)}};d.prototype.toggleCollapse=function(h){var g=e(h.target).closest(".field-repeater-item"),f=g.hasClass("collapsed");h.preventDefault();if(h.ctrlKey||h.metaKey){f?this.expandAll():this.collapseAll()}else{f?this.expand(g):this.collapse(g)}};d.prototype.collapseAll=function(){var g=this,f=e(".field-repeater-item",this.$el);e.each(f,function(h,i){g.collapse(e(i))})};d.prototype.expandAll=function(){var g=this,f=e(".field-repeater-item",this.$el);e.each(f,function(h,i){g.expand(e(i))})};d.prototype.collapse=function(f){f.addClass("collapsed");e(".repeater-item-collapsed-title",f).text(this.getCollapseTitle(f))};d.prototype.expand=function(f){f.removeClass("collapsed")};d.prototype.getCollapseTitle=function(h){var f,j="",g=h.data("collapse-title");if(g){return g}if(this.options.titleFrom){f=e('[data-field-name="'+this.options.titleFrom+'"]');if(!f.length){f=h}}else{f=h}var i=e("input[type=text]:first",f);if(i.length){return i.val()}return j};var a=e.fn.fieldRepeater;e.fn.fieldRepeater=function(h){var g=Array.prototype.slice.call(arguments,1),f;this.each(function(){var k=e(this);var j=k.data("oc.repeater");var i=e.extend({},d.DEFAULTS,k.data(),typeof h=="object"&&h);if(!j){k.data("oc.repeater",(j=new d(this,i)))}if(typeof h=="string"){f=j[h].apply(j,g)}if(typeof f!="undefined"){return false}});return f?f:this};e.fn.fieldRepeater.Constructor=d;e.fn.fieldRepeater.noConflict=function(){e.fn.fieldRepeater=a;return this};e(document).render(function(){e('[data-control="fieldrepeater"]').fieldRepeater()})}(window.jQuery);