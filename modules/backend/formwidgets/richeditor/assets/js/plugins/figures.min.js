(function(a){a.FroalaEditor.PLUGINS.figures=function(h){function k(s){var r=a("<div />").append(s.clone()).remove().html();h.events.focus(true);h.selection.restore();h.html.insert(r);h.html.cleanEmptyTags();a("figure",h.$el).each(function(){var v=a(this),u=v.parent("p"),t=v.next("p");if(!!u.length){v.insertAfter(u)}if(!!t.length&&a.trim(t.text()).length==0){t.remove()}});h.undo.saveStep()}function d(){var r=a('<figure contenteditable="false" tabindex="0" data-ui-block="true">&nbsp;</figure>');r.get(0).contentEditable=false;return r}function i(s,t){var r=d();r.attr("data-video",s);r.attr("data-label",t);k(r)}function p(s,t){var r=d();r.attr("data-audio",s);r.attr("data-label",t);k(r)}function f(){a("[data-video], [data-audio]",h.$el).each(function(){a(this).addClass("fr-draggable").attr({"data-ui-block":"true",draggable:"true",tabindex:"0"}).html("&nbsp;");this.contentEditable=false})}function g(s){if(s.which==40||s.which==38||s.which==8||s.which==46){var r=a(h.selection.element());if(r.is("br")){r=r.parent()}if(!!r.length){switch(s.which){case 38:c(r.prev());break;case 40:c(r.next());break;case 46:o(r.next(),r);break;case 8:o(r.prev(),r);break}}}}function o(s,r){if(s.attr("data-ui-block")!==undefined&&a.trim(r.text()).length==0){r.remove();c(s);h.undo.saveStep()}}function c(r){if(r.attr("data-ui-block")!==undefined){r.focus();h.selection.clear();return true}return false}function j(t,v){if(t.which==40||t.which==38||t.which==13||t.which==8||t.which==46){switch(t.which){case 40:q(a(v).next(),true);break;case 38:q(a(v).prev(),false);break;case 13:var u=a("<p><br/></p>");u.insertAfter(v);h.selection.setAfter(v);h.selection.restore();h.undo.saveStep();break;case 8:case 46:var s=a(v).next(),r=true;if(s.length==0){s=a(v).prev();r=false}q(s,r);a(v).remove();h.undo.saveStep();break}t.preventDefault()}}function q(s,r){if(!!s.length){if(!c(s)){if(r){h.selection.setAtStart(s.get(0));h.selection.restore()}else{h.selection.setAtEnd(s.get(0));h.selection.restore()}}}}function e(r){g(r);if(r.isDefaultPrevented()){return false}}function l(r){if(r.target&&a(r.target).attr("data-ui-block")!==undefined){j(r,r.target)}if(r.isDefaultPrevented()){return false}}function b(r){var s=a("<div>"+r+"</div>");s.find("[data-video], [data-audio]").each(function(){a(this).removeAttr("contenteditable data-ui-block tabindex draggable").removeClass("fr-draggable fr-dragging")});return s.html()}function m(){h.events.on("initialized",f);h.events.on("html.set",f);h.events.on("html.get",b);h.events.on("keydown",e);h.events.on("destroy",n,true);h.$el.on("keydown","figure",l)}function n(){h.$el.off("keydown","figure",l)}return{_init:m,insert:k,insertVideo:i,insertAudio:p}}})(jQuery);