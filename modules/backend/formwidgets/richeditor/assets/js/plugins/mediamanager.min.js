(function(a){a.FroalaEditor.PLUGINS.mediaManager=function(d){function h(){new a.oc.mediaManager.popup({alias:"ocmediamanager",cropAndInsertButton:false,onInsert:function(m){if(!m.length){a.oc.alert(a.oc.lang.get("mediamanager.invalid_file_empty_insert"));return}if(m.length>1){a.oc.alert(a.oc.lang.get("mediamanager.invalid_file_single_insert"));return}var o,q=d.selection.text(),p=a.trim(q)==="";for(var n=0,l=m.length;n<l;n++){var q=p?m[n].title:q;o=m[n].publicUrl}d.events.focus(true);d.selection.restore();d.html.insert('<a href="'+o+'" id="fr-inserted-file" class="fr-file">'+q+"</a>");var k=d.$el.find("#fr-inserted-file");k.removeAttr("id");d.undo.saveStep();this.hide()}})}function i(){var k=d.image.get();new a.oc.mediaManager.popup({alias:"ocmediamanager",cropAndInsertButton:true,onInsert:function(m){if(!m.length){a.oc.alert(a.oc.lang.get("mediamanager.invalid_image_empty_insert"));return}var o=0;for(var n=0,l=m.length;n<l;n++){if(m[n].documentType!=="image"){a.oc.alert(a.oc.lang.get("mediamanager.invalid_image_invalid_insert",'The file "'+m[n].title+'" is not an image.'));continue}d.image.insert(m[n].publicUrl,false,{},k);o++;if(o==1){k=null}}if(o!==0){this.hide();d.undo.saveStep()}}})}function e(){new a.oc.mediaManager.popup({alias:"ocmediamanager",cropAndInsertButton:false,onInsert:function(k){if(!k.length){a.oc.alert(a.oc.lang.get("mediamanager.invalid_video_empty_insert"));return}if(k.length>1){a.oc.alert(a.oc.lang.get("mediamanager.invalid_file_single_insert"));return}var l=k[0];if(l.documentType!=="video"){a.oc.alert(a.oc.lang.get("mediamanager.invalid_video_invalid_insert",'The file "'+l.title+'" is not a video.'));return}var m=d.$el.closest('[data-control="richeditor"]');m.richEditor("insertVideo",l.publicUrl,l.title);this.hide()}})}function j(){new a.oc.mediaManager.popup({alias:"ocmediamanager",cropAndInsertButton:false,onInsert:function(k){if(!k.length){a.oc.alert(a.oc.lang.get("mediamanager.invalid_audio_empty_insert"));return}if(k.length>1){a.oc.alert(a.oc.lang.get("mediamanager.invalid_file_single_insert"));return}var l=k[0];if(l.documentType!=="audio"){a.oc.alert(a.oc.lang.get("mediamanager.invalid_audio_invalid_insert",'The file "'+l.title+'" is not an audio file.'));return}var m=d.$el.closest('[data-control="richeditor"]');m.richEditor("insertAudio",l.publicUrl,l.title);this.hide()}})}function c(k){var m=d.$el.closest('[data-control="richeditor"]');var l=k.substring(k.lastIndexOf("/")+1);m.richEditor("insertVideo",k,l);d.popups.hide("video.insert")}function b(k){var m=d.$el.closest('[data-control="richeditor"]');var l=k.substring(k.lastIndexOf("/")+1);m.richEditor("insertAudio",k,l);d.popups.hide("audio.insert")}function f(){d.events.on("destroy",g,true);d.events.on("video.linkError",c);d.events.on("audio.linkError",b)}function g(){}return{_init:f,insertFile:h,insertImage:i,insertVideo:e,insertAudio:j}};if(!a.FE.PLUGINS.link||!a.FE.PLUGINS.file||!a.FE.PLUGINS.image||!a.FE.PLUGINS.video){throw new Error("Media manager plugin requires link, file, image and video plugin.")}a.FE.DEFAULTS.imageInsertButtons.push("mmImageManager");a.FE.RegisterCommand("mmImageManager",{title:"Browse",undo:false,focus:false,callback:function(){this.mediaManager.insertImage()},plugin:"mediaManager"});a.FE.DefineIcon("mmImageManager",{NAME:"folder"});a.FE.DEFAULTS.fileInsertButtons.push("mmFileManager");a.FE.RegisterCommand("mmFileManager",{title:"Browse",undo:false,focus:false,callback:function(){this.mediaManager.insertFile()},plugin:"mediaManager"});a.FE.DefineIcon("mmFileManager",{NAME:"folder"});a.FE.DEFAULTS.videoInsertButtons.push("mmVideoManager");a.FE.RegisterCommand("mmVideoManager",{title:"Browse",undo:false,focus:false,callback:function(){this.mediaManager.insertVideo()},plugin:"mediaManager"});a.FE.DefineIcon("mmVideoManager",{NAME:"folder"});a.FE.DEFAULTS.audioInsertButtons.push("mmAudioManager");a.FE.RegisterCommand("mmAudioManager",{title:"Browse",undo:false,focus:false,callback:function(){this.mediaManager.insertAudio()},plugin:"mediaManager"});a.FE.DefineIcon("mmAudioManager",{NAME:"folder"})})(jQuery);