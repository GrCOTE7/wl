+function(d){if(d.oc.table===undefined){throw new Error("The $.oc.table namespace is not defined. Make sure that the table.js script is loaded.")}if(d.oc.table.processor===undefined){throw new Error("The $.oc.table.processor namespace is not defined. Make sure that the table.processor.base.js script is loaded.")}var c=d.oc.table.processor.base,b=c.prototype;var a=function(g,f,e){this.itemListElement=null;this.cachedOptionPromises={};this.itemClickHandler=this.onItemClick.bind(this);this.itemKeyDownHandler=this.onItemKeyDown.bind(this);c.call(this,g,f,e)};a.prototype=Object.create(b);a.prototype.constructor=a;a.prototype.dispose=function(){this.unregisterListHandlers();this.itemClickHandler=null;this.itemKeyDownHandler=null;this.itemListElement=null;this.cachedOptionPromises=null;b.dispose.call(this)};a.prototype.unregisterListHandlers=function(){if(this.itemListElement){this.itemListElement.removeEventListener("click",this.itemClickHandler);this.itemListElement.removeEventListener("keydown",this.itemKeyDownHandler)}};a.prototype.renderCell=function(g,h){var e=this.createViewContainer(h,"...");this.fetchOptions(h.parentNode,function f(i){if(i[g]!==undefined){e.textContent=i[g]}h.setAttribute("tabindex",0)})};a.prototype.onFocus=function(e,g){if(this.activeCell===e){this.showDropdown();return}this.activeCell=e;var f=this.getCellContentContainer(e);this.buildEditor(e,f,g);if(!g){f.focus()}};a.prototype.onUnfocus=function(){if(!this.activeCell){return}this.unregisterListHandlers();this.hideDropdown();this.itemListElement=null;this.activeCell=null};a.prototype.buildEditor=function(f,j,i){var h=this.tableObj.getCellValue(f),e=this.getAbsolutePosition(j);self=this;this.itemListElement=document.createElement("div");this.itemListElement.addEventListener("click",this.itemClickHandler);this.itemListElement.addEventListener("keydown",this.itemKeyDownHandler);this.itemListElement.setAttribute("class","table-control-dropdown-list");this.itemListElement.style.width=j.offsetWidth+"px";this.itemListElement.style.left=e.left+"px";this.itemListElement.style.top=e.top-2+j.offsetHeight+"px";this.fetchOptions(f,function g(k){var m=document.createElement("ul");for(var n in k){var l=document.createElement("li");l.setAttribute("data-value",n);l.textContent=k[n];l.setAttribute("tabindex",0);if(n==h){l.setAttribute("class","selected")}m.appendChild(l)}self.itemListElement.appendChild(m);if(i){self.showDropdown()}self=null})};a.prototype.hideDropdown=function(){if(this.itemListElement&&this.activeCell&&this.itemListElement.parentNode){var e=this.getCellContentContainer(this.activeCell);e.setAttribute("data-dropdown-open","false");this.itemListElement.parentNode.removeChild(this.itemListElement);e.focus()}};a.prototype.showDropdown=function(){if(this.itemListElement&&this.itemListElement.parentNode!==document.body){this.getCellContentContainer(this.activeCell).setAttribute("data-dropdown-open","true");document.body.appendChild(this.itemListElement);var e=this.itemListElement.querySelector("ul li.selected");if(!e){e=this.itemListElement.querySelector("ul li:first-child");if(e){e.setAttribute("class","selected")}}if(e){window.setTimeout(function(){e.focus()},0)}}};a.prototype.fetchOptions=function(k,i){if(this.columnConfiguration.options){i(this.columnConfiguration.options)}else{var m=k.parentNode,e=this.createOptionsCachingKey(m),l=this.getViewContainer(k);l.setAttribute("class","loading");if(!this.cachedOptionPromises[e]){var f={column:this.columnName,rowData:this.tableObj.getRowData(m)},g=this.tableObj.getAlias()+"::onGetDropdownOptions";this.cachedOptionPromises[e]=this.tableObj.$el.request(g,{data:f})}this.cachedOptionPromises[e].done(function j(n){i(n.options)}).always(function h(){l.setAttribute("class","")})}};a.prototype.createOptionsCachingKey=function(j){var g="non-dependent",f=this.columnConfiguration.dependsOn;if(f){if(typeof f=="object"){for(var h=0,e=f.length;h<e;h++){g+=f[h]+this.tableObj.getRowCellValueByColumnName(j,f[h])}}else{g=f+this.tableObj.getRowCellValueByColumnName(j,f)}}return g};a.prototype.getAbsolutePosition=function(e){var g=document.body.scrollTop,f=0;do{g+=e.offsetTop||0;g-=e.scrollTop||0;f+=e.offsetLeft||0;e=e.offsetParent}while(e);return{top:g,left:f}};a.prototype.updateCellFromSelectedItem=function(e){this.tableObj.setCellValue(this.activeCell,e.getAttribute("data-value"));this.setViewContainerValue(this.activeCell,e.textContent)};a.prototype.findSelectedItem=function(){if(this.itemListElement){return this.itemListElement.querySelector("ul li.selected")}return null};a.prototype.onItemClick=function(f){var g=this.tableObj.getEventTarget(f);if(g.tagName=="LI"){this.updateCellFromSelectedItem(g);var e=this.findSelectedItem();if(e){e.setAttribute("class","")}g.setAttribute("class","selected");this.hideDropdown()}};a.prototype.onItemKeyDown=function(g){if(!this.itemListElement){return}if(g.keyCode==40||g.keyCode==38){var f=this.findSelectedItem(),e=f.nextElementSibling;if(g.keyCode==38){e=f.previousElementSibling}if(e){f.setAttribute("class","");e.setAttribute("class","selected");e.focus()}return}if(g.keyCode==13||g.keyCode==32){this.updateCellFromSelectedItem(this.findSelectedItem());this.hideDropdown();return}if(g.keyCode==9){this.updateCellFromSelectedItem(this.findSelectedItem());this.tableObj.navigation.navigateNext(g);this.tableObj.stopEvent(g)}if(g.keyCode==27){this.hideDropdown()}};a.prototype.onKeyDown=function(e){if(e.keyCode==32){this.showDropdown()}};a.prototype.onRowValueChanged=function(f,l){if(!this.columnConfiguration.dependsOn){return}var g=false,m=this.columnConfiguration.dependsOn;if(typeof m=="object"){for(var h=0,j=m.length;h<j;h++){if(m[h]==f){g=true;break}}}else{g=m==f}if(!g){return}var k=this.tableObj.getCellValue(l),n=this.getViewContainer(l);this.fetchOptions(l,function e(i){var o=i[k]!==undefined?i[k]:"...";n.textContent=o;n=null})};a.prototype.elementBelongsToProcessor=function(e){if(!this.itemListElement){return false}return this.tableObj.parentContainsElement(this.itemListElement,e)};d.oc.table.processor.dropdown=a}(window.jQuery);