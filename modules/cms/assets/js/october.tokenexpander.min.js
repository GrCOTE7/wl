+function(b){var c=function(e,d){this.options=d;this.$el=b(e);this.something=false;this.init()};c.DEFAULTS={option:"default"};c.prototype.init=function(){this.$editor=this.$el.codeEditor("getEditorObject");this.$selection=this.$editor.getSelection();this.$session=this.$editor.getSession();this.tokenName=null;this.tokenValue=null;this.tokenDefinition=null;this.tokenRange=null;this.$selection.on("changeCursor",b.proxy(this.cursorChange,this))};c.prototype.cursorChange=function(d){var f=this.$selection.getCursor(),e=this.getActiveWord(f).toLowerCase();if(e=="component"){this.handleCursorOnToken(f,e)}else{if(this.tokenName){this.tokenName=null;this.tokenValue=null;this.tokenDefinition=null;this.tokenRange=null;this.$el.trigger("hide.oc.tokenexpander")}}};c.prototype.handleCursorOnToken=function(h,f){var d=this.$session.getLine(h.row),e=this.getTwigTokenDefinition(f,d,h.column);if(e){var g=this.getTwigTokenValue(f,e[0]);if(g){if(!this.tokenName){this.$el.trigger("show.oc.tokenexpander")}this.tokenName=f;this.tokenValue=g;this.tokenDefinition=e;this.tokenRange=this.$selection.getRange()}}};c.prototype.expandToken=function(h){var g=this.$editor,f=this.$session,e=this.tokenDefinition,d=this.tokenRange;g.setReadOnly(true);h(this.tokenName,this.tokenValue).done(function(i){d.setStart(d.start.row,e[1]);d.setEnd(d.end.row,e[2]);f.replace(d,i.result)}).always(function(){g.setReadOnly(false)})};c.prototype.getTwigTokenValue=function(e,f){var d=new RegExp("^{%\\s*"+e+"\\s(['\"])([^\"']+)(?:\\1)[^(?:%})]+%}$","i"),g=d.exec(f);if(g&&g[2]){return g[2]}return null};c.prototype.getTwigTokenDefinition=function(f,h,i,e){if(!e){e=0}var l=h.substring(e),j=new RegExp("{%\\s*"+f+"\\s[^(?:%})]+%}","i"),k=j.exec(l);if(k){var d=h.indexOf(k[0],e),g=d+k[0].length;if(d<i&&g>i){return[k[0],d,g]}return this.getTwigTokenDefinition(f,h,i,g)}return null};c.prototype.getActiveWord=function(f){var d=this.$session,g=d.getWordRange(f.row,f.column),e=d.getTextRange(g);return e};var a=b.fn.tokenExpander;b.fn.tokenExpander=function(e){var d=Array.prototype.slice.call(arguments,1),f;this.each(function(){var i=b(this);var h=i.data("oc.tokenexpander");var g=b.extend({},c.DEFAULTS,i.data(),typeof e=="object"&&e);if(!h){i.data("oc.tokenexpander",(h=new c(this,g)))}if(typeof e=="string"){f=h[e].apply(h,d)}if(typeof f!="undefined"){return false}});return f?f:this};b.fn.tokenExpander.Constructor=c;b.fn.tokenExpander.noConflict=function(){b.fn.tokenExpander=a;return this}}(window.jQuery);