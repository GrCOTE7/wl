+function(b){var a=function(d,c){this.$form=b(d);this.alias=c;this.$form.on("ajaxSuccess",b.proxy(this.onAjaxSuccess,this));this.$form.on("click","ul.list > li.directory > a",b.proxy(this.onDirectoryClick,this));this.$form.on("click","ul.list > li.file > a",b.proxy(this.onFileClick,this));this.$form.on("click","p.parent > a",b.proxy(this.onDirectoryClick,this));this.$form.on("click","a[data-control=delete-asset]",b.proxy(this.onDeleteClick,this));this.$form.on("oc.list.setActiveItem",b.proxy(this.onSetActiveItem,this));this.setupUploader()};a.prototype.onDirectoryClick=function(c){this.gotoDirectory(b(c.currentTarget).data("path"),b(c.currentTarget).parent().hasClass("parent"));return false};a.prototype.gotoDirectory=function(e,d){var f=b("div.list-container",this.$form),c=this;if(d!==undefined&&d){f.addClass("goBackward")}else{f.addClass("goForward")}b.oc.stripeLoadIndicator.show();this.$form.request(this.alias+"::onOpenDirectory",{data:{path:e,d:0.2},complete:function(){c.updateUi();f.trigger("oc.scrollbar.gotoStart")},error:function(g,i,h){f.removeClass("goForward goBackward");alert(g.responseText.length?g.responseText:g.statusText)}}).always(function(){b.oc.stripeLoadIndicator.hide()})};a.prototype.onDeleteClick=function(f){var d=b(f.currentTarget),c=this;if(!confirm(d.data("confirmation"))){return false}this.$form.request(this.alias+"::onDeleteFiles",{success:function(e){if(e.error!==undefined&&b.type(e.error)==="string"&&e.error.length){b.oc.flashMsg({text:e.error,"class":"error"})}},complete:function(){c.refresh()}});return false};a.prototype.onAjaxSuccess=function(){this.updateUi()};a.prototype.onUploadFail=function(c,d){if(!d){d="Error uploading file"}b.oc.alert(d);this.refresh()};a.prototype.onUploadSuccess=function(c,d){if(d!=="success"){b.oc.alert(d)}};a.prototype.onUploadComplete=function(c,d){b.oc.stripeLoadIndicator.hide();this.refresh()};a.prototype.onUploadStart=function(){b.oc.stripeLoadIndicator.show()};a.prototype.onFileClick=function(d){var c=b(d.currentTarget),g=c.parent();var f=b.Event("open.oc.list",{relatedTarget:g.get(0),clickEvent:d});this.$form.trigger(f,this);if(f.isDefaultPrevented()){return false}};a.prototype.onSetActiveItem=function(d,c){b("ul li.file",this.$form).removeClass("active");if(c){b('ul li.file[data-id="'+c+'"]',this.$form).addClass("active")}};a.prototype.updateUi=function(){b("button[data-control=asset-tools]",self.$form).trigger("oc.triggerOn.update")};a.prototype.refresh=function(){var c=this;this.$form.request(this.alias+"::onRefresh",{complete:function(){c.updateUi()}})};a.prototype.setupUploader=function(){var e=this,d=b('[data-control="upload-assets"]',this.$form),f={method:"POST",url:window.location,paramName:"file_data",previewsContainer:b("<div />").get(0),clickable:d.get(0)};var c=new Dropzone(b("<div />").get(0),f);c.on("error",b.proxy(e.onUploadFail,e));c.on("success",b.proxy(e.onUploadSuccess,e));c.on("complete",b.proxy(e.onUploadComplete,e));c.on("sending",function(g,i,h){b.each(e.$form.serializeArray(),function(j,k){h.append(k.name,k.value)});e.onUploadStart()})};b(document).ready(function(){new a(b("#asset-list-container").closest("form"),b("#asset-list-container").data("alias"))})}(window.jQuery);