+function(d){if(d.oc.mediaManager===undefined){d.oc.mediaManager={}}var b=d.oc.foundation.base,a=b.prototype;var c=function(e){this.$popupRootElement=null;this.options=d.extend({},c.DEFAULTS,e);b.call(this);this.init();this.show()};c.prototype=Object.create(a);c.prototype.constructor=c;c.prototype.dispose=function(){this.unregisterHandlers();this.$popupRootElement.remove();this.$popupRootElement=null;this.$popupElement=null;a.dispose.call(this)};c.prototype.init=function(){if(this.options.alias===undefined){throw new Error('Media Manager popup option "alias" is not set.')}this.$popupRootElement=d("<div/>");this.registerHandlers()};c.prototype.registerHandlers=function(){this.$popupRootElement.one("hide.oc.popup",this.proxy(this.onPopupHidden));this.$popupRootElement.one("shown.oc.popup",this.proxy(this.onPopupShown))};c.prototype.unregisterHandlers=function(){this.$popupElement.off("popupcommand",this.proxy(this.onPopupCommand));this.$popupRootElement.off("popupcommand",this.proxy(this.onPopupCommand))};c.prototype.show=function(){var e={bottomToolbar:this.options.bottomToolbar?1:0,cropAndInsertButton:this.options.cropAndInsertButton?1:0};this.$popupRootElement.popup({extraData:e,size:"adaptive",adaptiveHeight:true,handler:this.options.alias+"::onLoadPopup"})};c.prototype.hide=function(){if(this.$popupElement){this.$popupElement.trigger("close.oc.popup")}};c.prototype.getMediaManagerElement=function(){return this.$popupElement.find('[data-control="media-manager"]')};c.prototype.insertMedia=function(){var e=this.getMediaManagerElement().mediaManager("getSelectedItems");if(this.options.onInsert!==undefined){this.options.onInsert.call(this,e)}};c.prototype.insertCroppedImage=function(e){if(this.options.onInsert!==undefined){this.options.onInsert.call(this,[e])}};c.prototype.onPopupHidden=function(h,g,f){var e=this.getMediaManagerElement();e.mediaManager("dispose");e.remove();d(document).trigger("mousedown");this.dispose();if(this.options.onClose!==undefined){this.options.onClose.call(this)}};c.prototype.onPopupShown=function(g,f,e){this.$popupElement=e;this.$popupElement.on("popupcommand",this.proxy(this.onPopupCommand));this.getMediaManagerElement().mediaManager("selectFirstItem")};c.prototype.onPopupCommand=function(e,g,f){switch(g){case"insert":this.insertMedia();break;case"insert-cropped":this.insertCroppedImage(f);break}return false};c.DEFAULTS={alias:undefined,bottomToolbar:true,cropAndInsertButton:false,onInsert:undefined,onClose:undefined};d.oc.mediaManager.popup=c}(window.jQuery);