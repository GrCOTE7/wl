+function(e){var d=e.oc.foundation.base,c=d.prototype;var b=function(g,f){this.$el=e(g);this.options=f||{};e.oc.foundation.controlUtils.markDisposable(g);d.call(this);this.init()};b.prototype=Object.create(c);b.prototype.constructor=b;b.prototype.init=function(){var h=this,g=this.$el.closest("form"),f=g.data("oc.changeMonitor");if(f!==undefined){f.pause()}this.dbDateTimeFormat="YYYY-MM-DD HH:mm:ss";this.dbDateFormat="YYYY-MM-DD";this.dbTimeFormat="HH:mm:ss";this.$dataLocker=e("[data-datetime-value]",this.$el);this.$datePicker=e("[data-datepicker]",this.$el);this.$timePicker=e("[data-timepicker]",this.$el);this.hasDate=!!this.$datePicker.length;this.hasTime=!!this.$timePicker.length;this.initRegion();if(this.hasDate){this.initDatePicker()}if(this.hasTime){this.initTimePicker()}if(f!==undefined){f.resume()}this.$timePicker.on("change.oc.datepicker",function(){if(!e.trim(e(this).val())){h.emptyValues()}else{h.onSelectTimePicker()}});this.$datePicker.on("change.oc.datepicker",function(){if(!e.trim(e(this).val())){h.emptyValues()}});this.$el.one("dispose-control",this.proxy(this.dispose))};b.prototype.dispose=function(){this.$timePicker.off("change.oc.datepicker");this.$datePicker.off("change.oc.datepicker");this.$el.off("dispose-control",this.proxy(this.dispose));this.$el.removeData("oc.datePicker");this.$el=null;this.options=null;c.dispose.call(this)};b.prototype.initDatePicker=function(){var h=this,f=this.getDateFormat(),i=moment().tz(this.timezone).format(f);var g={yearRange:this.options.yearRange,format:f,setDefaultDate:i,onOpen:function(){var k=e(this._o.trigger);e(this.el).css({left:"auto",right:e(window).width()-k.offset().left-k.outerWidth()})},onSelect:function(){h.onSelectDatePicker.call(h,this.getMoment())}};var j=this.getLang("datepicker",false);if(j){g.i18n=j}this.$datePicker.val(this.getDataLockerValue(f));if(this.options.minDate){g.minDate=new Date(this.options.minDate)}if(this.options.maxDate){g.maxDate=new Date(this.options.maxDate)}this.$datePicker.pikaday(g)};b.prototype.onSelectDatePicker=function(i){var j=i.format(this.dbDateFormat);var h=this.getTimePickerValue();var g=moment.tz(j+" "+h,this.dbDateTimeFormat,this.timezone).tz(this.appTimezone);var f=g.format(this.dbDateTimeFormat);this.$dataLocker.val(f)};b.prototype.getDatePickerValue=function(){var f=this.$datePicker.val();if(!this.hasDate||!f){return moment.tz(this.appTimezone).tz(this.timezone).format(this.dbDateFormat)}return moment(f,this.getDateFormat()).format(this.dbDateFormat)};b.prototype.getDateFormat=function(){var f="YYYY-MM-DD";if(this.options.format){f=this.options.format}else{if(this.locale){f=moment().locale(this.locale).localeData().longDateFormat("l")}}return f};b.prototype.initTimePicker=function(){this.$timePicker.clockpicker({autoclose:"true",placement:"bottom",align:"right",twelvehour:this.isTimeTwelveHour()});this.$timePicker.val(this.getDataLockerValue(this.getTimeFormat()))};b.prototype.onSelectTimePicker=function(){var j=this.$timePicker.val();var i=moment(j,this.getTimeFormat()).format(this.dbTimeFormat);var h=this.getDatePickerValue();var g=moment.tz(h+" "+i,this.dbDateTimeFormat,this.timezone).tz(this.appTimezone);var f=g.format(this.dbDateTimeFormat);this.$dataLocker.val(f)};b.prototype.getTimePickerValue=function(){var f=this.$timePicker.val();if(!this.hasTime||!f){return moment.tz(this.appTimezone).tz(this.timezone).format(this.dbTimeFormat)}return moment(f,this.getTimeFormat()).format(this.dbTimeFormat)};b.prototype.getTimeFormat=function(){return this.isTimeTwelveHour()?"hh:mm A":"HH:mm"};b.prototype.isTimeTwelveHour=function(){return false};b.prototype.emptyValues=function(){this.$dataLocker.val("");this.$datePicker.val("");this.$timePicker.val("")};b.prototype.getDataLockerValue=function(g){var f=this.$dataLocker.val();return f?this.getMomentLoadValue(f,g):null};b.prototype.getMomentLoadValue=function(g,h){var f=moment.tz(g,this.appTimezone);if(this.locale){f=f.locale(this.locale)}f=f.tz(this.timezone);return f.format(h)};b.prototype.initRegion=function(){this.locale=e('meta[name="backend-locale"]').attr("content");this.timezone=e('meta[name="backend-timezone"]').attr("content");this.appTimezone=e('meta[name="app-timezone"]').attr("content");if(!this.appTimezone){this.appTimezone="UTC"}if(!this.timezone){this.timezone="UTC"}};b.prototype.getLang=function(g,f){if(e.oc===undefined||e.oc.lang===undefined){return f}return e.oc.lang.get(g,f)};b.DEFAULTS={minDate:null,maxDate:null,format:null,yearRange:10};var a=e.fn.datePicker;e.fn.datePicker=function(i){var h=Array.prototype.slice.call(arguments,1),g,f;g=this.each(function(){var l=e(this);var k=l.data("oc.datePicker");var j=e.extend({},b.DEFAULTS,l.data(),typeof i=="object"&&i);if(!k){l.data("oc.datePicker",(k=new b(this,j)))}if(typeof i=="string"){f=k[i].apply(k,h)}if(typeof f!="undefined"){return false}});return f?f:g};e.fn.datePicker.Constructor=b;e.fn.datePicker.noConflict=function(){e.fn.datePicker=a;return this};e(document).on("render",function(){e('[data-control="datepicker"]').datePicker()})}(window.jQuery);