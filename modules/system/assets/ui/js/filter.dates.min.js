+function(c){var a=c.fn.filterWidget.Constructor;var b=a.prototype.init;a.prototype.init=function(){b.apply(this);this.initRegion();this.initFilterDate()};a.prototype.initFilterDate=function(){var d=this;this.$el.on("show.oc.popover","a.filter-scope-date",function(){d.initDatePickers(c(this).hasClass("range"))});this.$el.on("hiding.oc.popover","a.filter-scope-date",function(){d.clearDatePickers()});this.$el.on("hide.oc.popover","a.filter-scope-date",function(){var e=c(this);d.pushOptions(d.activeScopeName);d.activeScopeName=null;d.$activeScope=null;setTimeout(function(){e.removeClass("filter-scope-open")},200)});this.$el.on("click","a.filter-scope-date",function(){var f=c(this),e=f.data("scope-name");if(f.hasClass("filter-scope-open")){return}if(null!==d.activeScopeName){return}d.$activeScope=f;d.activeScopeName=e;d.isActiveScopeDirty=false;if(f.hasClass("range")){d.displayPopoverRange(f)}else{d.displayPopoverDate(f)}f.addClass("filter-scope-open")});c(document).on("click",'#controlFilterPopover [data-trigger="filter"]',function(f){f.preventDefault();f.stopPropagation();d.filterByDate()});c(document).on("click",'#controlFilterPopover [data-trigger="clear"]',function(f){f.preventDefault();f.stopPropagation();d.filterByDate(true)})};a.prototype.getPopoverDateTemplate=function(){return'                                                                                                                        <form>                                                                                                                      <input type="hidden" name="scopeName" value="{{ scopeName }}" />                                                        <div id="controlFilterPopover" class="control-filter-popover control-filter-box-popover">                                   <div class="filter-search loading-indicator-container size-input-text">                                                     <div class="field-datepicker">                                                                                              <div class="input-with-icon right-align">                                                                                   <i class="icon icon-calendar-o"></i>                                                                                    <input                                                                                                                      type="text"                                                                                                             name="date"                                                                                                             value="{{ date }}"                                                                                                      class="form-control align-right popup-allow-focus"                                                                      autocomplete="off"                                                                                                      placeholder="{{ date_placeholder }}" />                                                                         </div>                                                                                                              </div>                                                                                                                  <div class="filter-buttons">                                                                                                <button class="btn btn-block btn-secondary" data-trigger="clear">                                                           {{ reset_button_text }}                                                                                             </button>                                                                                                           </div>                                                                                                              </div>                                                                                                              </div>                                                                                                              </form>                                                                                                             '};a.prototype.getPopoverRangeTemplate=function(){return'                                                                                                                        <form>                                                                                                                      <input type="hidden" name="scopeName" value="{{ scopeName }}" />                                                        <div id="controlFilterPopover" class="control-filter-popover control-filter-box-popover --range">                           <div class="filter-search loading-indicator-container size-input-text">                                                     <div class="field-datepicker">                                                                                              <div class="input-with-icon right-align">                                                                                   <i class="icon icon-calendar-o"></i>                                                                                    <input                                                                                                                      type="text"                                                                                                             name="date"                                                                                                             value="{{ date }}"                                                                                                      class="form-control align-right popup-allow-focus"                                                                      autocomplete="off"                                                                                                      placeholder="{{ after_placeholder }}" />                                                                        </div>                                                                                                              </div>                                                                                                                  <div class="field-datepicker">                                                                                              <div class="input-with-icon right-align">                                                                                   <i class="icon icon-calendar-o"></i>                                                                                    <input                                                                                                                      type="text"                                                                                                             name="date"                                                                                                             value="{{ date }}"                                                                                                      class="form-control align-right"                                                                                        autocomplete="off"                                                                                                      placeholder="{{ before_placeholder }}" />                                                                       </div>                                                                                                              </div>                                                                                                                  <div class="filter-buttons">                                                                                                <button class="btn btn-block btn-primary" data-trigger="filter">                                                            {{ filter_button_text }}                                                                                            </button>                                                                                                               <button class="btn btn-block btn-secondary" data-trigger="clear">                                                           {{ reset_button_text }}                                                                                             </button>                                                                                                           </div>                                                                                                              </div>                                                                                                              </div>                                                                                                              </form>                                                                                                             '};a.prototype.displayPopoverDate=function(f){var e=this,d=f.data("scope-name"),g=this.scopeValues[d];g=c.extend({},g,{filter_button_text:this.getLang("filter.dates.filter_button_text"),reset_button_text:this.getLang("filter.dates.reset_button_text"),date_placeholder:this.getLang("filter.dates.date_placeholder","Date")});g.scopeName=d;f.data("oc.popover",null);f.ocPopover({content:Mustache.render(this.getPopoverDateTemplate(),g),modal:false,highlightModalTarget:true,closeOnPageClick:true,placement:"bottom",onCheckDocumentClickTarget:function(h){return e.onCheckDocumentClickTargetDatePicker(h)}})};a.prototype.displayPopoverRange=function(f){var e=this,d=f.data("scope-name"),g=this.scopeValues[d];g=c.extend({},g,{filter_button_text:this.getLang("filter.dates.filter_button_text"),reset_button_text:this.getLang("filter.dates.reset_button_text"),after_placeholder:this.getLang("filter.dates.after_placeholder","After"),before_placeholder:this.getLang("filter.dates.before_placeholder","Before")});g.scopeName=d;f.data("oc.popover",null);f.ocPopover({content:Mustache.render(this.getPopoverRangeTemplate(),g),modal:false,highlightModalTarget:true,closeOnPageClick:true,placement:"bottom",onCheckDocumentClickTarget:function(h){return e.onCheckDocumentClickTargetDatePicker(h)}})};a.prototype.initDatePickers=function(g){var d=this,f=this.$activeScope.data("scope-data"),e=c(".field-datepicker input","#controlFilterPopover"),h=this.scopeValues[this.activeScopeName];if(!h){h={dates:g?(f.dates?f.dates:[]):(f.date?[f.date]:[])}}e.each(function(j,l){var i="",k=c(l),m={minDate:new Date(f.minDate),maxDate:new Date(f.maxDate),firstDay:f.firstDay,yearRange:f.yearRange,setDefaultDate:""!==i?i.toDate():"",format:d.getDateFormat(),i18n:d.getLang("datepicker")};if(0<=j&&j<h.dates.length){i=h.dates[j]?moment.tz(h.dates[j],d.appTimezone).tz(d.timezone):""}if(!g){m.onSelect=function(){d.filterByDate()}}l.value=""!==i?i.format(d.getDateFormat()):"";k.pikaday(m)})};a.prototype.clearDatePickers=function(){var d=c(".field-datepicker input","#controlFilterPopover");d.each(function(e,g){var f=c(g);f.data("pikaday").destroy()})};a.prototype.updateScopeDateSetting=function(e,j){var g=e.find(".filter-setting"),d=this.getDateFormat(),f=/\d{4}-\d{2}-\d{2} \d{2}:\d{2}:\d{2}/,h=false;if(j&&j.length){j[0]=j[0]&&j[0].match(f)?j[0]:null;if(j.length>1){j[1]=j[1]&&j[1].match(f)?j[1]:null;if(j[0]||j[1]){var k=j[0]?moment.tz(j[0],this.appTimezone).tz(this.timezone).format(d):"∞",i=j[1]?moment.tz(j[1],this.appTimezone).tz(this.timezone).format(d):"∞";g.text(k+" → "+i)}else{h=true}}else{if(j[0]){g.text(moment.tz(j[0],this.appTimezone).tz(this.timezone).format(d))}else{h=true}}}else{h=true}if(h){g.text(this.getLang("filter.dates.all","all"));e.removeClass("active")}else{e.addClass("active")}};a.prototype.filterByDate=function(g){var d=this,f=[];if(!g){var e=c(".field-datepicker input","#controlFilterPopover");e.each(function(i,j){var h=c(j).data("pikaday").toString("YYYY-MM-DD");if(h.match(/\d{4}-\d{2}-\d{2}/)){if(i===0){h+=" 00:00:00"}else{if(i===1){h+=" 23:59:59"}}h=moment.tz(h,d.timezone).tz(d.appTimezone).format("YYYY-MM-DD HH:mm:ss")}else{h=null}f.push(h)})}this.updateScopeDateSetting(this.$activeScope,f);this.scopeValues[this.activeScopeName]={dates:f};this.isActiveScopeDirty=true;this.$activeScope.data("oc.popover").hide()};a.prototype.getDateFormat=function(){if(this.locale){return moment().locale(this.locale).localeData().longDateFormat("l")}return"YYYY-MM-DD"};a.prototype.onCheckDocumentClickTargetDatePicker=function(e){var d=c(e);return d.hasClass("pika-next")||d.hasClass("pika-prev")||d.hasClass("pika-select")||d.hasClass("pika-button")||d.parents(".pika-table").length||d.parents(".pika-title").length};a.prototype.initRegion=function(){this.locale=c('meta[name="backend-locale"]').attr("content");this.timezone=c('meta[name="backend-timezone"]').attr("content");this.appTimezone=c('meta[name="app-timezone"]').attr("content");if(!this.appTimezone){this.appTimezone="UTC"}if(!this.timezone){this.timezone="UTC"}}}(window.jQuery);