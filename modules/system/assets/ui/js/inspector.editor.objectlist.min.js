+function(d){var c=d.oc.inspector.propertyEditors.base,b=c.prototype;var a=function(h,g,e,f){this.currentRowInspector=null;this.popup=null;if(g.titleProperty===undefined){throw new Error("The titleProperty property should be specified in the objectList editor configuration. Property: "+g.property)}if(g.itemProperties===undefined){throw new Error("The itemProperties property should be specified in the objectList editor configuration. Property: "+g.property)}c.call(this,h,g,e,f)};a.prototype=Object.create(b);a.prototype.constructor=c;a.prototype.init=function(){if(this.isKeyValueMode()){var e=this.getKeyProperty();if(!e){throw new Error("Object list key property "+this.propertyDefinition.keyProperty+" is not defined in itemProperties. Property: "+this.propertyDefinition.property)}}b.init.call(this)};a.prototype.dispose=function(){this.unregisterHandlers();this.removeControls();this.currentRowInspector=null;this.popup=null;b.dispose.call(this)};a.prototype.supportsExternalParameterEditor=function(){return false};a.prototype.build=function(){var e=document.createElement("a");d.oc.foundation.element.addClass(e,"trigger");e.setAttribute("href","#");this.setLinkText(e);d.oc.foundation.element.addClass(this.containerCell,"trigger-cell");this.containerCell.appendChild(e)};a.prototype.setLinkText=function(e,f){var f=f!==undefined&&f!==null?f:this.inspector.getPropertyValue(this.propertyDefinition.property);if(f===null){f=undefined}if(f===undefined){var h=this.propertyDefinition.placeholder;if(h!==undefined){d.oc.foundation.element.addClass(e,"placeholder");e.textContent=h}else{e.textContent="Items: 0"}}else{var g=0;if(!this.isKeyValueMode()){if(f.length===undefined){throw new Error("Object list value should be an array. Property: "+this.propertyDefinition.property)}g=f.length}else{if(typeof f!=="object"){throw new Error("Object list value should be an object. Property: "+this.propertyDefinition.property)}g=this.getValueKeys(f).length}d.oc.foundation.element.removeClass(e,"placeholder");e.textContent="Items: "+g}};a.prototype.getPopupContent=function(){return'<form>                                                                                                  <div class="modal-header">                                                                                  <button type="button" class="close" data-dismiss="popup">&times;</button>                               <h4 class="modal-title">{{property}}</h4>                                                           </div>                                                                                                  <div>                                                                                                       <div class="layout inspector-columns-editor">                                                               <div class="layout-row">                                                                                    <div class="layout-cell items-column">                                                                      <div class="layout-relative">                                                                               <div class="layout">                                                                                        <div class="layout-row min-size">                                                                           <div class="control-toolbar toolbar-padded">                                                                <div class="toolbar-item">                                                                                  <div class="btn-group">                                                                                     <button type="button" class="btn btn-primary                                                                oc-icon-plus"                                                                                           data-cmd="create-item">Add</button>                                                                 <button type="button" class="btn btn-default                                                                empty oc-icon-trash-o"                                                                                  data-cmd="delete-item"></button>                                                                </div>                                                                                              </div>                                                                                              </div>                                                                                              </div>                                                                                                  <div class="layout-row">                                                                                    <div class="layout-cell">                                                                                   <div class="layout-relative">                                                                               <div class="layout-absolute">                                                                               <div class="control-scrollpad"                                                                              data-control="scrollpad">                                                                               <div class="scroll-wrapper">                                                                                <table class="table data                                                                                    no-offset-bottom                                                                                        inspector-table-list">                                                                              </table>                                                                                            </div>                                                                                              </div>                                                                                              </div>                                                                                              </div>                                                                                              </div>                                                                                              </div>                                                                                              </div>                                                                                              </div>                                                                                              </div>                                                                                                  <div class="layout-cell">                                                                                   <div class="layout-relative">                                                                               <div class="layout-absolute">                                                                               <div class="control-scrollpad" data-control="scrollpad">                                                    <div class="scroll-wrapper inspector-wrapper">                                                              <div data-inspector-container>                                                                          </div>                                                                                              </div>                                                                                              </div>                                                                                              </div>                                                                                              </div>                                                                                              </div>                                                                                              </div>                                                                                              </div>                                                                                              </div>                                                                                                  <div class="modal-footer">                                                                                  <button type="submit" class="btn btn-primary">OK</button>                                               <button type="button" class="btn btn-default" data-dismiss="popup">Cancel</button>                  </div>                                                                                                  </form>'};a.prototype.buildPopupContents=function(e){this.buildItemsTable(e)};a.prototype.buildItemsTable=function(e){var n=e.querySelector("table"),g=document.createElement("tbody"),i=this.inspector.getPropertyValue(this.propertyDefinition.property),j=this.propertyDefinition.titleProperty;if(i===undefined||this.getValueKeys(i).length===0){var o=this.buildEmptyRow();g.appendChild(o)}else{var f=undefined;for(var l in i){var m=i[l],h=this.addKeyProperty(l,m),k=m[j],o=this.buildTableRow(k,"rowlink");o.setAttribute("data-inspector-values",JSON.stringify(h));g.appendChild(o);if(f===undefined){f=o}}}n.appendChild(g);if(f!==undefined){this.selectRow(f,true)}this.updateScrollpads()};a.prototype.buildEmptyRow=function(){return this.buildTableRow("No items found","no-data","nolink")};a.prototype.removeEmptyRow=function(){var e=this.getTableBody(),f=e.querySelector("tr.no-data");if(f){e.removeChild(f)}};a.prototype.buildTableRow=function(i,f,g){var h=document.createElement("tr"),e=document.createElement("td");e.textContent=i;if(f!==undefined){d.oc.foundation.element.addClass(h,f)}if(g!==undefined){d.oc.foundation.element.addClass(e,g)}h.appendChild(e);return h};a.prototype.updateScrollpads=function(){d(".control-scrollpad",this.popup).scrollpad("update")};a.prototype.selectRow=function(i,f){var e=i.parentNode,h=this.getInspectorContainer(),g=this.getSelectedRow();if(g===i&&!f){return}if(g){if(!this.validateKeyValue()){return}if(this.currentRowInspector){if(!this.currentRowInspector.validate()){return}}this.applyDataToRow(g);d.oc.foundation.element.removeClass(g,"active")}this.disposeInspector();d.oc.foundation.element.addClass(i,"active");this.createInspectorForRow(i,h)};a.prototype.createInspectorForRow=function(j,i){var g=j.getAttribute("data-inspector-values");if(g===undefined||typeof g!=="string"){throw new Error("Values not found for the selected row.")}var h=this.propertyDefinition.itemProperties,e=d.parseJSON(g),f={enableExternalParameterEditor:false,onChange:this.proxy(this.onInspectorDataChange),inspectorClass:this.inspector.options.inspectorClass};this.currentRowInspector=new d.oc.inspector.surface(i,h,e,d.oc.inspector.helpers.generateElementUniqueId(i),f)};a.prototype.disposeInspector=function(){d.oc.foundation.controlUtils.disposeControls(this.popup.querySelector("[data-inspector-container]"));this.currentRowInspector=null};a.prototype.applyDataToRow=function(f){if(this.currentRowInspector===null){return}var e=this.currentRowInspector.getValues();f.setAttribute("data-inspector-values",JSON.stringify(e))};a.prototype.updateRowText=function(g,f){var e=this.getSelectedRow();if(!e){throw new Exception("A row is not found for the updated data")}if(g!==this.propertyDefinition.titleProperty){return}f=d.trim(f);if(f.length===0){f="[No title]";d.oc.foundation.element.addClass(e,"disabled")}else{d.oc.foundation.element.removeClass(e,"disabled")}e.firstChild.textContent=f};a.prototype.getSelectedRow=function(){if(!this.popup){throw new Error("Trying to get selected row without a popup reference.")}var g=this.getTableBody().children;for(var f=0,e=g.length;f<e;f++){if(d.oc.foundation.element.hasClass(g[f],"active")){return g[f]}}return null};a.prototype.createItem=function(){var f=this.getSelectedRow();if(f){if(!this.validateKeyValue()){return}if(this.currentRowInspector){if(!this.currentRowInspector.validate()){return}}this.applyDataToRow(f);d.oc.foundation.element.removeClass(f,"active")}this.disposeInspector();var i="New item",h=this.buildTableRow(i,"rowlink active"),e=this.getTableBody(),g={};g[this.propertyDefinition.titleProperty]=i;h.setAttribute("data-inspector-values",JSON.stringify(g));e.appendChild(h);this.selectRow(h,true);this.removeEmptyRow();this.updateScrollpads()};a.prototype.deleteItem=function(){var h=this.getSelectedRow();if(!h){return}var g=h.nextElementSibling,i=h.previousElementSibling,e=this.getTableBody();this.disposeInspector();e.removeChild(h);var f=g?g:i;if(f){this.selectRow(f)}else{e.appendChild(this.buildEmptyRow())}this.updateScrollpads()};a.prototype.applyDataToParentInspector=function(){var k=this.getSelectedRow(),j=this.getTableBody(),e=j.querySelectorAll("tr[data-inspector-values]"),n=this.getLink(),o=this.getEmptyValue();if(k){if(!this.validateKeyValue()){return}if(this.currentRowInspector){if(!this.currentRowInspector.validate()){return}}this.applyDataToRow(k)}for(var h=0,l=e.length;h<l;h++){var m=e[h],g=d.parseJSON(m.getAttribute("data-inspector-values"));if(!this.isKeyValueMode()){o.push(g)}else{var f=g[this.propertyDefinition.keyProperty];o[f]=this.removeKeyProperty(g)}}this.inspector.setPropertyValue(this.propertyDefinition.property,o);this.setLinkText(n,o);d(n).popup("hide");return false};a.prototype.validateKeyValue=function(){if(!this.isKeyValueMode()){return true}if(this.currentRowInspector===null){return true}var h=this.currentRowInspector.getValues(),g=this.propertyDefinition.keyProperty;if(h[g]===undefined){throw new Error("Key property "+g+" is not found in the Inspector data. Property: "+this.propertyDefinition.property)}var p=h[g],o=this.getKeyProperty().title;if(typeof p!=="string"){throw new Error("Key property ("+g+") value should be a string. Property: "+this.propertyDefinition.property)}if(d.trim(p).length===0){d.oc.flashMsg({text:"The value of key property "+o+" cannot be empty.","class":"error",interval:3});return false}var m=this.getSelectedRow(),k=this.getTableBody(),e=k.querySelectorAll("tr[data-inspector-values]");for(var j=0,l=e.length;j<l;j++){var n=e[j],f=d.parseJSON(n.getAttribute("data-inspector-values"));if(m==n){continue}if(f[g]==p){d.oc.flashMsg({text:"The value of key property "+o+" should be unique.","class":"error",interval:3});return false}}return true};a.prototype.getLink=function(){return this.containerCell.querySelector("a.trigger")};a.prototype.getPopupFormElement=function(){var e=this.popup.querySelector("form");if(!e){this.throwError("Cannot find form element in the popup window.")}return e};a.prototype.getInspectorContainer=function(){return this.popup.querySelector("div[data-inspector-container]")};a.prototype.getTableBody=function(){return this.popup.querySelector("table.inspector-table-list tbody")};a.prototype.isKeyValueMode=function(){return this.propertyDefinition.keyProperty!==undefined};a.prototype.getKeyProperty=function(){for(var f=0,e=this.propertyDefinition.itemProperties.length;f<e;f++){var g=this.propertyDefinition.itemProperties[f];if(g.property==this.propertyDefinition.keyProperty){return g}}};a.prototype.getValueKeys=function(g){var e=[];for(var f in g){e.push(f)}return e};a.prototype.addKeyProperty=function(e,f){if(!this.isKeyValueMode()){return f}f[this.propertyDefinition.keyProperty]=e;return f};a.prototype.removeKeyProperty=function(f){if(!this.isKeyValueMode()){return f}var e=f;if(e[this.propertyDefinition.keyProperty]!==undefined){delete e[this.propertyDefinition.keyProperty]}return e};a.prototype.getEmptyValue=function(){if(this.isKeyValueMode()){return{}}else{return[]}};a.prototype.registerHandlers=function(){var f=this.getLink(),e=d(f);f.addEventListener("click",this.proxy(this.onTriggerClick));e.on("shown.oc.popup",this.proxy(this.onPopupShown));e.on("hidden.oc.popup",this.proxy(this.onPopupHidden))};a.prototype.unregisterHandlers=function(){var f=this.getLink(),e=d(f);f.removeEventListener("click",this.proxy(this.onTriggerClick));e.off("shown.oc.popup",this.proxy(this.onPopupShown));e.off("hidden.oc.popup",this.proxy(this.onPopupHidden))};a.prototype.onTriggerClick=function(f){d.oc.foundation.event.stop(f);var e=this.getPopupContent();e=e.replace("{{property}}",this.propertyDefinition.title);d(f.target).popup({content:e});return false};a.prototype.onPopupShown=function(g,f,e){d(e).on("submit.inspector","form",this.proxy(this.onSubmit));d(e).on("click","tr.rowlink",this.proxy(this.onRowClick));d(e).on("click.inspector","[data-cmd]",this.proxy(this.onCommand));this.popup=e.get(0);this.buildPopupContents(this.popup);this.getRootSurface().popupDisplayed()};a.prototype.onPopupHidden=function(g,f,e){d(e).off(".inspector",this.proxy(this.onSubmit));d(e).off("click","tr.rowlink",this.proxy(this.onRowClick));d(e).off("click.inspector","[data-cmd]",this.proxy(this.onCommand));this.disposeInspector();d.oc.foundation.controlUtils.disposeControls(this.popup);this.popup=null;this.getRootSurface().popupHidden()};a.prototype.onSubmit=function(e){this.applyDataToParentInspector();e.preventDefault();return false};a.prototype.onRowClick=function(e){this.selectRow(e.currentTarget)};a.prototype.onInspectorDataChange=function(f,e){this.updateRowText(f,e)};a.prototype.onCommand=function(e){var f=e.currentTarget.getAttribute("data-cmd");switch(f){case"create-item":this.createItem();break;case"delete-item":this.deleteItem();break}};a.prototype.removeControls=function(){if(this.popup){this.disposeInspector(this.popup)}};d.oc.inspector.propertyEditors.objectList=a}(window.jQuery);