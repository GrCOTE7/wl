+function(c){if(c.oc===undefined){c.oc={}}if(c.oc.inspector===undefined){c.oc.inspector={}}var b=c.oc.foundation.base,a=b.prototype;var d=function(h,g,f,e){this.inspector=h;this.propertyDefinition=g;this.containerCell=f;this.initialValue=e;b.call(this);this.init()};d.prototype=Object.create(a);d.prototype.constructor=b;d.prototype.dispose=function(){this.disposeControls();this.unregisterHandlers();this.inspector=null;this.propertyDefinition=null;this.containerCell=null;this.initialValue=null;a.dispose.call(this)};d.prototype.init=function(){this.tooltipText="Click to enter the external parameter name to load the property value from";this.build();this.registerHandlers();this.setInitialValue()};d.prototype.build=function(){var e=document.createElement("div"),i=document.createElement("div"),g=document.createElement("div"),f=document.createElement("input"),j=document.createElement("a"),h=document.createElement("i");e.setAttribute("class","external-param-editor-container");i.setAttribute("class","external-editor");g.setAttribute("class","controls");f.setAttribute("type","text");f.setAttribute("tabindex","-1");j.setAttribute("href","#");j.setAttribute("class","external-editor-link");j.setAttribute("tabindex","-1");j.setAttribute("title",this.tooltipText);c(j).tooltip({container:"body",delay:500});h.setAttribute("class","oc-icon-terminal");j.appendChild(h);g.appendChild(f);g.appendChild(j);i.appendChild(g);while(this.containerCell.firstChild){var k=this.containerCell.firstChild;e.appendChild(k)}e.appendChild(i);this.containerCell.appendChild(e)};d.prototype.setInitialValue=function(){if(!this.initialValue){return}if(typeof this.initialValue!=="string"){return}var f=[];if(f=this.initialValue.match(/^\{\{([^\}]+)\}\}$/)){var e=c.trim(f[1]);if(e.length>0){this.showEditor(true);this.getInput().value=e;this.inspector.setPropertyValue(this.propertyDefinition.property,null,true,true)}}};d.prototype.showEditor=function(h){var i=this.getEditor(),g=this.getInput(),f=this.getContainer(),j=this.getLink();var e=c(i).position();if(!h){i.style.right=0;i.style.left=e.left+"px"}else{i.style.right=0}setTimeout(this.proxy(this.repositionEditor),0);c.oc.foundation.element.addClass(f,"editor-visible");j.setAttribute("data-original-title","Click to enter the property value");this.toggleEditorVisibility(false);g.setAttribute("tabindex",0);if(!h){g.focus()}};d.prototype.repositionEditor=function(){this.getEditor().style.left=0;this.containerCell.scrollTop=0};d.prototype.hideEditor=function(){var g=this.getEditor(),f=this.getContainer();g.style.left="auto";g.style.right="30px";c.oc.foundation.element.removeClass(f,"editor-visible");c.oc.foundation.element.removeClass(this.containerCell,"active");var e=this.inspector.findPropertyEditor(this.propertyDefinition.property);if(e){e.onExternalPropertyEditorHidden()}};d.prototype.toggleEditor=function(h){c.oc.foundation.event.stop(h);var g=this.getLink(),e=this.getContainer(),f=this.getEditor();c(g).tooltip("hide");if(!this.isEditorVisible()){this.showEditor();return}var i=e.offsetWidth;f.style.left=i+"px";g.setAttribute("data-original-title",this.tooltipText);this.getInput().setAttribute("tabindex","-1");this.toggleEditorVisibility(true);setTimeout(this.proxy(this.hideEditor),200)};d.prototype.toggleEditorVisibility=function(h){var g=this.getContainer(),l=g.children,f=0;if(!h){f=this.containerCell.getAttribute("data-inspector-cell-height");if(!f){f=c(this.containerCell).height();this.containerCell.setAttribute("data-inspector-cell-height",f)}}f=Math.max(f,19);for(var k=0,e=l.length;k<e;k++){var j=l[k];if(c.oc.foundation.element.hasClass(j,"external-editor")){continue}if(h){c.oc.foundation.element.removeClass(j,"hide")}else{g.style.height=f+"px";c.oc.foundation.element.addClass(j,"hide")}}};d.prototype.focus=function(){this.getInput().focus()};d.prototype.validate=function(e){var f=c.trim(this.getValue());if(f.length===0){if(!e){c.oc.flashMsg({text:"Please enter the external parameter name.","class":"error",interval:5});this.focus()}return false}return true};d.prototype.registerHandlers=function(){var e=this.getInput();this.getLink().addEventListener("click",this.proxy(this.toggleEditor));e.addEventListener("focus",this.proxy(this.onInputFocus));e.addEventListener("change",this.proxy(this.onInputChange))};d.prototype.onInputFocus=function(){this.inspector.makeCellActive(this.containerCell)};d.prototype.onInputChange=function(){this.inspector.markPropertyChanged(this.propertyDefinition.property,true)};d.prototype.unregisterHandlers=function(){var e=this.getInput();this.getLink().removeEventListener("click",this.proxy(this.toggleEditor));e.removeEventListener("focus",this.proxy(this.onInputFocus));e.removeEventListener("change",this.proxy(this.onInputChange))};d.prototype.disposeControls=function(){c(this.getLink()).tooltip("destroy")};d.prototype.getInput=function(){return this.containerCell.querySelector("div.external-editor input")};d.prototype.getValue=function(){return this.getInput().value};d.prototype.getLink=function(){return this.containerCell.querySelector("a.external-editor-link")};d.prototype.getContainer=function(){return this.containerCell.querySelector("div.external-param-editor-container")};d.prototype.getEditor=function(){return this.containerCell.querySelector("div.external-editor")};d.prototype.getPropertyName=function(){return this.propertyDefinition.property};d.prototype.isEditorVisible=function(){return c.oc.foundation.element.hasClass(this.getContainer(),"editor-visible")};c.oc.inspector.externalParameterEditor=d}(window.jQuery);