+function(d){if(d.oc.inspector===undefined){d.oc.inspector={}}if(d.oc.inspector.wrappers===undefined){d.oc.inspector.wrappers={}}var c=d.oc.foundation.base,b=c.prototype;var a=function(e,g,f){this.$element=e;this.options=d.extend({},a.DEFAULTS,typeof f=="object"&&f);this.switched=false;this.configuration=null;c.call(this);if(!g){if(!this.triggerShowingAndInit()){return}this.surface=null;this.title=null;this.description=null}else{this.surface=g.surface;this.title=g.title;this.description=g.description;g=null;this.init()}};a.prototype=Object.create(b);a.prototype.constructor=c;a.prototype.dispose=function(){if(!this.switched){this.$element.removeClass("inspector-open");this.setInspectorVisibleFlag(false);this.$element.trigger("hidden.oc.inspector")}if(this.surface!==null&&this.surface.options.onGetInspectableElement===this.proxy(this.onGetInspectableElement)){this.surface.options.onGetInspectableElement=null}this.surface=null;this.$element=null;this.title=null;this.description=null;this.configuration=null;b.dispose.call(this)};a.prototype.init=function(){if(!this.surface){this.loadConfiguration()}else{this.adoptSurface()}this.$element.addClass("inspector-open")};a.prototype.getElementValuesInput=function(){return this.$element.find("> input[data-inspector-values]")};a.prototype.normalizePropertyCode=function(f,i){var h=f.toLowerCase();for(var e in i){var g=i[e];if(g.property.toLowerCase()==h){return g.property}}return f};a.prototype.isExternalParametersEditorEnabled=function(){return this.$element.closest("[data-inspector-external-parameters]").length>0};a.prototype.initSurface=function(h,g,e){var f=this.$element.data()||{};f.enableExternalParameterEditor=this.isExternalParametersEditorEnabled();f.onGetInspectableElement=this.proxy(this.onGetInspectableElement);this.surface=new d.oc.inspector.surface(h,g,e,d.oc.inspector.helpers.generateElementUniqueId(this.$element.get(0)),f)};a.prototype.isLiveUpdateEnabled=function(){return false};a.prototype.createSurfaceAndUi=function(f,e){};a.prototype.setInspectorVisibleFlag=function(e){this.$element.data("oc.inspectorVisible",e)};a.prototype.adoptSurface=function(){this.surface.options.onGetInspectableElement=this.proxy(this.onGetInspectableElement)};a.prototype.cleanupAfterSwitch=function(){this.switched=true;this.dispose()};a.prototype.loadValues=function(h){var f=this.getElementValuesInput();if(f.length>0){var e=d.trim(f.val());try{return e.length===0?{}:d.parseJSON(e)}catch(j){throw new Error("Error parsing Inspector field values. "+j)}}var p={},k=this.$element.get(0).attributes;for(var l=0,n=k.length;l<n;l++){var g=k[l],m=[];if(m=g.name.match(/^data-property-(.*)$/)){var o=this.normalizePropertyCode(m[1],h);p[o]=g.value}}return p};a.prototype.applyValues=function(f){var e=this.getElementValuesInput(),l=f?this.surface.getValidValues():this.surface.getValues();if(f){var m=this.loadValues(this.configuration);for(var k in l){if(l[k]!==d.oc.inspector.invalidProperty){m[k]=l[k]}}var g={};for(var k in m){if(l.hasOwnProperty(k)){g[k]=m[k]}}l=g}if(e.length>0){e.val(JSON.stringify(l))}else{for(var k in l){var j=l[k];if(d.isArray(j)||d.isPlainObject(j)){throw new Error("Inspector data-property-xxx attributes do not support complex values. Property: "+k)}this.$element.attr("data-property-"+k,j)}}if(f){this.$element.trigger("livechange")}else{var i=false;if(this.isLiveUpdateEnabled()){var h=this.loadValues(this.configuration);i=this.surface.hasChanges(h)}else{i=this.surface.hasChanges()}if(i){this.$element.trigger("change")}}};a.prototype.loadConfiguration=function(){var h=this.$element.data("inspector-config"),e={properties:{},title:null,description:null};e.title=this.$element.data("inspector-title");e.description=this.$element.data("inspector-description");if(h!==undefined){e.properties=this.parseConfiguration(h);this.configurationLoaded(e);return}var k=this.$element.find("> input[data-inspector-config]");if(k.length>0){e.properties=this.parseConfiguration(k.val());this.configurationLoaded(e);return}var g=this.$element.closest("form"),i=this.$element.data(),f=this;d.oc.stripeLoadIndicator.show();g.request("onGetInspectorConfiguration",{data:i}).done(function j(l){f.onConfigurartionRequestDone(l,e)}).always(function(){d.oc.stripeLoadIndicator.hide()})};a.prototype.parseConfiguration=function(f){if(!d.isArray(f)&&!d.isPlainObject(f)){if(d.trim(f)===0){return{}}try{return d.parseJSON(f)}catch(e){throw new Error("Error parsing Inspector configuration. "+e)}}else{return f}};a.prototype.configurationLoaded=function(f){var e=this.loadValues(f.properties);this.title=f.title;this.description=f.description;this.configuration=f;this.createSurfaceAndUi(f.properties,e)};a.prototype.onConfigurartionRequestDone=function(f,e){e.properties=this.parseConfiguration(f.configuration.properties);if(f.configuration.title!==undefined){e.title=f.configuration.title}if(f.configuration.description!==undefined){e.description=f.configuration.description}this.configurationLoaded(e)};a.prototype.triggerShowingAndInit=function(){var f=d.Event("showing.oc.inspector");this.$element.trigger(f,[{callback:this.proxy(this.init)}]);if(f.isDefaultPrevented()){this.$element=null;return false}if(!f.isPropagationStopped()){this.init()}};a.prototype.triggerHiding=function(){var f=d.Event("hiding.oc.inspector"),e=this.surface.getValues();this.$element.trigger(f,[{values:e}]);return !f.isDefaultPrevented()};a.prototype.onGetInspectableElement=function(){return this.$element};a.DEFAULTS={containerSupported:false};d.oc.inspector.wrappers.base=a}(window.jQuery);