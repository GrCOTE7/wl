if(typeof(PhpDebugBar)=="undefined"){var PhpDebugBar={};PhpDebugBar.$=jQuery}(function(e){if(typeof(localStorage)=="undefined"){localStorage={setItem:function(k,l){},getItem:function(k){return null}}}if(typeof(PhpDebugBar.utils)=="undefined"){PhpDebugBar.utils={}}var h=PhpDebugBar.utils.getDictValue=function(p,m,k){var o=p,n=m.split(".");for(var l=0;l<n.length;l++){if(!o[n[l]]){return k}o=o[n[l]]}return o};var i=PhpDebugBar.utils.getObjectSize=function(n){if(Object.keys){return Object.keys(n).length}var m=0;for(var l in n){if(n.hasOwnProperty(l)){m++}}return m};PhpDebugBar.utils.csscls=function(l,o){if(l.indexOf(" ")>-1){var k=l.split(" "),m=[];for(var n=0,p=k.length;n<p;n++){m.push(PhpDebugBar.utils.csscls(k[n],o))}return m.join(" ")}if(l.indexOf(".")===0){return"."+o+l.substr(1)}return o+l};PhpDebugBar.utils.makecsscls=function(l){var k=function(m){return PhpDebugBar.utils.csscls(m,l)};return k};var c=PhpDebugBar.utils.makecsscls("phpdebugbar-");var f=PhpDebugBar.Widget=function(k){this._attributes=e.extend({},this.defaults);this._boundAttributes={};this.$el=e("<"+this.tagName+" />");if(this.className){this.$el.addClass(this.className)}this.initialize.apply(this,[k||{}]);this.render.apply(this)};e.extend(f.prototype,{tagName:"div",className:null,defaults:{},initialize:function(k){this.set(k)},render:function(){},set:function(l,o){if(typeof(l)!="string"){for(var m in l){this.set(m,l[m])}return}this._attributes[l]=o;if(typeof(this._boundAttributes[l])!=="undefined"){for(var n=0,p=this._boundAttributes[l].length;n<p;n++){this._boundAttributes[l][n].apply(this,[o])}}},has:function(k){return typeof(this._attributes[k])!=="undefined"&&this._attributes[k]!==null},get:function(k){return this._attributes[k]},bindAttr:function(l,k){if(e.isArray(l)){for(var m=0,o=l.length;m<o;m++){this.bindAttr(l[m],k)}return}if(typeof(this._boundAttributes[l])=="undefined"){this._boundAttributes[l]=[]}if(typeof(k)=="object"){var n=k;k=function(p){n.text(p||"")}}this._boundAttributes[l].push(k);if(this.has(l)){k.apply(this,[this._attributes[l]])}}});f.extend=function(l){var k=this;var n=function(){return k.apply(this,arguments)};e.extend(n,k);var m=function(){this.constructor=n};m.prototype=k.prototype;n.prototype=new m;e.extend(n.prototype,l);n.__super__=k.prototype;return n};var a=f.extend({className:c("panel"),render:function(){this.$tab=e("<a />").addClass(c("tab"));this.$icon=e("<i />").appendTo(this.$tab);this.bindAttr("icon",function(k){if(k){this.$icon.attr("class","phpdebugbar-fa phpdebugbar-fa-"+k)}else{this.$icon.attr("class","")}});this.bindAttr("title",e("<span />").addClass(c("text")).appendTo(this.$tab));this.$badge=e("<span />").addClass(c("badge")).appendTo(this.$tab);this.bindAttr("badge",function(k){if(k!==null){this.$badge.text(k);this.$badge.show()}else{this.$badge.hide()}});this.bindAttr("widget",function(k){this.$el.empty().append(k.$el)});this.bindAttr("data",function(k){if(this.has("widget")){this.get("widget").set("data",k)}})}});var j=f.extend({tagName:"span",className:c("indicator"),render:function(){this.$icon=e("<i />").appendTo(this.$el);this.bindAttr("icon",function(k){if(k){this.$icon.attr("class","phpdebugbar-fa phpdebugbar-fa-"+k)}else{this.$icon.attr("class","")}});this.bindAttr(["title","data"],e("<span />").addClass(c("text")).appendTo(this.$el));this.$tooltip=e("<span />").addClass(c("tooltip disabled")).appendTo(this.$el);this.bindAttr("tooltip",function(k){if(k){this.$tooltip.text(k).removeClass(c("disabled"))}else{this.$tooltip.addClass(c("disabled"))}})}});var g=PhpDebugBar.DatasetTitleFormater=function(k){this.debugbar=k};e.extend(g.prototype,{format:function(p,n,o){if(o){o=" "+o}else{o=""}var k=i(this.debugbar.datasets)+1;if(typeof(n.__meta)==="undefined"){return"#"+k+o}var l=n.__meta["uri"].substr(n.__meta["uri"].lastIndexOf("/")+1);var m="#"+k+" "+l+o+" ("+n.__meta["datetime"].split(" ")[1]+")";return m}});var b=PhpDebugBar.DebugBar=f.extend({className:"phpdebugbar "+c("minimized"),options:{bodyMarginBottom:true,bodyMarginBottomHeight:0},initialize:function(){this.controls={};this.dataMap={};this.datasets={};this.firstTabName=null;this.activePanelName=null;this.datesetTitleFormater=new g(this);this.options.bodyMarginBottomHeight=parseInt(e("body").css("margin-bottom"));this.registerResizeHandler()},registerResizeHandler:function(){if(typeof this.resize.bind=="undefined"){return}var k=this.resize.bind(this);this.respCSSSize=0;e(window).resize(k);setTimeout(k,20)},resize:function(){var n=this.respCSSSize;if(this.respCSSSize==0){this.$header.find("> div > *:visible").each(function(){n+=e(this).outerWidth()})}var m=this.$header.width();var k="phpdebugbar-mini-design";var l=this.$header.hasClass(k);if(m<=n&&!l){this.respCSSSize=n;this.$header.addClass(k)}else{if(n<m&&l){this.respCSSSize=0;this.$header.removeClass(k)}}this.setHeight(this.$body.height())},render:function(){var l=this;this.$el.appendTo("body");this.$dragCapture=e("<div />").addClass(c("drag-capture")).appendTo(this.$el);this.$resizehdle=e("<div />").addClass(c("resize-handle")).appendTo(this.$el);this.$header=e("<div />").addClass(c("header")).appendTo(this.$el);this.$headerLeft=e("<div />").addClass(c("header-left")).appendTo(this.$header);this.$headerRight=e("<div />").addClass(c("header-right")).appendTo(this.$header);var n=this.$body=e("<div />").addClass(c("body")).appendTo(this.$el);this.recomputeBottomOffset();var k,p;this.$resizehdle.on("mousedown",function(q){p=n.height(),k=q.pageY;n.parents().on("mousemove",m).on("mouseup",o);l.$dragCapture.show();q.preventDefault()});var m=function(r){var q=p+(k-r.pageY);l.setHeight(q)};var o=function(){n.parents().off("mousemove",m).off("mouseup",o);l.$dragCapture.hide()};this.$closebtn=e("<a />").addClass(c("close-btn")).appendTo(this.$headerRight);this.$closebtn.click(function(){l.close()});this.$minimizebtn=e("<a />").addClass(c("minimize-btn")).appendTo(this.$headerRight);this.$minimizebtn.click(function(){l.minimize()});this.$maximizebtn=e("<a />").addClass(c("maximize-btn")).appendTo(this.$headerRight);this.$maximizebtn.click(function(){l.restore()});this.$restorebtn=e("<a />").addClass(c("restore-btn")).hide().appendTo(this.$el);this.$restorebtn.click(function(){l.restore()});this.$openbtn=e("<a />").addClass(c("open-btn")).appendTo(this.$headerRight).hide();this.$openbtn.click(function(){l.openHandler.show(function(r,q){l.addDataSet(q,r,"(opened)");l.showTab()})});this.$datasets=e("<select />").addClass(c("datasets-switcher")).appendTo(this.$headerRight);this.$datasets.change(function(){l.dataChangeHandler(l.datasets[this.value]);l.showTab()})},setHeight:function(k){var m=40;var l=e(window).innerHeight()-this.$header.height()-10;k=Math.min(k,l);k=Math.max(k,m);this.$body.css("height",k);localStorage.setItem("phpdebugbar-height",k);this.recomputeBottomOffset()},restoreState:function(){var k=localStorage.getItem("phpdebugbar-height");this.setHeight(k||this.$body.height());var l=localStorage.getItem("phpdebugbar-open");if(l&&l=="0"){this.close()}else{var n=localStorage.getItem("phpdebugbar-visible");if(n&&n=="1"){var m=localStorage.getItem("phpdebugbar-tab");if(this.isTab(m)){this.showTab(m)}}}},createTab:function(k,m,n){var l=new a({title:n||(k.replace(/[_\-]/g," ").charAt(0).toUpperCase()+k.slice(1)),widget:m});return this.addTab(k,l)},addTab:function(l,m){if(this.isControl(l)){throw new Error(l+" already exists")}var k=this;m.$tab.appendTo(this.$headerLeft).click(function(){if(!k.isMinimized()&&k.activePanelName==l){k.minimize()}else{k.showTab(l)}});m.$el.appendTo(this.$body);this.controls[l]=m;if(this.firstTabName==null){this.firstTabName=l}return m},createIndicator:function(m,n,o,k){var l=new j({icon:n,tooltip:o});return this.addIndicator(m,l,k)},addIndicator:function(m,l,k){if(this.isControl(m)){throw new Error(m+" already exists")}if(k=="left"){l.$el.insertBefore(this.$headerLeft.children().first())}else{l.$el.appendTo(this.$headerRight)}this.controls[m]=l;return l},getControl:function(k){if(this.isControl(k)){return this.controls[k]}},isControl:function(k){return typeof(this.controls[k])!="undefined"},isTab:function(k){return this.isControl(k)&&this.controls[k] instanceof a},isIndicator:function(k){return this.isControl(k)&&this.controls[k] instanceof j},reset:function(){this.minimize();var k=this;e.each(this.controls,function(l,m){if(k.isTab(l)){m.$tab.remove()}m.$el.remove()});this.controls={}},showTab:function(k){if(!k){if(this.activePanelName){k=this.activePanelName}else{k=this.firstTabName}}if(!this.isTab(k)){throw new Error("Unknown tab '"+k+"'")}this.$resizehdle.show();this.$body.show();this.recomputeBottomOffset();e(this.$header).find("> div > ."+c("active")).removeClass(c("active"));e(this.$body).find("> ."+c("active")).removeClass(c("active"));this.controls[k].$tab.addClass(c("active"));this.controls[k].$el.addClass(c("active"));this.activePanelName=k;this.$el.removeClass(c("minimized"));localStorage.setItem("phpdebugbar-visible","1");localStorage.setItem("phpdebugbar-tab",k);this.resize()},minimize:function(){this.$header.find("> div > ."+c("active")).removeClass(c("active"));this.$body.hide();this.$resizehdle.hide();this.recomputeBottomOffset();localStorage.setItem("phpdebugbar-visible","0");this.$el.addClass(c("minimized"));this.resize()},isMinimized:function(){return this.$el.hasClass(c("minimized"))},close:function(){this.$resizehdle.hide();this.$header.hide();this.$body.hide();this.$restorebtn.show();localStorage.setItem("phpdebugbar-open","0");this.$el.addClass(c("closed"));this.recomputeBottomOffset()},isClosed:function(){return this.$el.hasClass(c("closed"))},restore:function(){this.$resizehdle.show();this.$header.show();this.$restorebtn.hide();localStorage.setItem("phpdebugbar-open","1");var k=localStorage.getItem("phpdebugbar-tab");if(this.isTab(k)){this.showTab(k)}this.$el.removeClass(c("closed"));this.resize()},recomputeBottomOffset:function(){if(this.options.bodyMarginBottom){if(this.isClosed()){return e("body").css("margin-bottom",this.options.bodyMarginBottomHeight||"")}var k=parseInt(this.$el.height())+(this.options.bodyMarginBottomHeight||0);e("body").css("margin-bottom",k)}},setDataMap:function(k){this.dataMap=k},addDataMap:function(k){e.extend(this.dataMap,k)},setData:function(k){this.datasets={};return this.addDataSet(k)},addDataSet:function(l,n,m){var k=this.datesetTitleFormater.format(n,l,m);n=n||(i(this.datasets)+1);this.datasets[n]=l;this.$datasets.append(e('<option value="'+n+'">'+k+"</option>"));if(this.$datasets.children().length>1){this.$datasets.show()}this.showDataSet(n);return n},loadDataSet:function(n,l,m){if(!this.openHandler){throw new Error("loadDataSet() needs an open handler")}var k=this;this.openHandler.load(n,function(o){k.addDataSet(o,n,l);m&&m(o)})},getDataSet:function(k){return this.datasets[k]},showDataSet:function(k){this.dataChangeHandler(this.datasets[k]);this.$datasets.val(k)},dataChangeHandler:function(l){var k=this;e.each(this.dataMap,function(m,n){var o=h(l,n[0],n[1]);if(m.indexOf(":")!=-1){m=m.split(":");k.getControl(m[0]).set(m[1],o)}else{k.getControl(m).set("data",o)}})},setOpenHandler:function(k){this.openHandler=k;if(k!==null){this.$openbtn.show()}else{this.$openbtn.hide()}},getOpenHandler:function(){return this.openHandler}});b.Tab=a;b.Indicator=j;var d=PhpDebugBar.AjaxHandler=function(k,l){this.debugbar=k;this.headerName=l||"phpdebugbar"};e.extend(d.prototype,{handle:function(k){if(k.getAllResponseHeaders().indexOf(this.headerName)===-1){return true}if(!this.loadFromId(k)){return this.loadFromData(k)}return true},loadFromId:function(k){var l=this.extractIdFromHeaders(k);if(l&&this.debugbar.openHandler){this.debugbar.loadDataSet(l,"(ajax)");return true}return false},extractIdFromHeaders:function(k){return k.getResponseHeader(this.headerName+"-id")},loadFromData:function(m){var k=this.extractDataFromHeaders(m);if(!k){return false}var l=this.parseHeaders(k);if(l.error){throw new Error("Error loading debugbar data: "+l.error)}else{if(l.data){this.debugbar.addDataSet(l.data,l.id,"(ajax)")}}return true},extractDataFromHeaders:function(m){var l=m.getResponseHeader(this.headerName);if(!l){return}for(var k=1;;k++){var n=m.getResponseHeader(this.headerName+"-"+k);if(!n){break}l+=n}return decodeURIComponent(l)},parseHeaders:function(k){return JSON.parse(k)},bindToJquery:function(l){var k=this;l(document).ajaxComplete(function(n,o,m){if(!m.ignoreDebugBarAjaxHandler){k.handle(o)}})},bindToXHR:function(){var k=this;var l=XMLHttpRequest.prototype.open;XMLHttpRequest.prototype.open=function(r,n,o,m,p){var q=this;this.addEventListener("readystatechange",function(){var s=k.debugbar.openHandler?k.debugbar.openHandler.get("url"):null;if(q.readyState==4&&n.indexOf(s)!==0){k.handle(q)}},false);l.apply(this,Array.prototype.slice.call(arguments))}}})})(PhpDebugBar.$);