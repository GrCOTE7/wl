+function(c){var b=function(e,d){this.$el=c(e);this.options=d;this.alias=this.$el.data("alias");this.config=this.$el.data("config");this.$listContainer=this.$el.find('[data-control="list-container"]');this.$list=this.$el.find('[data-control="list"]');this.$addItem=this.$el.find('[data-control="add-model"]');this.$template=this.$el.find('[data-control="template"]');this.$deleteBox=this.$el.find('[data-control="delete-box"]');this.init()};b.prototype.init=function(){var d=this;if(this.config.sortable){this.$list.sortable({animation:350,handle:".sort-handle",onStart:function(){d.$list.addClass("sorting")},onEnd:function(){d.$list.removeClass("sorting")},})}this.$list.unbind().on("click",'[data-control="delete"]',function(){d.deleteItem(c(this).closest("li"));return false}).on("click",'li[data-control="item"]',function(){d.popup(c(this));return false});this.$addItem.unbind().on("click",function(){var e=d.addItem();d.popup(e,true);return false})};b.prototype.getModelId=function(d){var e={};if(e=d.find('[data-control="model"]').val()){e=JSON.parse(e);if(typeof e.id!="undefined"){return e.id}}return 0};b.prototype.addItem=function(){this.$list.append('<li data-control="item" style="display:none"></li>');return this.$list.find("li").last()};b.prototype.deleteItem=function(f){var e=this,h=this.getModelId(f),g=h!==0?"Delete this record upon saving?":"Delete this unsaved record?",d=h!==0?"The record will be deleted upon saving.":"The record has been deleted.";f.addClass("delete-highlight");sweetAlert({title:g,showCancelButton:true,confirmButtonText:"Confirm",},function(i){if(i){c.oc.flashMsg({text:d,"class":"success",interval:3});f.slideUp("fast",function(){c(this).remove();if(h){var j=JSON.parse(e.$deleteBox.val());j.push(h);e.$deleteBox.val(JSON.stringify(j))}})}else{f.removeClass("delete-highlight")}})};b.prototype.popup=function(e,g){var d=this,f={},i=this.getModelId(e);if(f=e.find('[data-control="model"]').val()){f=JSON.parse(f)}this.itemSaved=false;e.one("show.oc.popup",function(j){d.openPopup(j,i,e);return false});e.one("hide.oc.popup",function(){d.hidePopup(e,g);return false});var h={placement:"center",modal:true,closeOnPageClick:true,highlightModelTarget:true,useAnimation:true,width:600};if(g){e.popup({content:this.$template.html().replace(new RegExp("script&gt;","g"),"script>"),placement:h.placement,modal:h.modal,closeOnPageClick:h.closeOnPageClick,highlightModelTarget:h.highlightModelTarget,useAnimation:h.useAnimation,width:h.width})}else{e.popup({extraData:{":model":f},handler:this.alias+"::onRenderForm",placement:h.placement,modal:h.modal,closeOnPageClick:h.closeOnPageClick,highlightModelTarget:h.highlightModelTarget,useAnimation:h.useAnimation,width:h.width})}return false};b.prototype.openPopup=function(g,h,f){var d=this;d.$popupContainer=c(g.relatedTarget);d.$popupForm=d.$popupContainer.find("form");c(document).trigger("render");c('button[data-control="apply-btn"]',d.$popupContainer).on("click",function(){d.applyChanges(h,f);return false});c(document).trigger("owl.hasmany.opened",{alias:d.alias,item:f,form:d.$popupForm})};b.prototype.applyChanges=function(h,e){var d=this;var g=d.$popupContainer.find('[data-control="loading-indicator"]'),f=d.$popupContainer.find(".modal-footer");f.addClass("in-progress");g.loadIndicator({text:"Applying..."});d.$popupForm.request(d.alias+"::onProcessForm",{data:{id:h},success:function(i){d.itemSaved=true;e.html(i.item);d.$popupContainer.trigger("close.oc.popup");d.$el.trigger("change")},complete:function(){f.removeClass("in-progress");g.loadIndicator("hide")}})};b.prototype.hidePopup=function(e,f){var d=this;if(f&&!d.itemSaved){e.remove()}e.css("display","");c('span[role="status"]').remove();c(document).trigger("owl.hasmany.closed",{alias:d.alias,item:e,form:d.$popupForm})};var a=c.fn.HasMany;c.fn.HasMany=function(d){return new b(c(this),d)};c.fn.HasMany.Constructor=b;c.fn.HasMany.noConflict=function(){c.fn.HasMany=a;return this}}(window.jQuery);