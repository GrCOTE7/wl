+function(b){var a=function(){this.$form=b("#post-form");this.$markdownEditor=b("[data-field-name=content] [data-control=markdowneditor]:first",this.$form);this.$preview=b(".editor-preview",this.$markdownEditor);this.formAction=this.$form.attr("action");this.sessionKey=b("input[name=_session_key]",this.$form).val();if(this.$markdownEditor.length>0){this.codeEditor=this.$markdownEditor.markdownEditor("getEditorObject");this.$markdownEditor.on("initPreview.oc.markdowneditor",b.proxy(this.initPreview,this));this.initDropzones();this.initFormEvents();this.addToolbarButton()}this.initLayout()};a.prototype.addToolbarButton=function(){this.buttonClickCount=1;var c=this,d=this.$markdownEditor.markdownEditor("findToolbarButton","image");if(!d.length){return}d.data("button-action","insertLine");d.data("button-template","\n\n![1](image)\n");d.on("click",function(){d.data("button-template","\n\n!["+c.buttonClickCount+"](image)\n");c.buttonClickCount++})};a.prototype.initPreview=function(){this.initImageUploaders()};a.prototype.updateScroll=function(){};a.prototype.initImageUploaders=function(){var c=this;b("span.image-placeholder .upload-dropzone",this.$preview).each(function(){var h=b(this).parent(),f=b("span.label",h),e=h.data("index");var g={url:c.formAction,clickable:[b(this).get(0),f.get(0)],previewsContainer:b("<div />").get(0),paramName:"file",headers:{}};var i=b('meta[name="csrf-token"]').attr("content");if(i){g.headers["X-CSRF-TOKEN"]=i}var d=new Dropzone(b(this).get(0),g);d.on("error",function(k,j){alert("Error uploading file: "+j)});d.on("success",function(k,l){if(l.error){alert(l.error)}else{c.pauseUpdates();var j=b('<img src="'+l.path+'">');j.load(function(){c.updateScroll()});h.replaceWith(j);c.codeEditor.replace("!["+l.file+"]("+l.path+")",{needle:"!["+e+"](image)"});c.resumeUpdates()}});d.on("complete",function(){h.removeClass("loading")});d.on("sending",function(j,l,k){k.append("X_BLOG_IMAGE_UPLOAD",1);k.append("_session_key",c.sessionKey);h.addClass("loading")})})};a.prototype.pauseUpdates=function(){this.$markdownEditor.markdownEditor("pauseUpdates")};a.prototype.resumeUpdates=function(){this.$markdownEditor.markdownEditor("resumeUpdates")};a.prototype.initDropzones=function(){b(document).bind("dragover",function(h){var i=b("span.image-placeholder .upload-dropzone"),d,g=window.dropZoneTimeout;if(!g){i.addClass("in")}else{clearTimeout(g)}var f=false,c=h.target;do{if(b(c).hasClass("dropzone")){f=true;d=b(c);break}c=c.parentNode}while(c!=null);i.removeClass("in hover");if(f){d.addClass("hover")}window.dropZoneTimeout=setTimeout(function(){window.dropZoneTimeout=null;i.removeClass("in hover")},100)})};a.prototype.initFormEvents=function(){b(document).on("ajaxSuccess","#post-form",function(d,c,e){if(c.handler=="onSave"&&!e.X_OCTOBER_ERROR_FIELDS){b(this).trigger("unchange.oc.changeMonitor")}})};a.prototype.initLayout=function(){b("#Form-secondaryTabs .tab-pane.layout-cell:not(:first-child)").addClass("padded-pane")};a.prototype.replacePlaceholder=function(f,d,e,c){this.pauseUpdates();f.replaceWith(d);this.codeEditor.replace(c,{needle:e});this.updateScroll();this.resumeUpdates()};b(document).ready(function(){var c=new a();if(b.oc===undefined){b.oc={}}b.oc.blogPostForm=c})}(window.jQuery);