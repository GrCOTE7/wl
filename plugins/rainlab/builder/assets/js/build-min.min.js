+function(b){void 0===b.oc.builder&&(b.oc.builder={});var a=b.oc.foundation.base,c=a.prototype,d=function(){this.data={},this.requestCache={},this.callbackCache={},a.call(this)};d.prototype.set=function(g,j,k,f,h){this.storeData(g,j,k,f),"localization"!=j||k||this.localizationUpdated(g,h)},d.prototype.get=function(g,j,k,f,h){return void 0===this.data[j]||void 0===this.data[j][k]||void 0===this.data[j][k][f]||this.isCacheObsolete(this.data[j][k][f].timestamp)?this.loadDataFromServer(g,j,k,f,h):void h(this.data[j][k][f].data)},d.prototype.makeCacheKey=function(g,h,j){var f=g+"-"+h;return j&&(f+="-"+j),f},d.prototype.isCacheObsolete=function(e){return Date.now()-e>300000},d.prototype.loadDataFromServer=function(h,k,l,g,j){var m=this,f=this.makeCacheKey(k,l,g);return void 0===this.requestCache[f]&&(this.requestCache[f]=h.request("onPluginDataRegistryGetData",{data:{registry_plugin_code:k,registry_data_type:l,registry_data_subtype:g}}).done(function(e){if(void 0===e.registryData){throw new Error("Invalid data registry response.")}m.storeData(k,l,g,e.registryData),m.applyCallbacks(f,e.registryData),m.requestCache[f]=void 0})),this.addCallbackToQueue(j,f),this.requestCache[f]},d.prototype.addCallbackToQueue=function(f,g){void 0===this.callbackCache[g]&&(this.callbackCache[g]=[]),this.callbackCache[g].push(f)},d.prototype.applyCallbacks=function(f,g){if(void 0!==this.callbackCache[f]){for(var h=this.callbackCache[f].length-1;h>=0;h--){this.callbackCache[f][h](g)}delete this.callbackCache[f]}},d.prototype.storeData=function(g,j,k,f){void 0===this.data[g]&&(this.data[g]={}),void 0===this.data[g][j]&&(this.data[g][j]={});var h={timestamp:Date.now(),data:f};this.data[g][j][k]=h},d.prototype.clearCache=function(f,g){void 0!==this.data[f]&&void 0!==this.data[f][g]&&(this.data[f][g]=void 0)},d.prototype.getLocalizationString=function(g,h,j,f){this.get(g,h,"localization",null,function(e){return void 0!==e[j]?void f(e[j]):void f(j)})},d.prototype.localizationUpdated=function(f,g){b.oc.builder.localizationInput.updatePluginInputs(f),void 0!==g&&g.suppressLanguageEditorUpdate||b.oc.builder.indexController.entityControllers.localization.languageUpdated(f),b.oc.builder.indexController.entityControllers.localization.updateOnScreenStrings(f)},b.oc.builder.dataRegistry=new d}(window.jQuery),+function(b){void 0===b.oc.builder&&(b.oc.builder={}),void 0===b.oc.builder.entityControllers&&(b.oc.builder.entityControllers={});var a=b.oc.foundation.base,c=a.prototype,d=function(f,g){if(void 0===f){throw new Error("The Builder entity type name should be set in the base constructor call.")}if(void 0===g){throw new Error("The Builder index controller should be set when creating an entity controller.")}this.typeName=f,this.indexController=g,a.call(this)};d.prototype=Object.create(c),d.prototype.constructor=d,d.prototype.registerHandlers=function(){},d.prototype.invokeCommand=function(f,g){if(!/^cmd[a-zA-Z0-9]+$/.test(f)){throw new Error("Invalid command: "+f)}if(void 0===this[f]){throw new Error("Unknown command: "+f)}this[f].apply(this,[g])},d.prototype.newTabId=function(){return this.typeName+Math.random()},d.prototype.makeTabId=function(e){return this.typeName+"-"+e},d.prototype.getMasterTabsActivePane=function(){return this.indexController.getMasterTabActivePane()},d.prototype.getMasterTabsObject=function(){return this.indexController.masterTabsObj},d.prototype.getSelectedPlugin=function(){var e=b("#PluginList-pluginList-plugin-list > ul > li.active");return e.data("id")},d.prototype.getIndexController=function(){return this.indexController},d.prototype.updateMasterTabIdAndTitle=function(f,g){var h=this.getMasterTabsObject();h.updateIdentifier(f,g.tabId),h.updateTitle(f,g.tabTitle)},d.prototype.unhideFormDeleteButton=function(e){b("[data-control=delete-button]",e).removeClass("hide")},d.prototype.forceCloseTab=function(e){e.trigger("close.oc.tab",[{force:!0}])},d.prototype.unmodifyTab=function(e){this.indexController.unchangeTab(e)},b.oc.builder.entityControllers.base=d}(window.jQuery),+function(b){void 0===b.oc.builder&&(b.oc.builder={}),void 0===b.oc.builder.entityControllers&&(b.oc.builder.entityControllers={});var a=b.oc.builder.entityControllers.base,c=a.prototype,d=function(f){a.call(this,"plugin",f),this.popupZIndex=5050};d.prototype=Object.create(c),d.prototype.constructor=d,d.prototype.cmdMakePluginActive=function(f){var g=b(f.currentTarget),h=g.data("pluginCode");this.makePluginActive(h)},d.prototype.cmdCreatePlugin=function(f){var g=b(f.currentTarget);g.one("shown.oc.popup",this.proxy(this.onPluginPopupShown)),g.popup({handler:"onPluginLoadPopup",zIndex:this.popupZIndex})},d.prototype.cmdApplyPluginSettings=function(f){var g=b(f.currentTarget),h=this;b.oc.stripeLoadIndicator.show(),g.request("onPluginSave").always(b.oc.builder.indexController.hideStripeIndicatorProxy).done(function(e){g.trigger("close.oc.popup"),h.applyPluginSettingsDone(e)})},d.prototype.cmdEditPluginSettings=function(f){var g=b(f.currentTarget);g.one("shown.oc.popup",this.proxy(this.onPluginPopupShown)),g.popup({handler:"onPluginLoadPopup",zIndex:this.popupZIndex,extraData:{pluginCode:g.data("pluginCode")}})},d.prototype.onPluginPopupShown=function(f,g,h){b(h).find("input[name=name]").focus()},d.prototype.applyPluginSettingsDone=function(e){void 0!==e.responseData&&void 0!==e.responseData.isNewPlugin&&this.makePluginActive(e.responseData.pluginCode,!0)},d.prototype.makePluginActive=function(f,g){var h=b("#builder-plugin-selector-panel form").first();b.oc.stripeLoadIndicator.show(),h.request("onPluginSetActive",{data:{pluginCode:f,updatePluginList:g?1:0}}).always(b.oc.builder.indexController.hideStripeIndicatorProxy).done(this.proxy(this.makePluginActiveDone))},d.prototype.makePluginActiveDone=function(f){var g=f.responseData.pluginCode;b("#builder-plugin-selector-panel [data-control=filelist]").fileList("markActive",g)},b.oc.builder.entityControllers.plugin=d}(window.jQuery),+function(b){void 0===b.oc.builder&&(b.oc.builder={}),void 0===b.oc.builder.entityControllers&&(b.oc.builder.entityControllers={});var a=b.oc.builder.entityControllers.base,c=a.prototype,d=function(f){a.call(this,"databaseTable",f)};d.prototype=Object.create(c),d.prototype.constructor=d,d.prototype.cmdCreateTable=function(f){var g=this.indexController.openOrLoadMasterTab(b(f.target),"onDatabaseTableCreateOrOpen",this.newTabId());g!==!1&&g.done(this.proxy(this.onTableLoaded,this))},d.prototype.cmdOpenTable=function(f){var g=b(f.currentTarget).data("id"),h=this.indexController.openOrLoadMasterTab(b(f.target),"onDatabaseTableCreateOrOpen",this.makeTabId(g),{table_name:g});h!==!1&&h.done(this.proxy(this.onTableLoaded,this))},d.prototype.cmdSaveTable=function(f){var g=b(f.currentTarget);if(this.validateTable(g)){var h={columns:this.getTableData(g)};g.popup({extraData:h,handler:"onDatabaseTableValidateAndShowPopup"})}},d.prototype.cmdSaveMigration=function(f){var g=b(f.currentTarget);b.oc.stripeLoadIndicator.show(),g.request("onDatabaseTableMigrationApply").always(b.oc.builder.indexController.hideStripeIndicatorProxy).done(this.proxy(this.saveMigrationDone))},d.prototype.cmdDeleteTable=function(f){var g=b(f.currentTarget);b.oc.confirm(g.data("confirm"),this.proxy(this.deleteConfirmed))},d.prototype.cmdUnModifyForm=function(){var e=this.getMasterTabsActivePane();this.unmodifyTab(e)},d.prototype.cmdAddTimestamps=function(f){var g=b(f.currentTarget),h=this.addTimeStampColumns(g,["created_at","updated_at"]);h||alert(g.closest("form").attr("data-lang-timestamps-exist"))},d.prototype.cmdAddSoftDelete=function(f){var g=b(f.currentTarget),h=this.addTimeStampColumns(g,["deleted_at"]);h||alert(g.closest("form").attr("data-lang-soft-deleting-exist"))},d.prototype.onTableCellChanged=function(g,j,k,f){var h=b(g.target);if("columns"==h.data("alias")&&"database"==h.closest("form").data("entity")){var l={};"auto_increment"==j&&k&&(l.unsigned=1,l.primary_key=1),"unsigned"!=j||k||(l.auto_increment=0),"primary_key"==j&&k&&(l.allow_null=0),"allow_null"==j&&k&&(l.primary_key=0),"primary_key"!=j||k||(l.auto_increment=0),h.table("setRowValues",f,l)}},d.prototype.onTableLoaded=function(){b(document).trigger("render");var g=this.getMasterTabsActivePane(),h=g.find("form"),j=g.find("div[data-control=table] div.toolbar"),f=b('<a class="btn oc-icon-clock-o builder-custom-table-button" data-builder-command="databaseTable:cmdAddTimestamps"></a>');f.text(h.attr("data-lang-add-timestamps")),j.append(f),f=b('<a class="btn oc-icon-refresh builder-custom-table-button" data-builder-command="databaseTable:cmdAddSoftDelete"></a>'),f.text(h.attr("data-lang-add-soft-delete")),j.append(f)},d.prototype.registerHandlers=function(){this.indexController.$masterTabs.on("oc.tableCellChanged",this.proxy(this.onTableCellChanged))},d.prototype.validateTable=function(f){var g=this.getTableControlObject(f);return g.unfocusTable(),g.validate()},d.prototype.getTableData=function(f){var g=this.getTableControlObject(f);return g.dataSource.getAllData()},d.prototype.getTableControlObject=function(g){var h=g.closest("form"),j=h.find("[data-control=table]"),f=j.data("oc.table");if(!f){throw new Error("Table object is not found on the database table tab")}return f},d.prototype.saveMigrationDone=function(f){if(void 0===f.builderResponseData){throw new Error("Invalid response data")}b("#builderTableMigrationPopup").trigger("close.oc.popup");var g=this.getMasterTabsActivePane(),h=this.getMasterTabsObject();"delete"!=f.builderResponseData.operation?(g.find("input[name=table_name]").val(f.builderResponseData.builderObjectName),this.updateMasterTabIdAndTitle(g,f.builderResponseData),this.unhideFormDeleteButton(g),this.getTableList().fileList("markActive",f.builderResponseData.tabId),this.getIndexController().unchangeTab(g)):this.forceCloseTab(g),b.oc.builder.dataRegistry.clearCache(f.builderResponseData.pluginCode,"model-columns")},d.prototype.getTableList=function(){return b("#layout-side-panel form[data-content-id=database] [data-control=filelist]")},d.prototype.deleteConfirmed=function(){var e=this.getMasterTabsActivePane();e.find("form").popup({handler:"onDatabaseTableShowDeletePopup"})},d.prototype.getColumnNames=function(g){var j=this.getTableControlObject(g);j.unfocusTable();var k=this.getTableData(g),f=[];for(var h in k){void 0!==k[h].name&&f.push(b.trim(k[h].name))}return f},d.prototype.addTimeStampColumns=function(g,j){var k=this.getColumnNames(g),f=!1;for(var h in j){var l=j[h];-1==b.inArray(l,k)&&(this.addTimeStampColumn(g,l),f=!0)}return f&&g.trigger("change"),f},d.prototype.addTimeStampColumn=function(g,j){var k=this.getTableControlObject(g),f=this.getTableData(g),h={name:j,type:"timestamp","default":null,allow_null:!0};k.addRecord("bottom",!0),k.setRowValues(f.length-1,h),k.addRecord("bottom",!1),k.deleteRecord()},b.oc.builder.entityControllers.databaseTable=d}(window.jQuery),+function(b){void 0===b.oc.builder&&(b.oc.builder={}),void 0===b.oc.builder.entityControllers&&(b.oc.builder.entityControllers={});var a=b.oc.builder.entityControllers.base,c=a.prototype,d=function(f){a.call(this,"model",f)};d.prototype=Object.create(c),d.prototype.constructor=d,d.prototype.cmdCreateModel=function(f){var g=b(f.currentTarget);g.one("shown.oc.popup",this.proxy(this.onModelPopupShown)),g.popup({handler:"onModelLoadPopup"})},d.prototype.cmdApplyModelSettings=function(f){var g=b(f.currentTarget),h=this;b.oc.stripeLoadIndicator.show(),g.request("onModelSave").always(b.oc.builder.indexController.hideStripeIndicatorProxy).done(function(e){g.trigger("close.oc.popup"),h.applyModelSettingsDone(e)})},d.prototype.onModelPopupShown=function(f,g,h){b(h).find("input[name=className]").focus()},d.prototype.applyModelSettingsDone=function(f){if(void 0!==f.builderResponseData.registryData){var g=f.builderResponseData.registryData;b.oc.builder.dataRegistry.set(g.pluginCode,"model-classes",null,g.models)}},b.oc.builder.entityControllers.model=d}(window.jQuery),+function(b){void 0===b.oc.builder&&(b.oc.builder={}),void 0===b.oc.builder.entityControllers&&(b.oc.builder.entityControllers={});var a=b.oc.builder.entityControllers.base,c=a.prototype,d=function(f){a.call(this,"modelForm",f)};d.prototype=Object.create(c),d.prototype.constructor=d,d.prototype.cmdCreateForm=function(f){var g=b(f.currentTarget),h={model_class:g.data("modelClass")};this.indexController.openOrLoadMasterTab(g,"onModelFormCreateOrOpen",this.newTabId(),h)},d.prototype.cmdSaveForm=function(h){var k=b(h.currentTarget),l=k.closest("form"),g=b("[data-root-control-wrapper] > [data-control-container]",l),j=l.find(".inspector-container"),m=b.oc.builder.formbuilder.domToPropertyJson.convert(g.get(0));if(b.oc.inspector.manager.applyValuesFromContainer(j)){if(m===!1){return void b.oc.flashMsg({text:b.oc.builder.formbuilder.domToPropertyJson.getLastError(),"class":"error",interval:5})}var f={controls:m};k.request("onModelFormSave",{data:f}).done(this.proxy(this.saveFormDone))}},d.prototype.cmdOpenForm=function(f){var g=b(f.currentTarget).data("form"),h=b(f.currentTarget).data("modelClass");this.indexController.openOrLoadMasterTab(b(f.target),"onModelFormCreateOrOpen",this.makeTabId(h+"-"+g),{file_name:g,model_class:h})},d.prototype.cmdDeleteForm=function(f){var g=b(f.currentTarget);b.oc.confirm(g.data("confirm"),this.proxy(this.deleteConfirmed))},d.prototype.cmdAddControl=function(e){b.oc.builder.formbuilder.controlPalette.addControl(e)},d.prototype.cmdUndockControlPalette=function(e){b.oc.builder.formbuilder.controlPalette.undockFromContainer(e)},d.prototype.cmdDockControlPalette=function(e){b.oc.builder.formbuilder.controlPalette.dockToContainer(e)},d.prototype.cmdCloseControlPalette=function(e){b.oc.builder.formbuilder.controlPalette.closeInContainer(e)},d.prototype.saveFormDone=function(f){if(void 0===f.builderResponseData){throw new Error("Invalid response data")}var g=this.getMasterTabsActivePane();g.find("input[name=file_name]").val(f.builderResponseData.builderObjectName),this.updateMasterTabIdAndTitle(g,f.builderResponseData),this.unhideFormDeleteButton(g),this.getModelList().fileList("markActive",f.builderResponseData.tabId),this.getIndexController().unchangeTab(g),this.updateDataRegistry(f)},d.prototype.updateDataRegistry=function(f){if(void 0!==f.builderResponseData.registryData){var g=f.builderResponseData.registryData;b.oc.builder.dataRegistry.set(g.pluginCode,"model-forms",g.modelClass,g.forms)}},d.prototype.deleteConfirmed=function(){var f=this.getMasterTabsActivePane(),g=f.find("form");b.oc.stripeLoadIndicator.show(),g.request("onModelFormDelete").always(b.oc.builder.indexController.hideStripeIndicatorProxy).done(this.proxy(this.deleteDone))},d.prototype.deleteDone=function(f){var g=this.getMasterTabsActivePane();this.getIndexController().unchangeTab(g),this.forceCloseTab(g),this.updateDataRegistry(f)},d.prototype.getModelList=function(){return b("#layout-side-panel form[data-content-id=models] [data-control=filelist]")},b.oc.builder.entityControllers.modelForm=d}(window.jQuery),+function(b){void 0===b.oc.builder&&(b.oc.builder={}),void 0===b.oc.builder.entityControllers&&(b.oc.builder.entityControllers={});var a=b.oc.builder.entityControllers.base,c=a.prototype,d=function(f){this.cachedModelFieldsPromises={},a.call(this,"modelList",f)};d.prototype=Object.create(c),d.prototype.constructor=d,d.prototype.registerHandlers=function(){b(document).on("autocompleteitems.oc.table",'form[data-sub-entity="model-list"] [data-control=table]',this.proxy(this.onAutocompleteItems))},d.prototype.cmdCreateList=function(g){var h=b(g.currentTarget),j={model_class:h.data("modelClass")},f=this.indexController.openOrLoadMasterTab(h,"onModelListCreateOrOpen",this.newTabId(),j);f!==!1&&f.done(this.proxy(this.onListLoaded,this))},d.prototype.cmdSaveList=function(f){var g=b(f.currentTarget),h=g.closest("form");this.validateTable(g)&&g.request("onModelListSave",{data:{columns:this.getTableData(g)}}).done(this.proxy(this.saveListDone))},d.prototype.cmdOpenList=function(g){var h=b(g.currentTarget).data("list"),j=b(g.currentTarget).data("modelClass"),f=this.indexController.openOrLoadMasterTab(b(g.target),"onModelListCreateOrOpen",this.makeTabId(j+"-"+h),{file_name:h,model_class:j});f!==!1&&f.done(this.proxy(this.onListLoaded,this))},d.prototype.cmdDeleteList=function(f){var g=b(f.currentTarget);b.oc.confirm(g.data("confirm"),this.proxy(this.deleteConfirmed))},d.prototype.cmdAddDatabaseColumns=function(f){var g=b(f.currentTarget);b.oc.stripeLoadIndicator.show(),g.request("onModelListLoadDatabaseColumns").done(this.proxy(this.databaseColumnsLoaded)).always(b.oc.builder.indexController.hideStripeIndicatorProxy)},d.prototype.saveListDone=function(f){if(void 0===f.builderResponseData){throw new Error("Invalid response data")}var g=this.getMasterTabsActivePane();g.find("input[name=file_name]").val(f.builderResponseData.builderObjectName),this.updateMasterTabIdAndTitle(g,f.builderResponseData),this.unhideFormDeleteButton(g),this.getModelList().fileList("markActive",f.builderResponseData.tabId),this.getIndexController().unchangeTab(g),this.updateDataRegistry(f)},d.prototype.deleteConfirmed=function(){var f=this.getMasterTabsActivePane(),g=f.find("form");b.oc.stripeLoadIndicator.show(),g.request("onModelListDelete").always(b.oc.builder.indexController.hideStripeIndicatorProxy).done(this.proxy(this.deleteDone))},d.prototype.deleteDone=function(f){var g=this.getMasterTabsActivePane();this.getIndexController().unchangeTab(g),this.forceCloseTab(g),this.updateDataRegistry(f)},d.prototype.getTableControlObject=function(g){var h=g.closest("form"),j=h.find("[data-control=table]"),f=j.data("oc.table");if(!f){throw new Error("Table object is not found on the model list tab")}return f},d.prototype.getModelList=function(){return b("#layout-side-panel form[data-content-id=models] [data-control=filelist]")},d.prototype.validateTable=function(f){var g=this.getTableControlObject(f);return g.unfocusTable(),g.validate()},d.prototype.getTableData=function(f){var g=this.getTableControlObject(f);return g.dataSource.getAllData()},d.prototype.loadModelFields=function(g,j){var k=b(g).closest("form"),f=k.find("input[name=model_class]").val(),h=k.data("oc.model-field-cache");return void 0!==h?void j(h):(void 0===this.cachedModelFieldsPromises[f]&&(this.cachedModelFieldsPromises[f]=k.request("onModelFormGetModelFields",{data:{as_plain_list:1}})),void (void 0!==j&&this.cachedModelFieldsPromises[f].done(function(e){k.data("oc.model-field-cache",e.responseData.options),j(e.responseData.options)})))},d.prototype.updateDataRegistry=function(f){if(void 0!==f.builderResponseData.registryData){var g=f.builderResponseData.registryData;b.oc.builder.dataRegistry.set(g.pluginCode,"model-lists",g.modelClass,g.lists),b.oc.builder.dataRegistry.clearCache(g.pluginCode,"plugin-lists")}},d.prototype.databaseColumnsLoaded=function(h){b.isArray(h.responseData.columns)||alert("Invalid server response");var l=this.getMasterTabsActivePane(),m=l.find("form"),g=this.getColumnNames(m),k=!1;for(var p in h.responseData.columns){var f=h.responseData.columns[p],j=this.mapType(f.type);-1===b.inArray(f.name,g)&&(this.addColumn(m,f.name,j),k=!0)}k?m.trigger("change"):alert(m.attr("data-lang-all-database-columns-exist"))},d.prototype.mapType=function(e){switch(e){case"integer":return"number";case"timestamp":return"datetime";default:return"text"}},d.prototype.addColumn=function(g,j,k){var f=this.getTableControlObject(g),h=this.getTableData(g),l={field:j,label:j,type:k};f.addRecord("bottom",!0),f.setRowValues(h.length-1,l),f.addRecord("bottom",!1),f.deleteRecord()},d.prototype.getColumnNames=function(g){var j=this.getTableControlObject(g);j.unfocusTable();var k=this.getTableData(g),f=[];for(var h in k){void 0!==k[h].field&&f.push(b.trim(k[h].field))}return f},d.prototype.onAutocompleteItems=function(f,g){return"model-fields"===g.columnConfiguration.fillFrom?(f.preventDefault(),this.loadModelFields(f.target,g.callback),!1):void 0},d.prototype.onListLoaded=function(){b(document).trigger("render");var g=this.getMasterTabsActivePane(),h=g.find("form"),j=g.find("div[data-control=table] div.toolbar"),f=b('<a class="btn oc-icon-magic builder-custom-table-button" data-builder-command="modelList:cmdAddDatabaseColumns"></a>');f.text(h.attr("data-lang-add-database-columns")),j.append(f)},b.oc.builder.entityControllers.modelList=d}(window.jQuery),+function(b){void 0===b.oc.builder&&(b.oc.builder={}),void 0===b.oc.builder.entityControllers&&(b.oc.builder.entityControllers={});var a=b.oc.builder.entityControllers.base,c=a.prototype,d=function(f){a.call(this,"permissions",f)};d.prototype=Object.create(c),d.prototype.constructor=d,d.prototype.registerHandlers=function(){this.indexController.$masterTabs.on("oc.tableNewRow",this.proxy(this.onTableRowCreated))},d.prototype.cmdOpenPermissions=function(f){var g=this.getSelectedPlugin();return g?void this.indexController.openOrLoadMasterTab(b(f.target),"onPermissionsOpen",this.makeTabId(g)):void alert("Please select a plugin first")},d.prototype.cmdSavePermissions=function(f){var g=b(f.currentTarget),h=g.closest("form");this.validateTable(g)&&g.request("onPermissionsSave",{data:{permissions:this.getTableData(g)}}).done(this.proxy(this.savePermissionsDone))},d.prototype.getTableControlObject=function(g){var h=g.closest("form"),j=h.find("[data-control=table]"),f=j.data("oc.table");if(!f){throw new Error("Table object is not found on permissions tab")}return f},d.prototype.validateTable=function(f){var g=this.getTableControlObject(f);return g.unfocusTable(),g.validate()},d.prototype.getTableData=function(f){var g=this.getTableControlObject(f);return g.dataSource.getAllData()},d.prototype.savePermissionsDone=function(f){if(void 0===f.builderResponseData){throw new Error("Invalid response data")}var g=this.getMasterTabsActivePane();this.getIndexController().unchangeTab(g),b.oc.builder.dataRegistry.clearCache(f.builderResponseData.pluginCode,"permissions")},d.prototype.onTableRowCreated=function(g,j){var k=b(g.target);if("permissions"==k.data("alias")){var f=k.closest("form");if("permissions"==f.data("entity")){var h=f.find("input[name=plugin_code]").val();j.permission=h.toLowerCase()+"."}}},b.oc.builder.entityControllers.permission=d}(window.jQuery),+function(b){void 0===b.oc.builder&&(b.oc.builder={}),void 0===b.oc.builder.entityControllers&&(b.oc.builder.entityControllers={});var a=b.oc.builder.entityControllers.base,c=a.prototype,d=function(f){a.call(this,"menus",f)};d.prototype=Object.create(c),d.prototype.constructor=d,d.prototype.cmdOpenMenus=function(f){var g=this.getSelectedPlugin();return g?void this.indexController.openOrLoadMasterTab(b(f.target),"onMenusOpen",this.makeTabId(g)):void alert("Please select a plugin first")},d.prototype.cmdSaveMenus=function(g){var j=b(g.currentTarget),k=j.closest("form"),f=k.find(".inspector-container");if(b.oc.inspector.manager.applyValuesFromContainer(f)){var h=b.oc.builder.menubuilder.controller.getJson(k.get(0));j.request("onMenusSave",{data:{menus:h}}).done(this.proxy(this.saveMenusDone))}},d.prototype.cmdAddMainMenuItem=function(e){b.oc.builder.menubuilder.controller.addMainMenuItem(e)},d.prototype.cmdAddSideMenuItem=function(e){b.oc.builder.menubuilder.controller.addSideMenuItem(e)},d.prototype.cmdDeleteMenuItem=function(e){b.oc.builder.menubuilder.controller.deleteMenuItem(e)},d.prototype.saveMenusDone=function(f){if(void 0===f.builderResponseData){throw new Error("Invalid response data")}var g=this.getMasterTabsActivePane();this.getIndexController().unchangeTab(g)},b.oc.builder.entityControllers.menus=d}(window.jQuery),+function(b){void 0===b.oc.builder&&(b.oc.builder={}),void 0===b.oc.builder.entityControllers&&(b.oc.builder.entityControllers={});var a=b.oc.builder.entityControllers.base,c=a.prototype,d=function(f){a.call(this,"version",f),this.hiddenHints={}};d.prototype=Object.create(c),d.prototype.constructor=d,d.prototype.cmdCreateVersion=function(f){var g=b(f.currentTarget),h=g.data("versionType");this.indexController.openOrLoadMasterTab(g,"onVersionCreateOrOpen",this.newTabId(),{version_type:h})},d.prototype.cmdSaveVersion=function(f){var g=b(f.currentTarget),h=g.closest("form");g.request("onVersionSave").done(this.proxy(this.saveVersionDone))},d.prototype.cmdOpenVersion=function(f){var g=b(f.currentTarget).data("id"),h=b(f.currentTarget).data("pluginCode");this.indexController.openOrLoadMasterTab(b(f.target),"onVersionCreateOrOpen",this.makeTabId(h+"-"+g),{original_version:g})},d.prototype.cmdDeleteVersion=function(f){var g=b(f.currentTarget);b.oc.confirm(g.data("confirm"),this.proxy(this.deleteConfirmed))},d.prototype.cmdApplyVersion=function(g){var h=b(g.currentTarget),j=h.closest("div.tab-pane"),f=this;this.showHintPopup(j,"builder-version-apply",function(){h.request("onVersionApply").done(f.proxy(f.applyVersionDone))})},d.prototype.cmdRollbackVersion=function(g){var h=b(g.currentTarget),j=h.closest("div.tab-pane"),f=this;this.showHintPopup(j,"builder-version-rollback",function(){h.request("onVersionRollback").done(f.proxy(f.rollbackVersionDone))})},d.prototype.saveVersionDone=function(f){if(void 0===f.builderResponseData){throw new Error("Invalid response data")}var g=this.getMasterTabsActivePane();this.updateUiAfterSave(g,f),f.builderResponseData.isApplied||this.showSavedNotAppliedHint(g)},d.prototype.showSavedNotAppliedHint=function(e){this.showHintPopup(e,"builder-version-save-unapplied")},d.prototype.showHintPopup=function(f,g,h){return this.getDontShowHintAgain(g,f)?void (h&&h.apply(this)):(f.one("hide.oc.popup",this.proxy(this.onHintPopupHide)),h&&f.one("shown.oc.popup",function(k,l,j){j.find("form").one("submit",function(e){return h.apply(this),e.preventDefault(),b(e.target).trigger("close.oc.popup"),!1})}),void f.popup({content:this.getPopupContent(f,g)}))},d.prototype.onHintPopupHide=function(g,j,k){var f=k.find("input[type=checkbox][name=dont_show_again]").is(":checked"),h=k.find("input[type=hidden][name=hint_code]").val();if(k.find("form").off("submit"),f){var l=this.getMasterTabsActivePane().find('form[data-entity="versions"]');l.request("onHideBackendHint",{data:{name:h}}),this.setDontShowHintAgain(h)}},d.prototype.setDontShowHintAgain=function(e){this.hiddenHints[e]=!0},d.prototype.getDontShowHintAgain=function(f,g){return void 0!==this.hiddenHints[f]?this.hiddenHints[f]:"true"==g.find('input[type=hidden][data-hint-hidden="'+f+'"]').val()},d.prototype.getPopupContent=function(f,g){var h=f.find('script[data-version-hint-template="'+g+'"]');if(0===h.length){throw new Error("Version popup template not found: "+g)}return h.html()},d.prototype.updateUiAfterSave=function(f,g){f.find("input[name=original_version]").val(g.builderResponseData.savedVersion),this.updateMasterTabIdAndTitle(f,g.builderResponseData),this.unhideFormDeleteButton(f),this.getVersionList().fileList("markActive",g.builderResponseData.tabId),this.getIndexController().unchangeTab(f)},d.prototype.deleteConfirmed=function(){var f=this.getMasterTabsActivePane(),g=f.find("form");b.oc.stripeLoadIndicator.show(),g.request("onVersionDelete").always(b.oc.builder.indexController.hideStripeIndicatorProxy).done(this.proxy(this.deleteDone))},d.prototype.deleteDone=function(){var e=this.getMasterTabsActivePane();this.getIndexController().unchangeTab(e),this.forceCloseTab(e)},d.prototype.applyVersionDone=function(f){if(void 0===f.builderResponseData){throw new Error("Invalid response data")}var g=this.getMasterTabsActivePane();this.updateUiAfterSave(g,f),this.updateVersionsButtons()},d.prototype.rollbackVersionDone=function(f){if(void 0===f.builderResponseData){throw new Error("Invalid response data")}var g=this.getMasterTabsActivePane();this.updateUiAfterSave(g,f),this.updateVersionsButtons()},d.prototype.getVersionList=function(){return b("#layout-side-panel form[data-content-id=version] [data-control=filelist]")},d.prototype.updateVersionsButtons=function(){for(var q=this.getMasterTabsObject(),m=q.$tabsContainer.find("> li"),g=this.getVersionList(),k=m.length-1;k>=0;k--){var f=b(m[k]),h=f.data("tabId");if(h&&0!=String(h).length){var p=g.find('li[data-id="'+h+'"]');if(p.length){var u=p.data("applied"),j=q.findPaneFromTab(f);u?(j.find('[data-builder-command="version:cmdApplyVersion"]').addClass("hide"),j.find('[data-builder-command="version:cmdRollbackVersion"]').removeClass("hide")):(j.find('[data-builder-command="version:cmdApplyVersion"]').removeClass("hide"),j.find('[data-builder-command="version:cmdRollbackVersion"]').addClass("hide"))}}}},b.oc.builder.entityControllers.version=d}(window.jQuery),+function(b){void 0===b.oc.builder&&(b.oc.builder={}),void 0===b.oc.builder.entityControllers&&(b.oc.builder.entityControllers={});var a=b.oc.builder.entityControllers.base,c=a.prototype,d=function(f){a.call(this,"localization",f)};d.prototype=Object.create(c),d.prototype.constructor=d,d.prototype.cmdCreateLanguage=function(e){this.indexController.openOrLoadMasterTab(b(e.target),"onLanguageCreateOrOpen",this.newTabId())},d.prototype.cmdOpenLanguage=function(f){var g=b(f.currentTarget).data("id"),h=b(f.currentTarget).data("pluginCode");this.indexController.openOrLoadMasterTab(b(f.target),"onLanguageCreateOrOpen",this.makeTabId(h+"-"+g),{original_language:g})},d.prototype.cmdSaveLanguage=function(f){var g=b(f.currentTarget),h=g.closest("form");g.request("onLanguageSave").done(this.proxy(this.saveLanguageDone))},d.prototype.cmdDeleteLanguage=function(f){var g=b(f.currentTarget);b.oc.confirm(g.data("confirm"),this.proxy(this.deleteConfirmed))},d.prototype.cmdCopyMissingStrings=function(g){var h=b(g.currentTarget),j=h.find("select[name=language]").val(),f=this.getMasterTabsActivePane();h.trigger("close.oc.popup"),b.oc.stripeLoadIndicator.show(),f.find("form").request("onLanguageCopyStringsFrom",{data:{copy_from:j}}).always(b.oc.builder.indexController.hideStripeIndicatorProxy).done(this.proxy(this.copyStringsFromDone))},d.prototype.languageUpdated=function(f){var g=this.findDefaultLanguageForm(f);if(g){var h=b(g);h.hasClass("oc-data-changed")?this.mergeLanguageFromServer(h):this.updateLanguageFromServer(h)}},d.prototype.updateOnScreenStrings=function(f){var g=document.body.querySelectorAll('span[data-localization-key][data-plugin="'+f+'"]');b.oc.builder.dataRegistry.get(b("#builder-plugin-selector-panel form"),f,"localization",null,function(h){for(var k=g.length-1;k>=0;k--){var e=g[k],j=e.getAttribute("data-localization-key");void 0!==h[j]?e.textContent=h[j]:e.textContent=j}})},d.prototype.saveLanguageDone=function(f){if(void 0===f.builderResponseData){throw new Error("Invalid response data")}var g=this.getMasterTabsActivePane();if(g.find("input[name=original_language]").val(f.builderResponseData.language),this.updateMasterTabIdAndTitle(g,f.builderResponseData),this.unhideFormDeleteButton(g),this.getLanguageList().fileList("markActive",f.builderResponseData.tabId),this.getIndexController().unchangeTab(g),void 0!==f.builderResponseData.registryData){var h=f.builderResponseData.registryData;b.oc.builder.dataRegistry.set(h.pluginCode,"localization",null,h.strings,{suppressLanguageEditorUpdate:!0}),b.oc.builder.dataRegistry.set(h.pluginCode,"localization","sections",h.sections)}},d.prototype.getLanguageList=function(){return b("#layout-side-panel form[data-content-id=localization] [data-control=filelist]")},d.prototype.getCodeEditor=function(e){return e.find("div[data-field-name=strings] div[data-control=codeeditor]").data("oc.codeEditor").editor},d.prototype.deleteConfirmed=function(){var f=this.getMasterTabsActivePane(),g=f.find("form");b.oc.stripeLoadIndicator.show(),g.request("onLanguageDelete").always(b.oc.builder.indexController.hideStripeIndicatorProxy).done(this.proxy(this.deleteDone))},d.prototype.deleteDone=function(){var e=this.getMasterTabsActivePane();this.getIndexController().unchangeTab(e),this.forceCloseTab(e)},d.prototype.copyStringsFromDone=function(u){if(void 0===u.builderResponseData){throw new Error("Invalid response data")}var m=u.builderResponseData,g=this.getMasterTabsActivePane(),k=g.find("form"),f=this.getCodeEditor(g),h=k.data("newStringMessage"),q=k.data("structureMismatch");f.getSession().setValue(m.strings);for(var v=[],j=m.updatedLines.length-1;j>=0;j--){var p=m.updatedLines[j];v.push({row:p,column:0,text:h,type:"warning"})}f.getSession().setAnnotations(v),m.mismatch&&b.oc.alert(q)},d.prototype.findDefaultLanguageForm=function(g){for(var j=document.body.querySelectorAll("form[data-entity=localization]"),k=j.length-1;k>=0;k--){var f=j[k],h=f.querySelector("input[name=plugin_code]"),l=f.querySelector("input[name=original_language]");if(h&&h.value==g&&l&&f.getAttribute("data-default-language")==l.value){return f}}return null},d.prototype.updateLanguageFromServer=function(f){var g=this;f.request("onLanguageGetStrings").done(function(e){g.updateLanguageFromServerDone(f,e)})},d.prototype.updateLanguageFromServerDone=function(g,j){if(void 0===j.builderResponseData){throw new Error("Invalid response data")}var k=j.builderResponseData,f=g.closest(".tab-pane"),h=this.getCodeEditor(f);k.strings&&(h.getSession().setValue(k.strings),this.unmodifyTab(f))},d.prototype.mergeLanguageFromServer=function(f){var g=f.find("input[name=original_language]").val(),h=this;f.request("onLanguageCopyStringsFrom",{data:{copy_from:g}}).done(function(i){h.mergeLanguageFromServerDone(f,i)})},d.prototype.mergeLanguageFromServerDone=function(g,j){if(void 0===j.builderResponseData){throw new Error("Invalid response data")}var k=j.builderResponseData,f=g.closest(".tab-pane"),h=this.getCodeEditor(f);h.getSession().setValue(k.strings),h.getSession().setAnnotations([])},b.oc.builder.entityControllers.localization=d}(window.jQuery),+function(b){void 0===b.oc.builder&&(b.oc.builder={}),void 0===b.oc.builder.entityControllers&&(b.oc.builder.entityControllers={});var a=b.oc.builder.entityControllers.base,c=a.prototype,d=function(f){a.call(this,"controller",f)};d.prototype=Object.create(c),d.prototype.constructor=d,d.prototype.cmdCreateController=function(g){var j=b(g.currentTarget),k=this,f=j.data("pluginCode"),h=j.find('input[name="behaviors[]"]:checked').length,l=null;l=h?this.indexController.openOrLoadMasterTab(j,"onControllerCreate",this.makeTabId(f+"-new-controller"),{}):j.request("onControllerCreate"),l.done(function(e){j.trigger("close.oc.popup"),k.updateDataRegistry(e)}).always(b.oc.builder.indexController.hideStripeIndicatorProxy)},d.prototype.cmdOpenController=function(f){var g=b(f.currentTarget).data("id"),h=b(f.currentTarget).data("pluginCode");this.indexController.openOrLoadMasterTab(b(f.target),"onControllerOpen",this.makeTabId(h+"-"+g),{controller:g})},d.prototype.cmdSaveController=function(g){var h=b(g.currentTarget),j=h.closest("form"),f=j.find(".inspector-container");b.oc.inspector.manager.applyValuesFromContainer(f)&&h.request("onControllerSave").done(this.proxy(this.saveControllerDone))},d.prototype.saveControllerDone=function(f){if(void 0===f.builderResponseData){throw new Error("Invalid response data")}var g=this.getMasterTabsActivePane();this.getIndexController().unchangeTab(g)},d.prototype.updateDataRegistry=function(f){if(void 0!==f.builderResponseData.registryData){var g=f.builderResponseData.registryData;b.oc.builder.dataRegistry.set(g.pluginCode,"controller-urls",null,g.urls)}},d.prototype.getControllerList=function(){return b("#layout-side-panel form[data-content-id=controller] [data-control=filelist]")},b.oc.builder.entityControllers.controller=d}(window.jQuery),+function(b){void 0===b.oc.builder&&(b.oc.builder={});var a=b.oc.foundation.base,c=a.prototype,d=function(){a.call(this),this.$masterTabs=null,this.masterTabsObj=null,this.hideStripeIndicatorProxy=null,this.entityControllers={},this.init()};d.prototype=Object.create(c),d.prototype.constructor=d,d.prototype.dispose=function(){c.dispose.call(this)},d.prototype.openOrLoadMasterTab=function(g,j,k,f){if(this.masterTabsObj.goTo(k)){return !1}var h=void 0===f?{}:f;b.oc.stripeLoadIndicator.show();var l=g.request(j,{data:h}).done(this.proxy(this.addMasterTab)).always(this.hideStripeIndicatorProxy);return l},d.prototype.getMasterTabActivePane=function(){return this.$masterTabs.find("> .tab-content > .tab-pane.active")},d.prototype.unchangeTab=function(e){e.find("form").trigger("unchange.oc.changeMonitor")},d.prototype.triggerCommand=function(g,j){var k=g.split(":");if(2===k.length){var f=k[0],h=k[1];if(void 0===this.entityControllers[f]){throw new Error("Unknown entity type: "+f)}this.entityControllers[f].invokeCommand(h,j)}},d.prototype.init=function(){this.$masterTabs=b("#builder-master-tabs"),this.$sidePanel=b("#builder-side-panel"),this.masterTabsObj=this.$masterTabs.data("oc.tab"),this.hideStripeIndicatorProxy=this.proxy(this.hideStripeIndicator),new b.oc.tabFormExpandControls(this.$masterTabs),this.createEntityControllers(),this.registerHandlers()},d.prototype.createEntityControllers=function(){for(var e in b.oc.builder.entityControllers){"base"!=e&&(this.entityControllers[e]=new b.oc.builder.entityControllers[e](this))}},d.prototype.registerHandlers=function(){b(document).on("click","[data-builder-command]",this.proxy(this.onCommand)),b(document).on("submit","[data-builder-command]",this.proxy(this.onCommand)),this.$masterTabs.on("changed.oc.changeMonitor",this.proxy(this.onFormChanged)),this.$masterTabs.on("unchanged.oc.changeMonitor",this.proxy(this.onFormUnchanged)),this.$masterTabs.on("shown.bs.tab",this.proxy(this.onTabShown)),this.$masterTabs.on("afterAllClosed.oc.tab",this.proxy(this.onAllTabsClosed)),this.$masterTabs.on("closed.oc.tab",this.proxy(this.onTabClosed)),this.$masterTabs.on("autocompleteitems.oc.inspector",this.proxy(this.onDataRegistryItems)),this.$masterTabs.on("dropdownoptions.oc.inspector",this.proxy(this.onDataRegistryItems));for(var e in this.entityControllers){void 0!==this.entityControllers[e].registerHandlers&&this.entityControllers[e].registerHandlers()}},d.prototype.hideStripeIndicator=function(){b.oc.stripeLoadIndicator.hide()},d.prototype.addMasterTab=function(f){if(this.masterTabsObj.addTab(f.tabTitle,f.tab,f.tabId,"oc-"+f.tabIcon),f.isNewRecord){var g=this.getMasterTabActivePane();g.find("form").one("ready.oc.changeMonitor",this.proxy(this.onChangeMonitorReady))}},d.prototype.updateModifiedCounter=function(){var e={database:{menu:"database",count:0},models:{menu:"models",count:0},permissions:{menu:"permissions",count:0},menus:{menu:"menus",count:0},versions:{menu:"versions",count:0},localization:{menu:"localization",count:0},controller:{menu:"controllers",count:0}};b("> div.tab-content > div.tab-pane[data-modified] > form",this.$masterTabs).each(function(){var f=b(this).data("entity");e[f].count++}),b.each(e,function(f,g){b.oc.sideNav.setCounter("builder/"+g.menu,g.count)})},d.prototype.getFormPluginCode=function(g){var h=b(g).closest("form"),j=h.find('input[name="plugin_code"]'),f=j.val();if(!f){throw new Error("Plugin code input is not found in the form.")}return f},d.prototype.setPageTitle=function(e){b.oc.layout.setPageTitle(e.length?e+" | ":e)},d.prototype.getFileLists=function(){return b("[data-control=filelist]",this.$sidePanel)},d.prototype.dataToInspectorArray=function(g){var h=[];for(var j in g){var f={title:g[j],value:j};h.push(f)}return h},d.prototype.onCommand=function(f){if("FORM"!=f.currentTarget.tagName||"click"!=f.type){var g=b(f.currentTarget).data("builderCommand");this.triggerCommand(g,f);var h=b(f.currentTarget);if("A"!==f.currentTarget.tagName||"menuitem"!=h.attr("role")||"javascript:;"!=h.attr("href")){return f.preventDefault(),!1}}},d.prototype.onFormChanged=function(e){b(".form-tabless-fields",e.target).trigger("modified.oc.tab"),this.updateModifiedCounter()},d.prototype.onFormUnchanged=function(e){b(".form-tabless-fields",e.target).trigger("unmodified.oc.tab"),this.updateModifiedCounter()},d.prototype.onTabShown=function(g){var h=b(g.target).closest("[data-control=tab]");if(h.attr("id")==this.$masterTabs.attr("id")){var j=b(g.target).closest("li").attr("data-tab-id"),f=b(g.target).attr("title");f&&this.setPageTitle(f),this.getFileLists().fileList("markActive",j),b(window).trigger("resize")}},d.prototype.onAllTabsClosed=function(e){this.setPageTitle(""),this.getFileLists().fileList("markActive",null)},d.prototype.onTabClosed=function(f,g,h){b(h).find("form").off("ready.oc.changeMonitor",this.proxy(this.onChangeMonitorReady)),this.updateModifiedCounter()},d.prototype.onChangeMonitorReady=function(e){b(e.target).trigger("change")},d.prototype.onDataRegistryItems=function(g,j){var k=this;if("model-classes"==j.propertyDefinition.fillFrom||"model-forms"==j.propertyDefinition.fillFrom||"model-lists"==j.propertyDefinition.fillFrom||"controller-urls"==j.propertyDefinition.fillFrom||"model-columns"==j.propertyDefinition.fillFrom||"plugin-lists"==j.propertyDefinition.fillFrom||"permissions"==j.propertyDefinition.fillFrom){g.preventDefault();var f=null,h=j.propertyDefinition.subtypeFrom;void 0!==h&&(f=j.values[h]),b.oc.builder.dataRegistry.get(b(g.target),this.getFormPluginCode(g.target),j.propertyDefinition.fillFrom,f,function(e){j.callback({options:k.dataToInspectorArray(e)})})}},b(document).ready(function(){b.oc.builder.indexController=new d})}(window.jQuery),+function(b){void 0===b.oc.builder&&(b.oc.builder={});var a=b.oc.foundation.base,c=a.prototype,d=function(h,f,g){this.input=h,this.form=f,this.options=b.extend({},d.DEFAULTS,g),this.disposed=!1,this.initialized=!1,this.newStringPopupMarkup=null,a.call(this),this.init()};d.prototype=Object.create(c),d.prototype.constructor=d,d.prototype.dispose=function(){this.unregisterHandlers(),this.form=null,this.options.beforePopupShowCallback=null,this.options.afterPopupHideCallback=null,this.options=null,this.disposed=!0,this.newStringPopupMarkup=null,this.initialized&&b(this.input).autocomplete("destroy"),b(this.input).removeData("localization-input"),this.input=null,c.dispose.call(this)},d.prototype.init=function(){if(!this.options.plugin){throw new Error("The options.plugin value should be set in the localization input object.")}var e=b(this.input);e.data("localization-input",this),e.attr("data-builder-localization-input","true"),e.attr("data-builder-localization-plugin",this.options.plugin),this.getContainer().addClass("localization-input-container"),this.registerHandlers(),this.loadDataAndBuild()},d.prototype.buildAddLink=function(){var f=this.getContainer();if(!(f.find("a.localization-trigger").length>0)){var g=document.createElement("a");g.setAttribute("class","oc-icon-plus localization-trigger"),g.setAttribute("href","#");var h=f.position();b(g).css({top:h.top+4,right:7}),f.append(g)}},d.prototype.loadDataAndBuild=function(){this.showLoadingIndicator();var f=b.oc.builder.dataRegistry.get(this.form,this.options.plugin,"localization",null,this.proxy(this.dataLoaded)),g=this;f&&f.always(function(){g.hideLoadingIndicator()})},d.prototype.reload=function(){b.oc.builder.dataRegistry.get(this.form,this.options.plugin,"localization",null,this.proxy(this.dataLoaded))},d.prototype.dataLoaded=function(g){if(!this.disposed){var h=b(this.input),j=h.data("autocomplete");if(j){j.source=this.preprocessData(g)}else{this.hideLoadingIndicator();var f={source:this.preprocessData(g),matchWidth:!0};f=b.extend(f,this.options.autocompleteOptions),b(this.input).autocomplete(f),this.initialized=!0}}},d.prototype.preprocessData=function(f){var g=b.extend({},f);for(var h in g){g[h]=h+" - "+g[h]}return g},d.prototype.getContainer=function(){return b(this.input).closest(".autocomplete-container")},d.prototype.showLoadingIndicator=function(){var e=this.getContainer();e.addClass("loading-indicator-container size-small"),e.loadIndicator()},d.prototype.hideLoadingIndicator=function(){var e=this.getContainer();e.loadIndicator("hide"),e.loadIndicator("destroy"),e.removeClass("loading-indicator-container")},d.prototype.loadAndShowPopup=function(){null===this.newStringPopupMarkup?(b.oc.stripeLoadIndicator.show(),b(this.input).request("onLanguageLoadAddStringForm").done(this.proxy(this.popupMarkupLoaded)).always(function(){b.oc.stripeLoadIndicator.hide()})):this.showPopup()},d.prototype.popupMarkupLoaded=function(e){this.newStringPopupMarkup=e.markup,this.showPopup()},d.prototype.showPopup=function(){var f=b(this.input);f.popup({content:this.newStringPopupMarkup});var g=f.data("oc.popup").$content,h=g.find("#language_string_key");b.oc.builder.dataRegistry.get(this.form,this.options.plugin,"localization","sections",function(e){h.autocomplete({source:e,matchWidth:!0})}),g.find("form").on("submit",this.proxy(this.onSubmitPopupForm))},d.prototype.stringCreated=function(f){if(void 0===f.localizationData||void 0===f.registryData){throw new Error("Invalid server response.")}var g=b(this.input);g.val(f.localizationData.key),b.oc.builder.dataRegistry.set(this.options.plugin,"localization",null,f.registryData.strings),b.oc.builder.dataRegistry.set(this.options.plugin,"localization","sections",f.registryData.sections),g.data("oc.popup").hide(),g.trigger("change")},d.prototype.onSubmitPopupForm=function(f){var g=b(f.target);return b.oc.stripeLoadIndicator.show(),g.request("onLanguageCreateString",{data:{plugin_code:this.options.plugin}}).done(this.proxy(this.stringCreated)).always(function(){b.oc.stripeLoadIndicator.hide()}),f.preventDefault(),!1},d.prototype.onPopupHidden=function(f,g,h){b(h).find("#language_string_key").autocomplete("destroy"),b(h).find("form").on("submit",this.proxy(this.onSubmitPopupForm)),this.options.afterPopupHideCallback&&this.options.afterPopupHideCallback()},d.updatePluginInputs=function(f){for(var g=document.body.querySelectorAll('input[data-builder-localization-input][data-builder-localization-plugin="'+f+'"]'),h=g.length-1;h>=0;h--){b(g[h]).data("localization-input").reload()}},d.prototype.unregisterHandlers=function(){this.input.removeEventListener("focus",this.proxy(this.onInputFocus)),this.getContainer().off("click","a.localization-trigger",this.proxy(this.onTriggerClick)),b(this.input).off("hidden.oc.popup",this.proxy(this.onPopupHidden))},d.prototype.registerHandlers=function(){this.input.addEventListener("focus",this.proxy(this.onInputFocus)),this.getContainer().on("click","a.localization-trigger",this.proxy(this.onTriggerClick)),b(this.input).on("hidden.oc.popup",this.proxy(this.onPopupHidden))},d.prototype.onInputFocus=function(){this.buildAddLink()},d.prototype.onTriggerClick=function(e){return this.options.beforePopupShowCallback&&this.options.beforePopupShowCallback(),this.loadAndShowPopup(),e.preventDefault(),!1},d.DEFAULTS={plugin:null,autocompleteOptions:{},beforePopupShowCallback:null,afterPopupHideCallback:null},b.oc.builder.localizationInput=d}(window.jQuery),+function(b){var a=b.oc.inspector.propertyEditors.string,c=a.prototype,d=function(h,j,f,g){this.localizationInput=null,a.call(this,h,j,f,g)};d.prototype=Object.create(c),d.prototype.constructor=a,d.prototype.dispose=function(){this.removeLocalizationInput(),c.dispose.call(this)},d.prototype.build=function(){var g=document.createElement("div"),h=document.createElement("input"),j=void 0!==this.propertyDefinition.placeholder?this.propertyDefinition.placeholder:"",f=this.inspector.getPropertyValue(this.propertyDefinition.property);h.setAttribute("type","text"),h.setAttribute("class","string-editor"),h.setAttribute("placeholder",j),g.setAttribute("class","autocomplete-container"),void 0===f&&(f=this.propertyDefinition["default"]),void 0===f&&(f=""),h.value=f,b.oc.foundation.element.addClass(this.containerCell,"text autocomplete"),g.appendChild(h),this.containerCell.appendChild(g),this.buildLocalizationEditor()},d.prototype.buildLocalizationEditor=function(){this.localizationInput=new b.oc.builder.localizationInput(this.getInput(),this.getForm(),{plugin:this.getPluginCode(),beforePopupShowCallback:this.proxy(this.onPopupShown,this),afterPopupHideCallback:this.proxy(this.onPopupHidden,this)})},d.prototype.removeLocalizationInput=function(){this.localizationInput.dispose(),this.localizationInput=null},d.prototype.supportsExternalParameterEditor=function(){return !1},d.prototype.registerHandlers=function(){c.registerHandlers.call(this),b(this.getInput()).on("change",this.proxy(this.onInputKeyUp))},d.prototype.unregisterHandlers=function(){c.unregisterHandlers.call(this),b(this.getInput()).off("change",this.proxy(this.onInputKeyUp))},d.prototype.getForm=function(){var e=this.getRootSurface().getInspectableElement();if(!e){throw new Error("Cannot determine inspectable element in the Builder localization editor.")}return b(e).closest("form")},d.prototype.getPluginCode=function(){var f=this.getForm(),g=f.find("input[name=plugin_code]");if(!g.length){throw new Error('The input "plugin_code" should be defined in the form in order to use the localization Inspector editor.')}return g.val()},d.prototype.onPopupShown=function(){this.getRootSurface().popupDisplayed()},d.prototype.onPopupHidden=function(){this.getRootSurface().popupHidden()},b.oc.inspector.propertyEditors.builderLocalization=d}(window.jQuery),+function(b){if(void 0===b.oc.table){throw new Error("The $.oc.table namespace is not defined. Make sure that the table.js script is loaded.")}if(void 0===b.oc.table.processor){throw new Error("The $.oc.table.processor namespace is not defined. Make sure that the table.processor.base.js script is loaded.")}var a=b.oc.table.processor.string,c=a.prototype,d=function(g,h,f){this.localizationInput=null,this.popupDisplayed=!1,a.call(this,g,h,f)};d.prototype=Object.create(c),d.prototype.constructor=d,d.prototype.dispose=function(){this.removeLocalizationInput(),c.dispose.call(this)},d.prototype.onUnfocus=function(){this.activeCell&&!this.popupDisplayed&&(this.removeLocalizationInput(),c.onUnfocus.call(this))},d.prototype.onBeforePopupShow=function(){this.popupDisplayed=!0},d.prototype.onAfterPopupHide=function(){this.popupDisplayed=!1},d.prototype.renderCell=function(e,f){c.renderCell.call(this,e,f)},d.prototype.buildEditor=function(f,g,e){c.buildEditor.call(this,f,g,e),b.oc.foundation.element.addClass(g,"autocomplete-container"),this.buildLocalizationEditor()},d.prototype.buildLocalizationEditor=function(){var e=this.getInput();this.localizationInput=new b.oc.builder.localizationInput(e,b(e),{plugin:this.getPluginCode(e),beforePopupShowCallback:b.proxy(this.onBeforePopupShow,this),afterPopupHideCallback:b.proxy(this.onAfterPopupHide,this),autocompleteOptions:{menu:'<ul class="autocomplete dropdown-menu table-widget-autocomplete localization"></ul>',bodyContainer:!0}})},d.prototype.getInput=function(){return this.activeCell?this.activeCell.querySelector(".string-input"):null},d.prototype.getPluginCode=function(f){var g=b(f).closest("form"),h=g.find("input[name=plugin_code]");if(!h.length){throw new Error('The input "plugin_code" should be defined in the form in order to use the localization table processor.')}return h.val()},d.prototype.removeLocalizationInput=function(){this.localizationInput&&(this.localizationInput.dispose(),this.localizationInput=null)},b.oc.table.processor.builderLocalization=d}(window.jQuery);