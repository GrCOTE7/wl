+function(c){if(c.oc.builder===undefined){c.oc.builder={}}var b=c.oc.foundation.base,a=b.prototype;var d=function(){this.data={};this.requestCache={};this.callbackCache={};b.call(this)};d.prototype.set=function(g,f,e,h,i){this.storeData(g,f,e,h);if(f=="localization"&&!e){this.localizationUpdated(g,i)}};d.prototype.get=function(i,g,f,e,h){if(this.data[g]===undefined||this.data[g][f]===undefined||this.data[g][f][e]===undefined||this.isCacheObsolete(this.data[g][f][e].timestamp)){return this.loadDataFromServer(i,g,f,e,h)}h(this.data[g][f][e].data)};d.prototype.makeCacheKey=function(h,g,e){var f=h+"-"+g;if(e){f+="-"+e}return f};d.prototype.isCacheObsolete=function(e){return(Date.now()-e)>60000*5};d.prototype.loadDataFromServer=function(k,h,g,e,j){var f=this,i=this.makeCacheKey(h,g,e);if(this.requestCache[i]===undefined){this.requestCache[i]=k.request("onPluginDataRegistryGetData",{data:{registry_plugin_code:h,registry_data_type:g,registry_data_subtype:e}}).done(function(l){if(l.registryData===undefined){throw new Error("Invalid data registry response.")}f.storeData(h,g,e,l.registryData);f.applyCallbacks(i,l.registryData);f.requestCache[i]=undefined})}this.addCallbackToQueue(j,i);return this.requestCache[i]};d.prototype.addCallbackToQueue=function(f,e){if(this.callbackCache[e]===undefined){this.callbackCache[e]=[]}this.callbackCache[e].push(f)};d.prototype.applyCallbacks=function(f,g){if(this.callbackCache[f]===undefined){return}for(var e=this.callbackCache[f].length-1;e>=0;e--){this.callbackCache[f][e](g)}delete this.callbackCache[f]};d.prototype.storeData=function(h,g,e,i){if(this.data[h]===undefined){this.data[h]={}}if(this.data[h][g]===undefined){this.data[h][g]={}}var f={timestamp:Date.now(),data:i};this.data[h][g][e]=f};d.prototype.clearCache=function(f,e){if(this.data[f]===undefined){return}if(this.data[f][e]===undefined){return}this.data[f][e]=undefined};d.prototype.getLocalizationString=function(h,f,e,g){this.get(h,f,"localization",null,function(i){if(i[e]!==undefined){g(i[e]);return}g(e)})};d.prototype.localizationUpdated=function(e,f){c.oc.builder.localizationInput.updatePluginInputs(e);if(f===undefined||!f.suppressLanguageEditorUpdate){c.oc.builder.indexController.entityControllers.localization.languageUpdated(e)}c.oc.builder.indexController.entityControllers.localization.updateOnScreenStrings(e)};c.oc.builder.dataRegistry=new d()}(window.jQuery);