+function(c){if(c.oc.builder===undefined){c.oc.builder={}}if(c.oc.builder.entityControllers===undefined){c.oc.builder.entityControllers={}}var b=c.oc.builder.entityControllers.base,a=b.prototype;var d=function(e){b.call(this,"localization",e)};d.prototype=Object.create(a);d.prototype.constructor=d;d.prototype.cmdCreateLanguage=function(e){this.indexController.openOrLoadMasterTab(c(e.target),"onLanguageCreateOrOpen",this.newTabId())};d.prototype.cmdOpenLanguage=function(e){var g=c(e.currentTarget).data("id"),f=c(e.currentTarget).data("pluginCode");this.indexController.openOrLoadMasterTab(c(e.target),"onLanguageCreateOrOpen",this.makeTabId(f+"-"+g),{original_language:g})};d.prototype.cmdSaveLanguage=function(g){var e=c(g.currentTarget),f=e.closest("form");e.request("onLanguageSave").done(this.proxy(this.saveLanguageDone))};d.prototype.cmdDeleteLanguage=function(f){var e=c(f.currentTarget);c.oc.confirm(e.data("confirm"),this.proxy(this.deleteConfirmed))};d.prototype.cmdCopyMissingStrings=function(f){var e=c(f.currentTarget),h=e.find("select[name=language]").val(),g=this.getMasterTabsActivePane();e.trigger("close.oc.popup");c.oc.stripeLoadIndicator.show();g.find("form").request("onLanguageCopyStringsFrom",{data:{copy_from:h}}).always(c.oc.builder.indexController.hideStripeIndicatorProxy).done(this.proxy(this.copyStringsFromDone))};d.prototype.languageUpdated=function(e){var g=this.findDefaultLanguageForm(e);if(!g){return}var f=c(g);if(!f.hasClass("oc-data-changed")){this.updateLanguageFromServer(f)}else{this.mergeLanguageFromServer(f)}};d.prototype.updateOnScreenStrings=function(f){var e=document.body.querySelectorAll('span[data-localization-key][data-plugin="'+f+'"]');c.oc.builder.dataRegistry.get(c("#builder-plugin-selector-panel form"),f,"localization",null,function(j){for(var g=e.length-1;g>=0;g--){var k=e[g],h=k.getAttribute("data-localization-key");if(j[h]!==undefined){k.textContent=j[h]}else{k.textContent=h}}})};d.prototype.saveLanguageDone=function(f){if(f.builderResponseData===undefined){throw new Error("Invalid response data")}var g=this.getMasterTabsActivePane();g.find("input[name=original_language]").val(f.builderResponseData.language);this.updateMasterTabIdAndTitle(g,f.builderResponseData);this.unhideFormDeleteButton(g);this.getLanguageList().fileList("markActive",f.builderResponseData.tabId);this.getIndexController().unchangeTab(g);if(f.builderResponseData.registryData!==undefined){var e=f.builderResponseData.registryData;c.oc.builder.dataRegistry.set(e.pluginCode,"localization",null,e.strings,{suppressLanguageEditorUpdate:true});c.oc.builder.dataRegistry.set(e.pluginCode,"localization","sections",e.sections)}};d.prototype.getLanguageList=function(){return c("#layout-side-panel form[data-content-id=localization] [data-control=filelist]")};d.prototype.getCodeEditor=function(e){return e.find("div[data-field-name=strings] div[data-control=codeeditor]").data("oc.codeEditor").editor};d.prototype.deleteConfirmed=function(){var f=this.getMasterTabsActivePane(),e=f.find("form");c.oc.stripeLoadIndicator.show();e.request("onLanguageDelete").always(c.oc.builder.indexController.hideStripeIndicatorProxy).done(this.proxy(this.deleteDone))};d.prototype.deleteDone=function(){var e=this.getMasterTabsActivePane();this.getIndexController().unchangeTab(e);this.forceCloseTab(e)};d.prototype.copyStringsFromDone=function(k){if(k.builderResponseData===undefined){throw new Error("Invalid response data")}var f=k.builderResponseData,h=this.getMasterTabsActivePane(),o=h.find("form"),g=this.getCodeEditor(h),m=o.data("newStringMessage"),e=o.data("structureMismatch");g.getSession().setValue(f.strings);var l=[];for(var j=f.updatedLines.length-1;j>=0;j--){var n=f.updatedLines[j];l.push({row:n,column:0,text:m,type:"warning"})}g.getSession().setAnnotations(l);if(f.mismatch){c.oc.alert(e)}};d.prototype.findDefaultLanguageForm=function(j){var f=document.body.querySelectorAll("form[data-entity=localization]");for(var g=f.length-1;g>=0;g--){var h=f[g],e=h.querySelector("input[name=plugin_code]"),k=h.querySelector("input[name=original_language]");if(!e||e.value!=j){continue}if(!k){continue}if(h.getAttribute("data-default-language")==k.value){return h}}return null};d.prototype.updateLanguageFromServer=function(f){var e=this;f.request("onLanguageGetStrings").done(function(g){e.updateLanguageFromServerDone(f,g)})};d.prototype.updateLanguageFromServerDone=function(i,h){if(h.builderResponseData===undefined){throw new Error("Invalid response data")}var g=h.builderResponseData,e=i.closest(".tab-pane"),f=this.getCodeEditor(e);if(!g.strings){return}f.getSession().setValue(g.strings);this.unmodifyTab(e)};d.prototype.mergeLanguageFromServer=function(f){var g=f.find("input[name=original_language]").val(),e=this;f.request("onLanguageCopyStringsFrom",{data:{copy_from:g}}).done(function(h){e.mergeLanguageFromServerDone(f,h)})};d.prototype.mergeLanguageFromServerDone=function(i,h){if(h.builderResponseData===undefined){throw new Error("Invalid response data")}var g=h.builderResponseData,e=i.closest(".tab-pane"),f=this.getCodeEditor(e);f.getSession().setValue(g.strings);f.getSession().setAnnotations([])};c.oc.builder.entityControllers.localization=d}(window.jQuery);