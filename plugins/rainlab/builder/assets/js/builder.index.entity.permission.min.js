+function(d){if(d.oc.builder===undefined){d.oc.builder={}}if(d.oc.builder.entityControllers===undefined){d.oc.builder.entityControllers={}}var b=d.oc.builder.entityControllers.base,a=b.prototype;var c=function(e){b.call(this,"permissions",e)};c.prototype=Object.create(a);c.prototype.constructor=c;c.prototype.registerHandlers=function(){this.indexController.$masterTabs.on("oc.tableNewRow",this.proxy(this.onTableRowCreated))};c.prototype.cmdOpenPermissions=function(f){var e=this.getSelectedPlugin();if(!e){alert("Please select a plugin first");return}this.indexController.openOrLoadMasterTab(d(f.target),"onPermissionsOpen",this.makeTabId(e))};c.prototype.cmdSavePermissions=function(g){var e=d(g.currentTarget),f=e.closest("form");if(!this.validateTable(e)){return}e.request("onPermissionsSave",{data:{permissions:this.getTableData(e)}}).done(this.proxy(this.savePermissionsDone))};c.prototype.getTableControlObject=function(e){var f=e.closest("form"),g=f.find("[data-control=table]"),h=g.data("oc.table");if(!h){throw new Error("Table object is not found on permissions tab")}return h};c.prototype.validateTable=function(e){var f=this.getTableControlObject(e);f.unfocusTable();return f.validate()};c.prototype.getTableData=function(e){var f=this.getTableControlObject(e);return f.dataSource.getAllData()};c.prototype.savePermissionsDone=function(e){if(e.builderResponseData===undefined){throw new Error("Invalid response data")}var f=this.getMasterTabsActivePane();this.getIndexController().unchangeTab(f);d.oc.builder.dataRegistry.clearCache(e.builderResponseData.pluginCode,"permissions")};c.prototype.onTableRowCreated=function(h,f){var e=d(h.target);if(e.data("alias")!="permissions"){return}var g=e.closest("form");if(g.data("entity")!="permissions"){return}var i=g.find("input[name=plugin_code]").val();f.permission=i.toLowerCase()+"."};d.oc.builder.entityControllers.permission=c}(window.jQuery);