+function(c){if(c.oc.builder===undefined){c.oc.builder={}}if(c.oc.builder.entityControllers===undefined){c.oc.builder.entityControllers={}}var b=c.oc.builder.entityControllers.base,a=b.prototype;var d=function(e){b.call(this,"version",e);this.hiddenHints={}};d.prototype=Object.create(a);d.prototype.constructor=d;d.prototype.cmdCreateVersion=function(g){var e=c(g.currentTarget),f=e.data("versionType");this.indexController.openOrLoadMasterTab(e,"onVersionCreateOrOpen",this.newTabId(),{version_type:f})};d.prototype.cmdSaveVersion=function(g){var e=c(g.currentTarget),f=e.closest("form");e.request("onVersionSave").done(this.proxy(this.saveVersionDone))};d.prototype.cmdOpenVersion=function(f){var e=c(f.currentTarget).data("id"),g=c(f.currentTarget).data("pluginCode");this.indexController.openOrLoadMasterTab(c(f.target),"onVersionCreateOrOpen",this.makeTabId(g+"-"+e),{original_version:e})};d.prototype.cmdDeleteVersion=function(f){var e=c(f.currentTarget);c.oc.confirm(e.data("confirm"),this.proxy(this.deleteConfirmed))};d.prototype.cmdApplyVersion=function(h){var e=c(h.currentTarget),g=e.closest("div.tab-pane"),f=this;this.showHintPopup(g,"builder-version-apply",function(){e.request("onVersionApply").done(f.proxy(f.applyVersionDone))})};d.prototype.cmdRollbackVersion=function(h){var e=c(h.currentTarget),g=e.closest("div.tab-pane"),f=this;this.showHintPopup(g,"builder-version-rollback",function(){e.request("onVersionRollback").done(f.proxy(f.rollbackVersionDone))})};d.prototype.saveVersionDone=function(e){if(e.builderResponseData===undefined){throw new Error("Invalid response data")}var f=this.getMasterTabsActivePane();this.updateUiAfterSave(f,e);if(!e.builderResponseData.isApplied){this.showSavedNotAppliedHint(f)}};d.prototype.showSavedNotAppliedHint=function(e){this.showHintPopup(e,"builder-version-save-unapplied")};d.prototype.showHintPopup=function(f,e,g){if(this.getDontShowHintAgain(e,f)){if(g){g.apply(this)}return}f.one("hide.oc.popup",this.proxy(this.onHintPopupHide));if(g){f.one("shown.oc.popup",function(j,h,i){i.find("form").one("submit",function(k){g.apply(this);k.preventDefault();c(k.target).trigger("close.oc.popup");return false})})}f.popup({content:this.getPopupContent(f,e)})};d.prototype.onHintPopupHide=function(i,e,g){var j=g.find("input[type=checkbox][name=dont_show_again]").is(":checked"),h=g.find("input[type=hidden][name=hint_code]").val();g.find("form").off("submit");if(!j){return}var f=this.getMasterTabsActivePane().find('form[data-entity="versions"]');f.request("onHideBackendHint",{data:{name:h}});this.setDontShowHintAgain(h)};d.prototype.setDontShowHintAgain=function(e){this.hiddenHints[e]=true};d.prototype.getDontShowHintAgain=function(f,e){if(this.hiddenHints[f]!==undefined){return this.hiddenHints[f]}return e.find('input[type=hidden][data-hint-hidden="'+f+'"]').val()=="true"};d.prototype.getPopupContent=function(g,f){var e=g.find('script[data-version-hint-template="'+f+'"]');if(e.length===0){throw new Error("Version popup template not found: "+f)}return e.html()};d.prototype.updateUiAfterSave=function(f,e){f.find("input[name=original_version]").val(e.builderResponseData.savedVersion);this.updateMasterTabIdAndTitle(f,e.builderResponseData);this.unhideFormDeleteButton(f);this.getVersionList().fileList("markActive",e.builderResponseData.tabId);this.getIndexController().unchangeTab(f)};d.prototype.deleteConfirmed=function(){var f=this.getMasterTabsActivePane(),e=f.find("form");c.oc.stripeLoadIndicator.show();e.request("onVersionDelete").always(c.oc.builder.indexController.hideStripeIndicatorProxy).done(this.proxy(this.deleteDone))};d.prototype.deleteDone=function(){var e=this.getMasterTabsActivePane();this.getIndexController().unchangeTab(e);this.forceCloseTab(e)};d.prototype.applyVersionDone=function(e){if(e.builderResponseData===undefined){throw new Error("Invalid response data")}var f=this.getMasterTabsActivePane();this.updateUiAfterSave(f,e);this.updateVersionsButtons()};d.prototype.rollbackVersionDone=function(e){if(e.builderResponseData===undefined){throw new Error("Invalid response data")}var f=this.getMasterTabsActivePane();this.updateUiAfterSave(f,e);this.updateVersionsButtons()};d.prototype.getVersionList=function(){return c("#layout-side-panel form[data-content-id=version] [data-control=filelist]")};d.prototype.updateVersionsButtons=function(){var l=this.getMasterTabsObject(),j=l.$tabsContainer.find("> li"),h=this.getVersionList();for(var g=j.length-1;g>=0;g--){var m=c(j[g]),f=m.data("tabId");if(!f||String(f).length==0){continue}var k=h.find('li[data-id="'+f+'"]');if(!k.length){continue}var n=k.data("applied"),e=l.findPaneFromTab(m);if(n){e.find('[data-builder-command="version:cmdApplyVersion"]').addClass("hide");e.find('[data-builder-command="version:cmdRollbackVersion"]').removeClass("hide")}else{e.find('[data-builder-command="version:cmdApplyVersion"]').removeClass("hide");e.find('[data-builder-command="version:cmdRollbackVersion"]').addClass("hide")}}};c.oc.builder.entityControllers.version=d}(window.jQuery);