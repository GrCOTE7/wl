+function(c){if(c.oc.builder===undefined){c.oc.builder={}}var b=c.oc.foundation.base,a=b.prototype;var d=function(){b.call(this);this.$masterTabs=null;this.masterTabsObj=null;this.hideStripeIndicatorProxy=null;this.entityControllers={};this.init()};d.prototype=Object.create(a);d.prototype.constructor=d;d.prototype.dispose=function(){a.dispose.call(this)};d.prototype.openOrLoadMasterTab=function(f,e,h,i){if(this.masterTabsObj.goTo(h)){return false}var g=i===undefined?{}:i;c.oc.stripeLoadIndicator.show();var j=f.request(e,{data:g}).done(this.proxy(this.addMasterTab)).always(this.hideStripeIndicatorProxy);return j};d.prototype.getMasterTabActivePane=function(){return this.$masterTabs.find("> .tab-content > .tab-pane.active")};d.prototype.unchangeTab=function(e){e.find("form").trigger("unchange.oc.changeMonitor")};d.prototype.triggerCommand=function(h,g){var f=h.split(":");if(f.length===2){var e=f[0],i=f[1];if(this.entityControllers[e]===undefined){throw new Error("Unknown entity type: "+e)}this.entityControllers[e].invokeCommand(i,g)}};d.prototype.init=function(){this.$masterTabs=c("#builder-master-tabs");this.$sidePanel=c("#builder-side-panel");this.masterTabsObj=this.$masterTabs.data("oc.tab");this.hideStripeIndicatorProxy=this.proxy(this.hideStripeIndicator);new c.oc.tabFormExpandControls(this.$masterTabs);this.createEntityControllers();this.registerHandlers()};d.prototype.createEntityControllers=function(){for(var e in c.oc.builder.entityControllers){if(e=="base"){continue}this.entityControllers[e]=new c.oc.builder.entityControllers[e](this)}};d.prototype.registerHandlers=function(){c(document).on("click","[data-builder-command]",this.proxy(this.onCommand));c(document).on("submit","[data-builder-command]",this.proxy(this.onCommand));this.$masterTabs.on("changed.oc.changeMonitor",this.proxy(this.onFormChanged));this.$masterTabs.on("unchanged.oc.changeMonitor",this.proxy(this.onFormUnchanged));this.$masterTabs.on("shown.bs.tab",this.proxy(this.onTabShown));this.$masterTabs.on("afterAllClosed.oc.tab",this.proxy(this.onAllTabsClosed));this.$masterTabs.on("closed.oc.tab",this.proxy(this.onTabClosed));this.$masterTabs.on("autocompleteitems.oc.inspector",this.proxy(this.onDataRegistryItems));this.$masterTabs.on("dropdownoptions.oc.inspector",this.proxy(this.onDataRegistryItems));for(var e in this.entityControllers){if(this.entityControllers[e].registerHandlers!==undefined){this.entityControllers[e].registerHandlers()}}};d.prototype.hideStripeIndicator=function(){c.oc.stripeLoadIndicator.hide()};d.prototype.addMasterTab=function(e){this.masterTabsObj.addTab(e.tabTitle,e.tab,e.tabId,"oc-"+e.tabIcon);if(e.isNewRecord){var f=this.getMasterTabActivePane();f.find("form").one("ready.oc.changeMonitor",this.proxy(this.onChangeMonitorReady))}};d.prototype.updateModifiedCounter=function(){var e={database:{menu:"database",count:0},models:{menu:"models",count:0},permissions:{menu:"permissions",count:0},menus:{menu:"menus",count:0},versions:{menu:"versions",count:0},localization:{menu:"localization",count:0},controller:{menu:"controllers",count:0}};c("> div.tab-content > div.tab-pane[data-modified] > form",this.$masterTabs).each(function(){var f=c(this).data("entity");e[f].count++});c.each(e,function(f,g){c.oc.sideNav.setCounter("builder/"+g.menu,g.count)})};d.prototype.getFormPluginCode=function(f){var e=c(f).closest("form"),h=e.find('input[name="plugin_code"]'),g=h.val();if(!g){throw new Error("Plugin code input is not found in the form.")}return g};d.prototype.setPageTitle=function(e){c.oc.layout.setPageTitle(e.length?(e+" | "):e)};d.prototype.getFileLists=function(){return c("[data-control=filelist]",this.$sidePanel)};d.prototype.dataToInspectorArray=function(h){var e=[];for(var f in h){var g={title:h[f],value:f};e.push(g)}return e};d.prototype.onCommand=function(f){if(f.currentTarget.tagName=="FORM"&&f.type=="click"){return}var g=c(f.currentTarget).data("builderCommand");this.triggerCommand(g,f);var e=c(f.currentTarget);if(f.currentTarget.tagName==="A"&&e.attr("role")=="menuitem"&&e.attr("href")=="javascript:;"){return}f.preventDefault();return false};d.prototype.onFormChanged=function(e){c(".form-tabless-fields",e.target).trigger("modified.oc.tab");this.updateModifiedCounter()};d.prototype.onFormUnchanged=function(e){c(".form-tabless-fields",e.target).trigger("unmodified.oc.tab");this.updateModifiedCounter()};d.prototype.onTabShown=function(f){var g=c(f.target).closest("[data-control=tab]");if(g.attr("id")!=this.$masterTabs.attr("id")){return}var e=c(f.target).closest("li").attr("data-tab-id"),h=c(f.target).attr("title");if(h){this.setPageTitle(h)}this.getFileLists().fileList("markActive",e);c(window).trigger("resize")};d.prototype.onAllTabsClosed=function(e){this.setPageTitle("");this.getFileLists().fileList("markActive",null)};d.prototype.onTabClosed=function(f,e,g){c(g).find("form").off("ready.oc.changeMonitor",this.proxy(this.onChangeMonitorReady));this.updateModifiedCounter()};d.prototype.onChangeMonitorReady=function(e){c(e.target).trigger("change")};d.prototype.onDataRegistryItems=function(h,i){var g=this;if(i.propertyDefinition.fillFrom=="model-classes"||i.propertyDefinition.fillFrom=="model-forms"||i.propertyDefinition.fillFrom=="model-lists"||i.propertyDefinition.fillFrom=="controller-urls"||i.propertyDefinition.fillFrom=="model-columns"||i.propertyDefinition.fillFrom=="plugin-lists"||i.propertyDefinition.fillFrom=="permissions"){h.preventDefault();var f=null,e=i.propertyDefinition.subtypeFrom;if(e!==undefined){f=i.values[e]}c.oc.builder.dataRegistry.get(c(h.target),this.getFormPluginCode(h.target),i.propertyDefinition.fillFrom,f,function(j){i.callback({options:g.dataToInspectorArray(j)})})}};c(document).ready(function(){c.oc.builder.indexController=new d()})}(window.jQuery);