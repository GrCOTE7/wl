+function(d){var c=d.oc.foundation.base,b=c.prototype;var a=function(){c.call(this);this.controlPaletteMarkup=null;this.popoverMarkup=null;this.containerMarkup=null;this.$popoverContainer=null};a.prototype=Object.create(b);a.prototype.constructor=a;a.prototype.loadControlPalette=function(e,g){if(this.controlPaletteMarkup===null){var f={controlId:g};d.oc.stripeLoadIndicator.show();d(e).request("onModelFormLoadControlPalette",{data:f}).done(this.proxy(this.controlPaletteMarkupLoaded)).always(function(){d.oc.stripeLoadIndicator.hide()})}else{this.showControlPalette(g,true)}};a.prototype.controlPaletteMarkupLoaded=function(e){this.controlPaletteMarkup=e.markup;this.showControlPalette(e.controlId)};a.prototype.getControlById=function(e){return document.body.querySelector('li[data-builder-control-id="'+e+'"]')};a.prototype.showControlPalette=function(f,e){if(this.getContainerPreference()){this.showControlPalletteInContainer(f,e)}else{this.showControlPalletteInPopup(f,e)}};a.prototype.assignControlIdToTemplate=function(e,f){return e.replace("%c",f)};a.prototype.markPlaceholderPaletteOpen=function(e){d(e).addClass("control-palette-open")};a.prototype.markPlaceholderPaletteNotOpen=function(e){d(e).removeClass("control-palette-open")};a.prototype.getContainerPreference=function(){return d.oc.inspector.manager.getContainerPreference()};a.prototype.setContainerPreference=function(e){return d.oc.inspector.manager.setContainerPreference(e)};a.prototype.addControl=function(f){var e=d(f.currentTarget),g=e.closest("[data-control-palette-controlid]").attr("data-control-palette-controlid");f.preventDefault();f.stopPropagation();if(!g){return false}var h=this.getControlById(g);if(!h){return false}if(d(h).hasClass("loading-control")){return false}e.trigger("close.oc.popover");var i=d.oc.builder.formbuilder.controller.addControlFromControlPalette(g,e.data("builderControlType"),e.data("builderControlName"));i.done(function(){d.oc.inspector.manager.createInspector(h);d(h).trigger("change")});return false};a.prototype.showControlPalletteInPopup=function(h,g){var i=this.getControlById(h);if(!i){return}var f=d(i);f.ocPopover({content:this.assignControlIdToTemplate(this.getPopoverMarkup(),h),highlightModalTarget:true,modal:true,placement:"below",containerClass:"control-inspector",offset:15,width:400});var e=f.data("oc.popover").$container;if(g){e.trigger("render")}};a.prototype.getPopoverMarkup=function(){if(this.popoverMarkup!==null){return this.popoverMarkup}var e=d("script[data-template=control-palette-popover]").html();this.popoverMarkup=e.replace("%s",this.controlPaletteMarkup);return this.popoverMarkup};a.prototype.dockToContainer=function(g){var e=d(g.target).closest(".control-popover"),f=e.find("[data-control-palette-controlid]"),h=f.attr("data-control-palette-controlid"),i=this.getControlById(h);e.trigger("close.oc.popover");this.setContainerPreference(true);if(i){this.loadControlPalette(d(i),h)}};a.prototype.showControlPalletteInContainer=function(h,g){var i=this.getControlById(h);if(!i){return}var e=d.oc.inspector.manager,j=e.getContainerElement(d(i));if(!e.applyValuesFromContainer(j)||!e.containerHidingAllowed(j)){return}d.oc.foundation.controlUtils.disposeControls(j.get(0));this.markPlaceholderPaletteOpen(i);var f=this.assignControlIdToTemplate(this.getContainerMarkup(),h);j.append(f);j.find("[data-control-palette-controlid]").one("dispose-control",this.proxy(this.onRemovePaletteFromContainer));if(g){j.trigger("render")}};a.prototype.onRemovePaletteFromContainer=function(e){this.removePaletteFromContainer(d(e.target))};a.prototype.removePaletteFromContainer=function(h){var e=h.attr("data-control-palette-controlid"),g=this.getControlById(e);if(g){this.markPlaceholderPaletteNotOpen(g)}var f=h.parent();h.remove();f.html("")};a.prototype.getContainerMarkup=function(){if(this.containerMarkup!==null){return this.containerMarkup}var e=d("script[data-template=control-palette-container]").html();this.containerMarkup=e.replace("%s",this.controlPaletteMarkup);return this.containerMarkup};a.prototype.closeInContainer=function(e){this.removePaletteFromContainer(d(e.target).closest("[data-control-palette-controlid]"))};a.prototype.undockFromContainer=function(e){var h=d(e.target).closest("[data-control-palette-controlid]"),f=h.attr("data-control-palette-controlid"),g=this.getControlById(f);this.removePaletteFromContainer(h);this.setContainerPreference(false);if(g){this.loadControlPalette(d(g),f)}};d(document).ready(function(){d.oc.builder.formbuilder.controlPalette=new a()})}(window.jQuery);