+function(d){var c=d.oc.foundation.base,b=c.prototype;var a=function(){c.call(this);this.init()};a.prototype=Object.create(b);a.prototype.constructor=a;a.prototype.init=function(){this.registerHandlers()};a.prototype.registerHandlers=function(){var e=d("#layout-body");e.on("click","li[data-builder-new-tab]",this.proxy(this.onNewTabClick));e.on("click","div[data-builder-tab]",this.proxy(this.onTabClick));e.on("click","div[data-builder-close-tab]",this.proxy(this.onTabCloseClick));e.on("change livechange","ul.tabs > li div.inspector-trigger.tab-control",this.proxy(this.onTabChange));e.on("hiding.oc.inspector","ul.tabs > li div.inspector-trigger.tab-control",this.proxy(this.onTabInspectorHiding))};a.prototype.getTabList=function(e){return e.find("> ul.tabs")};a.prototype.getPanelList=function(e){return e.find("> ul.panels")};a.prototype.findTabControl=function(e){return e.closest("div.tabs")};a.prototype.findTabPanel=function(g){var f=this.findTabControl(g),e=g.index();return this.getPanelList(f).find(" > li").eq(e)};a.prototype.findPanelTab=function(g){var f=this.findTabControl(g),e=g.index();return this.getTabList(f).find(" > li").eq(e)};a.prototype.findTabPanel=function(g){var f=this.findTabControl(g),e=g.index();return this.getPanelList(f).find(" > li").eq(e)};a.prototype.findTabForm=function(e){return d(e).closest("form")};a.prototype.getGlobalTabsProperties=function(f){var e=d(f).find(".inspector-trigger.tab-control.global [data-inspector-values]").val();if(e.length==0){e="{}"}return d.parseJSON(e)};a.prototype.getElementTabTitle=function(g){var i=d(g).closest("li.tab-panel"),h=this.findPanelTab(i),f=h.find("[data-inspector-values]").val(),e=d.parseJSON(f);return e.title};a.prototype.tabHasControls=function(e){return this.findTabPanel(e).find("ul[data-control-list] li.control:not(.placeholder)").length>0};a.prototype.tabNameExists=function(l,f,k){var h=l.get(0).children;for(var g=0,e=h.length;g<e;g++){if(k!==undefined&&k.get(0)===h[g]){continue}var j=d("[data-tab-title]",h[g]).text();if(j==f){return true}}return false};a.prototype.generateTabName=function(h,g){var i=g.data("tabNameTemplate"),f=h.get(0).children,e=f.length;name=i.replace("%s",e);while(this.tabNameExists(h,name)){name=i.replace("%s",e);e++}return name};a.prototype.createNewTab=function(j){var i=d("[data-tab-template]",j).html(),f=d("[data-panel-template]",j).html(),k=this.getTabList(j),h=this.generateTabName(k,j),g=i.replace(/tabtitle/mg,h);var e=d(g),l=k.find("> li[data-builder-new-tab]");d("[data-tab-title]",e).text(h);e.insertBefore(l);this.getPanelList(j).append(f);this.gotoTab(e)};a.prototype.gotoTab=function(h){var f=h.index(),g=this.findTabControl(h),i=this.getTabList(g),e=this.getPanelList(g);d("> li",i).removeClass("active");h.addClass("active");d("> li",e).removeClass("active");d("> li",e).eq(f).addClass("active")};a.prototype.findInspectorContainer=function(f){var e=f.closest("[data-inspector-container]");return e.find(".inspector-container")};a.prototype.closeTabInspectors=function(g,f){if(g.find(".inspector-open").length===0&&f.find(".inspector-open").length===0){return}var e=this.findInspectorContainer(g);d.oc.foundation.controlUtils.disposeControls(e.get(0))};a.prototype.closeTabControlPalette=function(g,f){if(f.find(".control-palette-open").length===0){return}var e=this.findInspectorContainer(g);d.oc.foundation.controlUtils.disposeControls(e.get(0))};a.prototype.closeTab=function(i){var h=this.findTabControl(i);if(this.tabHasControls(i)){if(!confirm(h.data("tabCloseConfirmation"))){return}i.trigger("change")}var f=i.prev(),e=i.next(),g=this.findTabPanel(i);this.closeTabInspectors(i,g);this.closeTabControlPalette(i,g);i.remove();g.remove();if(f.length>0){this.gotoTab(f)}else{if(e.length>0&&!e.hasClass("new-tab")){this.gotoTab(e)}else{this.createNewTab(h)}}};a.prototype.updateTabProperties=function(h){var g=h.find("[data-inspector-values]").val(),e=d.parseJSON(g),f=this.findTabForm(h),i=f.find("input[name=plugin_code]").val();h.find("[data-tab-title]").attr("data-localization-key",e.title);d.oc.builder.dataRegistry.getLocalizationString(f,i,e.title,function(j){h.find("[data-tab-title]").text(j)})};a.prototype.onNewTabClick=function(e){this.createNewTab(d(e.currentTarget).closest("div.tabs"));e.stopPropagation();e.preventDefault();return false};a.prototype.onTabClick=function(e){this.gotoTab(d(e.currentTarget).closest("li"));e.stopPropagation();e.preventDefault();return false};a.prototype.onTabCloseClick=function(e){this.closeTab(d(e.currentTarget).closest("li"));e.stopPropagation();e.preventDefault();return false};a.prototype.onTabChange=function(e){this.updateTabProperties(d(e.currentTarget).closest("li"))};a.prototype.onTabInspectorHiding=function(e,h){var g=d(e.currentTarget).closest("li"),f=this.findTabControl(g),i=this.getTabList(f);if(this.tabNameExists(i,h.values.title,g)){alert(f.data("tabAlreadyExists"));e.preventDefault()}};d(document).ready(function(){d.oc.builder.formbuilder.tabManager=new a()})}(window.jQuery);