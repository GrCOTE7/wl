+function(c){if(c.oc.builder.menubuilder===undefined){c.oc.builder.menubuilder={}}var b=c.oc.foundation.base,a=b.prototype;var d=function(){b.call(this);this.init()};d.prototype=Object.create(a);d.prototype.constructor=d;d.prototype.init=function(){this.registerHandlers()};d.prototype.registerHandlers=function(){c(document).on("change",".builder-menu-editor li.item",this.proxy(this.onItemChange));c(document).on("dragged.list.sortable",".builder-menu-editor li.item",this.proxy(this.onItemDragged));c(document).on("livechange",".builder-menu-editor li.item",this.proxy(this.onItemLiveChange))};d.prototype.getParentList=function(e){return c(e).closest("ul")};d.prototype.findForm=function(e){return c(e).closest("form")};d.prototype.getElementListItem=function(e){return c(e).closest("li")};d.prototype.getMenuBuilderControlElement=function(e){return c(e).closest("[data-control=builder-menu-editor]")};d.prototype.getTemplateMarkup=function(g,e){var f=this.getMenuBuilderControlElement(g);return f.find("script["+e+"]").html()};d.prototype.getItemProperties=function(e){return c.parseJSON(c(e).find("> input[data-inspector-values]").val())};d.prototype.itemCodeExistsInList=function(f,j){var e=f.find("> li.item > input[data-inspector-values]");for(var h=e.length-1;h>=0;h--){var k=String(e[h].value);if(k.length===0){continue}var g=c.parseJSON(k);if(g.code==j){return true}}return false};d.prototype.replacePropertyValue=function(f,i,h){var e=f.find(" > input[data-inspector-values]"),g=c.parseJSON(e.val());g[i]=h;e.val(JSON.stringify(g))};d.prototype.generateItemCode=function(e,h){var f=1,g=h;while(this.itemCodeExistsInList(e,g)){f++;g=h+f}return g};d.prototype.updateItemVisualProperties=function(h){var g=this.getItemProperties(h),f=c(h),e=this.findForm(h),i=e.find("input[name=plugin_code]").val();f.find("> .item-container > span.title").attr("data-localization-key",g.label);c.oc.builder.dataRegistry.getLocalizationString(f,i,g.label,function(j){f.find("> .item-container > span.title").text(j)});f.find("> .item-container > i").attr("class",g.icon)};d.prototype.findInspectorContainer=function(f){var e=f.closest("[data-inspector-container]");return e.find(".inspector-container")};d.prototype.addMainMenuItem=function(h){var i=this.getTemplateMarkup(h.currentTarget,"data-main-menu-template"),e=c(i),f=this.getParentList(h.currentTarget),g=this.generateItemCode(f,"main-menu-item");this.replacePropertyValue(e,"code",g);this.getElementListItem(h.currentTarget).before(e);c(this.findForm(h.currentTarget)).trigger("change")};d.prototype.addSideMenuItem=function(h){var i=this.getTemplateMarkup(h.currentTarget,"data-side-menu-template"),e=c(i),f=this.getParentList(h.currentTarget),g=this.generateItemCode(f,"side-menu-item");this.replacePropertyValue(e,"code",g);this.getElementListItem(h.currentTarget).before(e);c(this.findForm(h.currentTarget)).trigger("change")};d.prototype.getJson=function(f){var e=f.querySelectorAll("ul.builder-main-menu > li.item"),r=[];for(var m=0,o=e.length;m<o;m++){var n=e[m],k=this.getItemProperties(n);if(k.sideMenu!==undefined){delete k.sideMenu}var h=n.querySelectorAll("ul.builder-submenu > li.item");for(var l=0,p=h.length;l<p;l++){var q=h[l],g=this.getItemProperties(q);if(k.sideMenu===undefined){k.sideMenu=[]}k.sideMenu.push(g)}r.push(k)}return JSON.stringify(r)};d.prototype.deleteMenuItem=function(h){var g=this.getElementListItem(h.currentTarget);if(c(g).hasClass("inspector-open")){var e=this.findInspectorContainer(c(g));c.oc.foundation.controlUtils.disposeControls(e.get(0))}var j=g.get(0).querySelectorAll("li.inspector-open");for(var f=j.length-1;f>=0;f--){var e=this.findInspectorContainer(c(j[f]));c.oc.foundation.controlUtils.disposeControls(e.get(0))}c(this.findForm(h.currentTarget)).trigger("change");c(g).remove()};d.prototype.onItemLiveChange=function(e){this.updateItemVisualProperties(e.currentTarget);c(this.findForm(e.currentTarget)).trigger("change");e.stopPropagation();return false};d.prototype.onItemChange=function(e){this.updateItemVisualProperties(e.currentTarget);e.stopPropagation();return false};d.prototype.onItemDragged=function(e){c(this.findForm(e.target)).trigger("change")};c(document).ready(function(){c.oc.builder.menubuilder.controller=new d()})}(window.jQuery);