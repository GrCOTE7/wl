+function(b){if(b.oc.pages===undefined){b.oc.pages={}}var a=function(c){this.$masterTabs=c;var d=this;b(document).on("hidden.oc.inspector",".field-richeditor [data-snippet]",function(){d.syncEditorCode(this)});b(document).on("init.oc.richeditor",".field-richeditor textarea",function(e,f){d.initSnippets(f.getElement())});b(document).on("setContent.oc.richeditor",".field-richeditor textarea",function(e,f){if(!f.isCodeViewActive()){d.initSnippets(f.getElement())}});b(document).on("syncContent.oc.richeditor",".field-richeditor textarea",function(f,g,e){d.syncPageMarkup(f,e)});b(document).on("figureKeydown.oc.richeditor",".field-richeditor textarea",function(e,g,f){d.editorKeyDown(e,g,f)});b(document).on("click","[data-snippet]",function(){b.oc.inspector.manager.createInspector(this);return false})};a.prototype.onSidebarSnippetClick=function(f){var d=b("div.tab-content > .tab-pane.active form[data-object-type=page]",this.$masterTabs);if(!d.length){b.oc.alert("Snippets can only be added to Pages. Please open or create a Page first.");return}var c=b(".control-tabs.secondary-tabs .tab-pane.active",d),j=c.find('[data-control="richeditor"] textarea'),e=j.closest('[data-control="richeditor"]'),h=b('<figure contenteditable="false" data-inspector-css-class="hero">&nbsp;</figure>'),g=f.attr("data-component-class"),i=f.data("snippet");if(!j.length){b.oc.alert("Snippets can only be added to page Content or HTML placeholders.");return}if(g){h.attr({"data-component":g,"data-inspector-class":g});i=this.generateUniqueComponentSnippetCode(g,i,d)}h.attr({"data-snippet":i,"data-name":f.data("snippet-name"),tabindex:"0",draggable:"true","data-ui-block":"true"});h.addClass("fr-draggable");e.richEditor("insertUiBlock",h)};a.prototype.generateUniqueComponentSnippetCode=function(f,g,d){var h=g,c=1,e=false;do{e=false;b('[data-control="richeditor"] textarea',d).each(function(){var j=b(this),i=b("<div>"+j.val()+"</div>");if(i.find('[data-snippet="'+h+'"][data-component]').length>0){e=true;h=g+c;c++;return false}})}while(e);return h};a.prototype.syncEditorCode=function(c){setTimeout(function(){var d=b(c).closest("[data-control=richeditor]");d.richEditor("syncContent");c.focus()},0)};a.prototype.initSnippets=function(e){var d=[];b(".fr-view [data-snippet]",e).each(function(){var f=b(this),h=f.attr("data-snippet"),g=f.attr("data-component");if(g){h+="|"+g}d.push(h);f.addClass("loading").addClass("fr-draggable").attr({"data-inspector-css-class":"hero","data-name":"Loading...","data-ui-block":"true",draggable:"true",tabindex:"0"}).html("&nbsp;");if(g){f.attr("data-inspector-class",g)}this.contentEditable=false});if(d.length>0){var c=e.request("onGetSnippetNames",{data:{codes:d}}).done(function(f){if(f.names!==undefined){b.each(f.names,function(g){b('[data-snippet="'+g+'"]',e).attr("data-name",this).removeClass("loading")})}})}};a.prototype.syncPageMarkup=function(d,c){var e=b("<div>"+c.html+"</div>");b("[data-snippet]",e).each(function(){var f=b(this);f.removeAttr("contenteditable data-name tabindex data-inspector-css-class data-inspector-class data-property-inspectorclassname data-property-inspectorproperty data-ui-block draggable");f.removeClass("fr-draggable fr-dragging");if(!f.attr("class")){f.removeAttr("class")}});c.html=e.html()};a.prototype.editorKeyDown=function(c,e,d){if(d.getTextarea()===undefined){return}if(e.target&&b(e.target).attr("data-snippet")!==undefined){this.snippetKeyDown(e,e.target)}};a.prototype.snippetKeyDown=function(d,c){if(d.which==32){switch(d.which){case 32:b.oc.inspector.manager.createInspector(c);break}}};b.oc.pages.snippetManager=a}(window.jQuery);